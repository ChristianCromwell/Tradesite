(self.webpackChunktradingview=self.webpackChunktradingview||[]).push([[8107,70297,1053],{144762:e=>{e.exports={}},390251:(e,t,i)=>{"use strict";i.d(t,{WatchedObject:()=>o});var s=i(536794),r=i(597773);function n(e,t){return(0,s.deepEquals)(e,t)[0]}class o extends r.WatchedValue{constructor(e,t=n){super(e),this._comparator=t}setValue(e,t){!t&&this._comparator(this.value(),e)||super.setValue(e,t)}}},597773:(e,t,i)=>{"use strict";i.d(t,{WatchedValue:()=>a});var s=i(735566),r=i(954992);const n=(0,s.getLogger)("Common.WatchedValue");function o(e){n.logError(`${e&&(e.stack||e.message)}`)}class a{constructor(...e){this._listeners=[],e.length>0?this._value=e[0]:delete this._value}destroy(){this.unsubscribe()}value(){return this._owner?this._owner._value:this._value}setValue(e,t){const i=this._owner?this._owner:this;if(i.writeLock)return;const s=i._value===e||Number.isNaN(i._value)&&Number.isNaN(e);if(!t&&s&&i.hasOwnProperty("_value"))return;i._value=e;const r=i._listeners.slice();let n=0;for(let t=0;t<r.length;t++){r[t].once&&(i._listeners.splice(t-n,1),n++);try{r[t].cb(e)}catch(e){o(e)}}}deleteValue(){this.setValue(void 0)}subscribe(e,t){if("function"!=typeof e)throw new TypeError("callback must be a function");const i=!!t&&!!t.once,s=!!t&&!!t.callWithLast,r=this._owner?this._owner:this;if(s&&r.hasOwnProperty("_value")){try{e(r._value)}catch(e){o(e)}if(i)return}r._listeners.push({cb:e,owner:this,once:!!t&&!!t.once})}unsubscribe(e){const t=this._owner?this._owner:this;void 0===e&&(e=null);const i=t._listeners;for(let s=i.length;s--;)i[s].owner!==this&&t!==this||i[s].cb!==e&&null!==e||i.splice(s,1)}readonly(){if(this._readonlyInstance)return this._readonlyInstance;const e={subscribe:this.subscribe.bind(this),unsubscribe:this.unsubscribe.bind(this),value:this.value.bind(this),when:this.when.bind(this),ownership:this.ownership.bind(this),spawnOwnership:this.spawnOwnership.bind(this),weakReference:this.weakReference.bind(this),spawn:e=>this.spawn(e).readonly(),destroy:this.destroy.bind(this)};return this._readonlyInstance=e,e}spawn(e){return this._spawn(e)}when(e){(0,r.callWhen)(this,(e=>Boolean(e)),(()=>{try{e(this.value())}catch(e){o(e)}}))}assertNoSubscriptions(){0}ownership(){return this}release(){this.destroy()}spawnOwnership(){return this._spawn()}weakReference(){return this._spawn(void 0,!0)}_spawn(e,t){return new l(this._owner||this,e,t)}}class l extends a{constructor(e,t,i){super(),delete this._listeners,this._owner=e,this._onDestroy=t,this._weakReference=!!i}destroy(){try{this._onDestroy?.()}catch(e){o(e)}super.destroy()}readonly(){return super.readonly()}release(){this._weakReference||super.release()}}},790188:(e,t,i)=>{"use strict";i.d(t,{colorsPalette:()=>s.colorsPalette,getHexColorByName:()=>s.getHexColorByName});var s=i(867690)},927301:(e,t,i)=>{"use strict";i.r(t),i.d(t,{capitalizeFirstLetterInWord:()=>_,decodeHTMLEntities:()=>h,encodeHTMLEntities:()=>u,getFirstSegmentOrCodePointString:()=>m,htmlEscape:()=>d,removeSpaces:()=>p,removeTags:()=>c});const s=/[<"'&>]/g,r=e=>`&#${e.charCodeAt(0)};`,n={"&lt;":"<",
"&gt;":">","&quot;":'"',"&apos;":"'","&amp;":"&","&#60;":"<","&#62;":">","&#34;":'"',"&#39;":"'","&#039;":"'","&#38;":"&"},o=Object.assign({},...Object.entries(n).map((([e,t])=>({[t]:e})))),a=new RegExp(Object.keys(n).join("|"),"g"),l=new RegExp(Object.keys(o).join("|"),"g");function h(e){return e.replace(a,(e=>n[e]||e))}function u(e){return e.replace(l,(e=>o[e]||e))}function d(e){return e.replace(s,r)}function c(e=""){return e.replace(/(<([^>]+)>)/gi,"")}function p(e=""){return e.replace(/\s+/g,"")}function _(e=""){return e.replace(/\b\w/g,(e=>e.toUpperCase()))}function m(e){const t=Intl.Segmenter;if(t){const i=new t(void 0,{granularity:"grapheme"}),[{segment:s}={segment:null}]=i.segment(e);return s?.toUpperCase()??null}{const t=e.codePointAt(0);return t?String.fromCodePoint(t).toUpperCase():null}}},229534:(e,t,i)=>{"use strict";async function s(e){return(await Promise.all([i.e(66814),i.e(41392),i.e(71761),i.e(66534),i.e(11194),i.e(3016),i.e(67799),i.e(64935),i.e(29684),i.e(25977),i.e(53320),i.e(30938),i.e(94241),i.e(37757)]).then(i.bind(i,173403))).createDialog(e)}function r(e){s(e).then((e=>e.open()))}i.d(t,{createErrorDialog:()=>s,showErrorDialog:()=>r})},456335:(e,t,i)=>{"use strict";i.d(t,{featureCheck:()=>n});var s=i(778016);function r(e,t,i){return t.value||(0,s.enabled)(e,i)}function n(e,t,i){switch(e){case"SCREENER_INTERVALS":return function(e,t){const i=(0,s.getConfig)("SCREENER_INTERVALS",t);return!(!i||!i.interval)&&i.interval.includes(e.interval)}(t,i);case"SCREENER_AUTO_REFRESH":return r("SCREENER_AUTO_REFRESH",t,i);case"ALERTS_NO_EXPIRATION":return r("ALERTS_NO_EXPIRATION",t,i);default:return(0,s.enabled)(e,i)}}},251954:(e,t,i)=>{"use strict";i.d(t,{emit:()=>u,emitOnce:()=>d,on:()=>l,subscribe:()=>h,unsubscribe:()=>a});var s=i(547465);const r={},n=[],o={};function a(e,t,i){r[e].unsubscribe(i,t)}function l(e,t,i){h(e,t,i)}function h(e,t,i,n){r.hasOwnProperty(e)||(r[e]=new s.Delegate),o[e]?t.call(i):r[e].subscribe(i,t,n)}function u(e,...t){const i=[e].concat(t);n.forEach((e=>{e.apply(null,i)})),r.hasOwnProperty(e)&&r[e].fire.apply(r[e],t)}function d(e){o[e]&&console.warn(`Something went wrong: emitOnce called multiple times with same event (${e})`),o[e]=!0,u.apply(null,arguments)}},588948:(e,t,i)=>{"use strict";i.d(t,{getFreshInitData:()=>l,getInitData:()=>a,updateInitData:()=>o});var s=i(650151);const r=(0,i(735566).getLogger)("Common.InitData"),n=window.initData||{};function o(){window.initData&&window.initData!==n&&(Object.assign(n,window.initData),window.initData=n);const e=document.querySelectorAll('script[type="application/prs.init-data+json"]');for(let t=0;t<e.length;t++){const i=e[t];try{const e=JSON.parse((0,s.ensureNotNull)(i.textContent));Object.assign(n,e)}catch(e){r.logWarn(`Failed to parse initData element. ${e}`)}finally{(0,s.ensureNotNull)(i.parentNode).removeChild(i)}}}function a(){return n}function l(){return o(),n}},583912:(e,t,i)=>{"use strict";i.d(t,{linking:()=>g});var s=i(290484),r=i(650151),n=i(820028),o=(i(931924),
i(477786)),a=i(388741),l=i(735566),h=i(62802),u=i(588948),d=i(776734),c=i(388130),p=i(296538),_=i(912445);const m=(0,l.getLogger)("Linking");class y{constructor(e,t,i){this.watchedSymbol=new n.WatchedValue,this.seriesShortSymbol=new n.WatchedValue,this.proSymbol=new n.WatchedValue,this.ensuredProSymbol=new n.WatchedValue,this.watchedInterval=new n.WatchedValue,this.watchedIntraday=new n.WatchedValue,this.watchedSeconds=new n.WatchedValue,this.watchedTicks=new n.WatchedValue,this.watchedDataFrequencyResolution=new n.WatchedValue,this.watchedRange=new n.WatchedValue,this.watchedSupportedResolutions=new n.WatchedValue,this.watchedSupportedChartStyles=new n.WatchedValue,this.symbolNamesList=new n.WatchedValue,this._chartWidgetCollection=null,this._chartWidgetBindingState=0,this._activeChartWidget=null,this._linkingGroupCharts=null,this._boundChartWidget=null,this._watchedSymbolListenerBound=this._watchedSymbolListener.bind(this),this._watchedIntervalListenerBound=this._watchedIntervalListener.bind(this),this._setGroupSymbolCancellationToken={cancelled:!1},this._muted=!1,this.updateBoundChartWidget=()=>{const e=this._chartToBind();e!==this._boundChartWidget&&(null===e?this.unbindFromChartWidget():this.bindToChartWidget(e))},this._updateAllGroupChartWidgets=()=>{this._destroySymbolIntervalPropertySubscriptions?.();const e=(0,r.ensureNotNull)(this._linkingGroupCharts).value(),t=[],i=[];for(const s of e){const e=s.symbolWV().spawn(),r=s.resolutionWV().spawn();e.subscribe(this._updateSymbolByProperty.bind(this,s)),r.subscribe(this._updateIntervalByProperty.bind(this,s)),t.push(e),i.push(r)}this._destroySymbolIntervalPropertySubscriptions=()=>{t.forEach((e=>e.destroy())),i.forEach((e=>e.destroy())),this._destroySymbolIntervalPropertySubscriptions=void 0};const s=this.watchedSymbol.value();e.length>1&&this._needApplySymbol(s)&&!this._muted&&this._setGroupSymbol(s);const n=this.watchedInterval.value();e.length>1&&this._needApplyInterval(n)&&!this._muted&&this._setGroupInterval(n),this.updateBoundChartWidget()},this._groupIndex=e;const s=(e,t)=>{e.subscribe((e=>{i()===this&&t.setValue(e)}),{callWithLast:!0})};s(this.watchedSymbol,t.watchedSymbol),s(this.seriesShortSymbol,t.seriesShortSymbol),s(this.proSymbol,t.proSymbol),s(this.ensuredProSymbol,t.ensuredProSymbol),s(this.watchedInterval,t.watchedInterval),s(this.watchedIntraday,t.watchedIntraday),s(this.watchedSeconds,t.watchedSeconds),s(this.watchedTicks,t.watchedTicks),s(this.watchedDataFrequencyResolution,t.watchedDataFrequencyResolution),s(this.watchedRange,t.watchedRange),s(this.watchedSupportedResolutions,t.watchedSupportedResolutions),s(this.watchedSupportedChartStyles,t.watchedSupportedChartStyles),s(this.symbolNamesList,t.symbolNamesList),this.watchedSymbol.subscribe((e=>{this._boundChartWidget&&this._boundChartWidget.hasModel()&&this._mainSeries().symbolSameAsCurrent(e)||this.proSymbol.setValue(e)}),{callWithLast:!0})}mute(e){this._muted=e}bindToChartWidgetCollection(e){this.unbindFromChartWidgetCollection(),this._chartWidgetCollection=e,
this._activeChartWidget=e.activeChartWidget.spawn(),this._activeChartWidget.subscribe(this.updateBoundChartWidget),this._linkingGroupCharts=e.linkingGroupsCharts(this._groupIndex).spawn(),this._linkingGroupCharts.subscribe(this._updateAllGroupChartWidgets),this.updateBoundChartWidget(),this._updateAllGroupChartWidgets()}unbindFromChartWidgetCollection(){this.unbindFromChartWidget(),this._chartWidgetCollection=null,this._activeChartWidget?.destroy(),this._activeChartWidget=null,this._linkingGroupCharts?.destroy(),this._linkingGroupCharts=null,this._destroySymbolIntervalPropertySubscriptions?.()}bindToChartWidget(e){if(this.unbindFromChartWidget(),this._boundChartWidget=e,e.hasModel())return void this._onChartModelCreated(e.model());e.modelCreated().subscribe(this,this._onChartModelCreated,!0),this._chartWidgetBindingState=1;const t=e.mainSeriesProperties().childs();this.watchedSymbol.setValue(t.symbol.value()),this.watchedInterval.setValue(t.interval.value()),this._boundChartWidget.linkingGroupIndex().subscribe(this.updateBoundChartWidget)}unbindFromChartWidget(){const e=this._boundChartWidget;if(null!==e){switch(this._chartWidgetBindingState){case 1:e.modelCreated().unsubscribeAll(this);break;case 2:this.watchedSymbol.unsubscribe(this._watchedSymbolListenerBound);const t=this._mainSeries().dataEvents();t.symbolResolved().unsubscribeAll(this),t.symbolError().unsubscribeAll(this),this._mainSeries().onIntervalChanged().unsubscribeAll(this),this.watchedInterval.unsubscribe(this._watchedIntervalListenerBound),delete this.watchedSymbol.writeLock}e.linkingGroupIndex().unsubscribe(this.updateBoundChartWidget),this._boundChartWidget=null,this._chartWidgetBindingState=0}}boundChartWidget(){return this._boundChartWidget}_mainSeries(){if(!this._boundChartWidget)throw new Error("ChartWidget is undefined");return this._boundChartWidget.model().mainSeries()}_watchedSymbolListener(e){this._needApplySymbol(e)&&!this._muted&&(this._setGroupSymbol(e),this._sendSnowplowAnalytics())}_updateSymbolByProperty(e,t){const i=this._symbolLock();i&&this._needApplySymbol(t)&&!this._muted&&this._setGroupSymbol(t),(i||e===this._boundChartWidget)&&this.watchedSymbol.setValue(t)}_watchedIntervalListener(e){const t=o.Interval.normalize(e);t&&this._needApplyInterval(t)&&!this._muted&&this._setGroupInterval(t)}_updateIntervalByProperty(e,t){const i=this._intervalLock(),s=o.Interval.normalize(t);i&&s&&this._needApplyInterval(s)&&!this._muted&&this._setGroupInterval(s),(i||e===this._boundChartWidget)&&this.watchedInterval.setValue(s??t)}_sendSnowplowAnalytics(){if(window.user.do_not_track)return;const e=this._mainSeries(),t=()=>{e.dataEvents().symbolResolved().unsubscribe(this,i)},i=i=>{(0,d.getTracker)().then((e=>{if(null===e)return;const t=(0,r.ensureNotNull)(this._chartWidgetCollection),s=t.layout.value(),n=t.metaInfo.uid.value()||"";e.trackChartSymbols(i.pro_name,i.type,s,n,window.user.declared_status===c.UserStatus.Pro)})),e.dataEvents().symbolError().unsubscribe(this,t)};e.dataEvents().symbolResolved().subscribe(this,i,!0),
e.dataEvents().symbolError().subscribe(this,t,!0)}_updateSeriesSymbolInfo(){this.seriesShortSymbol.setValue((0,r.ensureNotNull)(this._boundChartWidget).getSymbol(!0));const e=this._mainSeries().symbolInfo();if(e){const t=e.pro_name||!1;this.proSymbol.setValue(t||this.watchedSymbol.value()),this.ensuredProSymbol.setValue(this.proSymbol.value()),e.aliases&&this.symbolNamesList.setValue(e.aliases);let i=(0,p.allChartStyles)();((0,a.isCloseBasedSymbol)(e)||this._mainSeries().intervalObj().value().is1Tick())&&(i=i.filter((e=>(0,a.isSingleValueBasedStyle)(e)))),this.watchedSupportedChartStyles.setValue(i),this.watchedIntraday.setValue(!!e.has_intraday),this.watchedSeconds.setValue(!!e.has_seconds),this.watchedTicks.setValue(!(0,a.isCloseBasedSymbol)(e)&&!!e["is-tickbars-available"]),this.watchedRange.setValue(!(0,a.isCloseBasedSymbol)(e));const s=e.data_frequency?e.data_frequency:void 0;this.watchedDataFrequencyResolution.setValue(s)}else this.watchedIntraday.setValue(!1),this.watchedSeconds.setValue(!1),this.watchedTicks.setValue(!1),this.watchedRange.setValue(!1),this._mainSeries().isFailed()&&this.ensuredProSymbol.setValue(this.proSymbol.value())}_onChartModelCreated(e){if(!this._boundChartWidget)throw new Error("ChartWidget is undefined");this._chartWidgetBindingState=2,this.watchedSymbol.setValue(this._boundChartWidget.symbolWV().value()),this.watchedSymbol.subscribe(this._watchedSymbolListenerBound);const t=e.mainSeries().dataEvents();t.symbolResolved().subscribe(this,this._updateSeriesSymbolInfo),t.symbolError().subscribe(this,this._updateSeriesSymbolInfo),e.mainSeries().onIntervalChanged().subscribe(this,this._updateSeriesSymbolInfo),this._updateSeriesSymbolInfo(),this.watchedInterval.setValue(this._boundChartWidget.resolutionWV().value()),this.watchedInterval.subscribe(this._watchedIntervalListenerBound),this._boundChartWidget.readOnly()&&(this.watchedSymbol.writeLock=!0)}_chartToBind(){const e=this._chartWidgetCollection;return null===e?null:e.activeChartWidget.value().linkingGroupIndex().value()===this._groupIndex?e.activeChartWidget.value():null!==this._boundChartWidget&&this._boundChartWidget.linkingGroupIndex().value()===this._groupIndex?this._boundChartWidget:e.getAll().find((e=>e.linkingGroupIndex().value()===this._groupIndex))??null}_symbolLock(){return!!this._chartWidgetCollection?.lock.symbol.value()}_intervalLock(){return!!this._chartWidgetCollection?.lock.interval.value()}_chartsForLock(e){return(0===e?this._symbolLock():this._intervalLock())?(0,r.ensureNotNull)(this._linkingGroupCharts).value():this._boundChartWidget?[this._boundChartWidget]:[]}_setGroupSymbol(e){this.mute(!0),this._setGroupSymbolCancellationToken.cancelled=!0;const t=this._setGroupSymbolCancellationToken={cancelled:!1};(0,r.ensureNotNull)(this._chartWidgetCollection).setSymbol(e,this._groupIndex,(0,r.ensureNotNull)(this._boundChartWidget)).finally((()=>{if(this._boundChartWidget&&!t.cancelled){const t=this._boundChartWidget.model().mainSeries();t.symbolSameAsCurrent(e)||(this.watchedSymbol.setValue(t.symbol()),
this.proSymbol.setValue(t.proSymbol()))}})),this.mute(!1)}_needApplySymbol(e){const t=this._chartsForLock(0),i=t.find((t=>t.hasModel()&&t.model().mainSeries().symbolInfo()&&t.model().mainSeries().symbolSameAsResolved(e)));if(i){const e=i.model().mainSeries();if(t.every((t=>e.symbolSameAsResolved(t.symbolWV().value()))))return!1}return t.some((t=>t.symbolWV().value()!==e))}_setGroupInterval(e){this.mute(!0),(0,r.ensureNotNull)(this._chartWidgetCollection).setResolution(e,this._groupIndex).finally((()=>{if(this._boundChartWidget){const t=this._boundChartWidget.resolutionWV().value();o.Interval.isEqual(t,e)||this.watchedInterval.setValue(t)}})),this.mute(!1)}_needApplyInterval(e){return this._chartsForLock(1).some((t=>!o.Interval.isEqual(t.resolutionWV().value(),e)))}}const g=new class{constructor(){this._watchedSymbol=new n.WatchedValue,this._seriesShortSymbol=new n.WatchedValue,this._proSymbol=new n.WatchedValue,this._ensuredProSymbol=new n.WatchedValue,this._watchedInterval=new n.WatchedValue,this._watchedIntraday=new n.WatchedValue,this._watchedSeconds=new n.WatchedValue,this._watchedTicks=new n.WatchedValue,this._watchedDataFrequencyResolution=new n.WatchedValue,this._watchedRange=new n.WatchedValue,this._watchedSupportedResolutions=new n.WatchedValue,this._watchedSupportedChartStyles=new n.WatchedValue([]),this._symbolNamesList=new n.WatchedValue,this._chartWidgetCollection=null,this._onSymbolLinkBound=this._onSymbolLink.bind(this),this._searchCharts=null,this._searchChartsLoadDebounced=null,this._selfEmit=!1,this._preventFeedBySymbol=!1,this._feedBySymbolDebounceCounter=0,this._linkingGroups=new Map,this._activeLinkingGroup=new n.WatchedValue,this._activeLinkingGroupIndex=null,this._updateLinkingGroups=()=>{(0,r.ensureNotNull)(this._chartWidgetCollection).allLinkingGroups().value().forEach((e=>this._linkingGroup(e))),this._linkingGroups.forEach((e=>e.updateBoundChartWidget()))},this._activeLinkingGroup.setValue(this._linkingGroup(null));const e=(e,t)=>{e.subscribe((e=>t().setValue(e)),{callWithLast:!0})};e(this._watchedSymbol,(()=>this._activeLinkingGroup.value().watchedSymbol)),e(this._seriesShortSymbol,(()=>this._activeLinkingGroup.value().seriesShortSymbol)),e(this._proSymbol,(()=>this._activeLinkingGroup.value().proSymbol)),e(this._ensuredProSymbol,(()=>this._activeLinkingGroup.value().ensuredProSymbol)),e(this._watchedInterval,(()=>this._activeLinkingGroup.value().watchedInterval)),e(this._watchedIntraday,(()=>this._activeLinkingGroup.value().watchedIntraday)),e(this._watchedSeconds,(()=>this._activeLinkingGroup.value().watchedSeconds)),e(this._watchedTicks,(()=>this._activeLinkingGroup.value().watchedTicks)),e(this._watchedDataFrequencyResolution,(()=>this._activeLinkingGroup.value().watchedDataFrequencyResolution)),e(this._watchedRange,(()=>this._activeLinkingGroup.value().watchedRange)),e(this._watchedSupportedResolutions,(()=>this._activeLinkingGroup.value().watchedSupportedResolutions)),e(this._watchedSupportedChartStyles,(()=>this._activeLinkingGroup.value().watchedSupportedChartStyles)),
e(this._symbolNamesList,(()=>this._activeLinkingGroup.value().symbolNamesList));const t=e=>{this._watchedSymbol.setValue(e.watchedSymbol.value()),this._seriesShortSymbol.setValue(e.seriesShortSymbol.value()),this._proSymbol.setValue(e.proSymbol.value()),this._ensuredProSymbol.setValue(e.ensuredProSymbol.value()),this._watchedInterval.setValue(e.watchedInterval.value()),this._watchedIntraday.setValue(e.watchedIntraday.value()),this._watchedSeconds.setValue(e.watchedSeconds.value()),this._watchedTicks.setValue(e.watchedTicks.value()),this._watchedDataFrequencyResolution.setValue(e.watchedDataFrequencyResolution.value()),this._watchedRange.setValue(e.watchedRange.value()),this._watchedSupportedResolutions.setValue(e.watchedSupportedResolutions.value()),this._watchedSupportedChartStyles.setValue(e.watchedSupportedChartStyles.value()),this._symbolNamesList.setValue(e.symbolNamesList.value())};this._activeLinkingGroup.subscribe(t),t(this._activeLinkingGroup.value()),(0,_.setMuteLinkingGroup)(((e,t)=>{this._linkingGroup(e).mute(t)}))}get symbol(){return this._watchedSymbol}get proSymbol(){return this._proSymbol.readonly()}get ensuredProSymbol(){return this._ensuredProSymbol.readonly()}get symbolNamesList(){return this._symbolNamesList.readonly()}get seriesShortSymbol(){return this._seriesShortSymbol.readonly()}get interval(){return this._watchedInterval}get intraday(){return this._watchedIntraday.readonly()}get seconds(){return this._watchedSeconds.readonly()}get ticks(){return this._watchedTicks.readonly()}get range(){return this._watchedRange.readonly()}get supportedResolutions(){return this._watchedSupportedResolutions.readonly()}get supportedChartStyles(){return this._watchedSupportedChartStyles.readonly()}get preventFeedBySymbol(){return this._preventFeedBySymbol}get dataFrequencyResolution(){return this._watchedDataFrequencyResolution.readonly()}activeLinkingGroup(){return this._activeLinkingGroup.readonly()}getChartWidget(){return this.activeLinkingGroup().value().boundChartWidget()}bindToChartWidgetCollection(e){this._chartWidgetCollection?.onAboutToBeDestroyed.unsubscribeAll(this),this._unbindFromChartWidgetCollection(),this._chartWidgetCollection=e,this._chartWidgetCollection.onAboutToBeDestroyed.subscribe(this,this._unbindFromChartWidgetCollection),this._chartWidgetCollection.allLinkingGroups().subscribe(this._updateLinkingGroups),this._updateLinkingGroups(),this._activeLinkingGroupIndex=e.activeLinkingGroup().spawn(),this._activeLinkingGroupIndex.subscribe((e=>{this._activeLinkingGroup.setValue(this._linkingGroup(e))}),{callWithLast:!0}),this._linkingGroups.forEach((t=>t.bindToChartWidgetCollection(e)))}bindToSearchCharts(e){this.unbindFromSearchCharts(),this._searchCharts=e,e.onSearchBySymbol.subscribe(this,this._onSearchBySymbol),e.loadingSymbol.subscribe((e=>{!1===e&&(this._feedBySymbolDebounceCounter=0)})),this._watchedSymbol.subscribe(this._onSymbolLinkBound)}unbindFromSearchCharts(){this._searchCharts&&(this._searchCharts.onSearchBySymbol.unsubscribe(this,this._onSearchBySymbol),
this._watchedSymbol.unsubscribe(this._onSymbolLinkBound),this._searchCharts=null)}setPreventFeedBySymbol(e){this._preventFeedBySymbol=e}setSymbolAndLogInitiator(e,t,i){(this.symbol.value()!==e||i)&&(m.logInfo(`Change linking symbol to ${e}, initiator: ${t}`),this.symbol.setValue(e,i))}_onSearchBySymbol(e){if(!e.resolved_symbol)throw new Error("no resolved_symbol");this._selfEmit=!0,this._watchedSymbol.setValue(e.resolved_symbol),this._selfEmit=!1}_onSymbolLink(e){if(!this._selfEmit){if(!this._searchCharts){const e="No search charts defined";throw m.logError(e),new Error(e)}this._preventFeedBySymbol||this._loadSearchCharts(e)}}_loadSearchCharts(e){if(!this._searchCharts){const e="No search charts defined";throw m.logError(e),new Error(e)}if(this._searchChartsLoadDebounced)return void(this._feedBySymbolDebounceCounter<100&&(this._feedBySymbolDebounceCounter++,this._searchChartsLoadDebounced(e)));const t=e=>this._searchCharts?(!0===this._searchCharts.loadingSymbol.value()?this._feedBySymbolDebounceCounter<100&&(this._feedBySymbolDebounceCounter++,this._searchChartsLoadDebounced=(0,s.default)(t,2e3),this._searchChartsLoadDebounced(e)):this._searchChartsLoadDebounced=null,this._searchCharts.feedBySymbol.call(this._searchCharts,e)):()=>{};!0===this._searchCharts.loadingSymbol.value()?this._feedBySymbolDebounceCounter<100&&(this._feedBySymbolDebounceCounter++,this._searchChartsLoadDebounced=(0,s.default)(t,2e3),this._searchChartsLoadDebounced(e)):this._searchCharts.feedBySymbol(e)}_linkingGroup(e){let t=this._linkingGroups.get(e);if(void 0===t){const i={watchedSymbol:this._watchedSymbol,seriesShortSymbol:this._seriesShortSymbol,proSymbol:this._proSymbol,ensuredProSymbol:this._ensuredProSymbol,watchedInterval:this._watchedInterval,watchedIntraday:this._watchedIntraday,watchedSeconds:this._watchedSeconds,watchedTicks:this._watchedTicks,watchedDataFrequencyResolution:this._watchedDataFrequencyResolution,watchedRange:this._watchedRange,watchedSupportedResolutions:this._watchedSupportedResolutions,watchedSupportedChartStyles:this._watchedSupportedChartStyles,symbolNamesList:this._symbolNamesList};t=new y(e,i,(()=>this._activeLinkingGroup.value())),this._linkingGroups.set(e,t),this._chartWidgetCollection&&t.bindToChartWidgetCollection(this._chartWidgetCollection)}return t}_unbindFromChartWidgetCollection(){null!==this._chartWidgetCollection&&(this._activeLinkingGroupIndex?.destroy(),this._activeLinkingGroupIndex=null,this._linkingGroups.forEach((e=>e.unbindFromChartWidgetCollection())),this._chartWidgetCollection.allLinkingGroups().unsubscribe(this._updateLinkingGroups),this._chartWidgetCollection=null)}};{const e=(0,u.getFreshInitData)().symbolInfo,t=e?e.pro_symbol:h.getValue("editchart.model.symbol",window.DEFAULT_SYMBOL);g.setSymbolAndLogInitiator(t,"initial data")}window.TradingViewApi||(window.TradingViewApi={linking:g})},971417:(e,t,i)=>{"use strict";function s(e){return e===r(e)}function r(e){const t=e.indexOf("$"),i=e.indexOf("@");return t<0&&i>=0?null:e.substring(Math.max(t+1,0),i>=0?i:e.length)}function n(e){
return e.startsWith("PUB;")}function o(e){return e.startsWith("USER;")}function a(e){return e.startsWith("STD;")}function l(e){return e.includes("Candlestick%1Pattern%1")}function h(e){return e.startsWith("EDGR_")}i.d(t,{extractPineId:()=>r,isCandleStickId:()=>l,isCustomPineId:()=>o,isEdgrPineId:()=>h,isPineIdString:()=>s,isPublishedPineId:()=>n,isStandardPineId:()=>a})},870408:(e,t,i)=>{"use strict";i.d(t,{deletePine:()=>P,getLastVersion:()=>C,getPineFacadeUrl:()=>o.getPineFacadeUrl,getPineSourceCode:()=>v,isAuthToGetPineSourceCode:()=>S,isPubPineInfo:()=>d,isSavedPineInfo:()=>u,isScriptLibrary:()=>p,isScriptStrategy:()=>c,requestBuiltinScripts:()=>w,requestUserScripts:()=>f,translateScriptAsync2:()=>b});var s=i(735566),r=i(345848),n=i(427233),o=i(881992),a=i(971417),l=(i(791488),i(197677)),h=i(603774);function u(e){return"scriptTitle"in e&&"modified"in e}function d(e){return"userId"in e&&"scriptAccess"in e}function c(e){return"strategy"===e.kind}function p(e){return"library"===e.kind}i(129586);const _=(0,s.getLogger)("Chart.Study.Versioning"),m=new n.RequestCache,y=new n.RequestCache,g=new n.SingleRequestCache;async function b(e,t){(0,r.trackEvent)("Pine","ScriptLib.translateScript");const i={};(0,a.isCustomPineId)(e)||(i.user_name=(0,o.getUserName)());try{const s=await(0,l.pineFacadeFetch)({urlPath:`translate/${e}/${t}`,urlParams:i}),r=(0,o.handleTranslateResult)(s);(0,h.logPineMetaInfoIssues)("Pine.translateScriptAsync2",r.metaInfo);return+t<0&&(m.delete(e),y.delete(e),g.clear(),(0,o.onLegacyScriptProceed)(r.metaInfo)),r}catch(e){throw e}}function S(e,t){const i=m.get(e);if(i)return i;(0,r.trackEvent)("Pine","ScriptLib.isAuthToGetPineSourceCode");const s=(0,l.pineFacadeFetch)({urlPath:`is_auth_to_get/${e}/${t}`});return m.set(e,s),s}function v(e,t,i){return(0,r.trackEvent)("Pine","ScriptLib.getPineSourceCode"),(0,l.pineFacadeFetch)({urlPath:`get/${e}/${t}`,urlParams:{no_4xx:i}})}function f(){if((0,r.trackEvent)("Pine","ScriptLib.requestUserScripts"),!window.is_authenticated)return Promise.resolve([]);const e=g.get();if(e)return e;const t=(0,l.pineFacadeFetch)({urlPath:"list",urlParams:{filter:"saved"}});return g.reset(t),t}async function w(){(0,r.trackEvent)("Pine","ScriptLib.requestBuiltinScripts");try{_.logNormal("Request built-in scripts");const e=await(0,l.pineFacadeFetch)({urlPath:"list",urlParams:{filter:"standard"}});return _.logNormal("Request built-in scripts finished"),e}catch(e){throw _.logWarn("Request built-in scripts finished with fail"),e}}function P(e){return(0,r.trackEvent)("Pine","ScriptLib.deletePine"),(0,l.pineFacadeFetch)({method:"POST",urlPath:`delete/${e}`,urlParams:{user_name:(0,o.getUserName)()}}).then((t=>(m.delete(e),y.delete(e),g.clear(),(0,o.onDeleteScript)(e),t)))}async function C(e){(0,r.trackEvent)("Pine","ScriptLib.getLastVersions");try{_.logNormal("Request the last script versions");return(await(0,l.pineFacadeFetch)({method:"GET",urlPath:`versions/${e}/last`}))[0]??null}catch(e){return _.logWarn("Request script versions finished with fail"),null}}(0,
o.applyGlobalScriptListeners)(m,y,g)},881992:(e,t,i)=>{"use strict";i.d(t,{applyGlobalScriptListeners:()=>_,getPineFacadeUrl:()=>h,getUserName:()=>l,handleTranslateResult:()=>d,onDeleteScript:()=>c,onLegacyScriptProceed:()=>p});var s=i(251954),r=i(226722),n=i(791488),o=i(401843),a=i(129586);function l(){return window.user&&window.user.username}function h(){const e=new URL(window.PINE_URL,location.origin);return e.pathname.endsWith("/")||(e.pathname+="/"),e.href}function u(e){if("object"==typeof e.reason)return e.reason;if(e.reason2)return e.reason2;const t={errors:[],warnings:[]};if((0,a.hasMetaInfo)(e.result)){const i=e.result&&e.result.metaInfo;i&&void 0!==i.warnings&&i.warnings.forEach((e=>t.warnings.push({message:e})))}if(e.reason){(Array.isArray(e.reason)?e.reason:e.reason.split("\n")).forEach((e=>{const i=e.match(n.RE_MESSAGE_LINE_WITH_DIGITS),s=i&&i.length&&Number(i[1]),r={message:e};if("number"==typeof s){r.start={line:s,column:0};const e=r.message.split(": ");e.shift(),r.message=e.join(": ")}t.errors.push(r)}))}return t}function d(e){if(e.success)return{success:e.success,metaInfo:e.result.metaInfo,compileErrors:u(e)};throw new o.PineCompileFailErrorImpl(u(e),e.result.metaInfo)}function c(e){const t={scriptIdPart:e};r.TVXWindowEvents.emit(n.TV_SCRIPT_DELETED,JSON.stringify(t)),s.emit(n.TV_SCRIPT_DELETED,t),setTimeout((async()=>{const e=await(window.scriptUpdater?.());await(e?.onTVScriptDeleted({...t,isSelfCall:!0}))}))}function p(e){const t={scriptMetaInfo:e};r.TVXWindowEvents.emit(n.TV_SCRIPT_LEGACY_PINE_PROCESSED,JSON.stringify(t)),s.emit(n.TV_SCRIPT_LEGACY_PINE_PROCESSED,t),setTimeout((async()=>{const e=await(window.scriptUpdater?.());e?.onTVScriptLegacyPineProcessed(t)}))}function _(e,t,i){r.TVXWindowEvents.on(n.TV_SCRIPT_MODIFICATION_ACTIVE,(async e=>{const t=await(window.scriptUpdater?.());t?.onModifyScriptActiveChanged(JSON.parse(e))})),r.TVXWindowEvents.on(n.TV_SCRIPT_MODIFIED,(async e=>{i.clear();const t=await(window.scriptUpdater?.());t?.onTVScriptModified(JSON.parse(e))})),r.TVXWindowEvents.on(n.TV_SCRIPT_DELETED,(async s=>{e.clear(),t.clear(),i.clear();const r=await(window.scriptUpdater?.());await(r?.onTVScriptDeleted(JSON.parse(s)))})),r.TVXWindowEvents.on(n.TV_SCRIPT_RENAMED,(async e=>{i.clear();const t=await(window.scriptUpdater?.());t?.onTVScriptRenamed(JSON.parse(e))})),r.TVXWindowEvents.on(n.TV_SCRIPT_LEGACY_PINE_PROCESSED,(async e=>{i.clear();const t=await(window.scriptUpdater?.());t?.onTVScriptLegacyPineProcessed(JSON.parse(e))}))}},934440:(e,t,i)=>{"use strict";const s=i(931924);window.TradingView=window.TradingView||{};var r,n,o,a,l,h,u,d=(n=Object.create(null),o=Object.create(null),a=Object.create(null),l=0,h=0,u="TradingView",window.addEventListener&&window.addEventListener("message",(function(e){var t;try{t=JSON.parse(e.data),s.enabled("charting_library_debug_mode")&&console.log(`${(new Date).toISOString()} PostMessage: incoming message: `+JSON.stringify(t))}catch(e){return}if(t&&t.provider&&t.provider===u)if("get"===t.type){if(!o[t.name])return;o[t.name].forEach((function(e){
"function"==typeof e&&e.call(t,t.data,(function(e){var i={id:t.id,type:"on",name:t.name,client_id:t.client_id,data:e,provider:u};r.postMessage(JSON.stringify(i),"*")}))}))}else if("on"===t.type)n[t.client_id]&&n[t.client_id][t.id]&&(n[t.client_id][t.id].call(t,t.data),delete n[t.client_id][t.id]);else if("post"===t.type){if(!o[t.name])return;o[t.name].forEach((function(e){"function"==typeof e&&e.call(t,t.data,(function(){}))}))}})),function(e,t){n[t]=Object.create(null),a[t]=e,r=e;var i="";return{on:function(e,t,i){o[e]&&i||(o[e]=[]),o[e].push(t)},get:function(e,i,s){var r={id:l++,type:"get",name:e,client_id:t,data:i,provider:u};n[t][r.id]=s,a[t].postMessage(JSON.stringify(r),"*")},post:function(e,t,s){var r={id:h++,type:"post",name:t,client_id:i,data:s,provider:u};e&&"function"==typeof e.postMessage&&e.postMessage(JSON.stringify(r),"*")},setClientId:function(e){i=e}}});e.exports=d},62802:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>Z,getBool:()=>k,getFloat:()=>F,getInt:()=>M,getJSON:()=>E,getValue:()=>D,keys:()=>W,keysMask:()=>O,loaded:()=>Y,loadedModel:()=>J,onSync:()=>q,remove:()=>R,setJSON:()=>B,setSettingsAdapter:()=>$,setValue:()=>N,sync:()=>K});var s=i(735566),r=i(125226),n=i(192784),o=(i(638456),i(803912)),a=i(482030),l=i(226722),h=i(49437),u=i(547465),d=i(931924);window.TradingView=window.TradingView||{};const c=["s.tradingview.com","betacdn.tradingview.com"],p=(d.enabled("use_localstorage_for_settings"),"local"===window.environment?5e3:12e4),_=10,m=window.TradingView.onWidget?.()?"tradingview-widget":"tradingview",y=m+".";let g,b,S,v=!1,f=null,w={},P=[];const C=[/^widgetbar\.widget\.watchlist.+/,/.+quicks$/,/^widgetbar\.layout-settings$/,/^ChartSideToolbarWidget\.visible$/,/^onwidget\.watchlist$/,/^chart\.favoriteDrawings$/,/^chart\.favoriteDrawingsPosition$/,/^chart\.favoriteLibraryIndicators$/,/^loadChartDialog.favorites$/,/^ChartFavoriteDrawingToolbarWidget\.visible/,/^trading\.chart\.proterty$/,/^trading_floating_toolbar\.position$/,/^trading\.orderWidgetMode\./,/^symbolWatermark$/,/^pinereference\.size$/,/^pinereference\.position$/,/^hint\.+/,/^ChartDrawingToolbarWidget\.visible/];const A=()=>!(f||window.is_authenticated),T=e=>y+e,I=(0,s.getLogger)("Lib.TVSettings"),V=e=>{if(v||S)return;if((0,r.isFeatureEnabled)("disable_save_settings"))return void I?.logWarn("Settings flashing has been skipped because of disable_save_settings featuretoggle");if(d.enabled("widget"))return;if(A())return;if(0===P.length)return;const t=P;P=[];const i={};for(let e=t.length;e--;){const s=t[e];i[s]=w[s]??null}const s=new FormData;s.append("delta",JSON.stringify(i)),e&&navigator.sendBeacon?navigator.sendBeacon("/savesettings/",s):(0,o.fetch)("/savesettings/",{method:"POST",credentials:"include",body:s}).then((i=>{if(i.ok||(P=P.concat(t)),[429,503].includes(i.status)){const t=1e3*+(i.headers.get("retry-after")||0)||3e5;S=setTimeout((()=>{S=void 0,V(e)}),t)}})).catch((()=>{P=P.concat(t)}))},L=()=>{g=void 0,P.length&&V()},x=(e,t={})=>{if(f)null==w[e]?f.removeValue(e):f.setValue(e,w[e]);else if(A())try{
null==w[e]?h.TVLocalStorage.removeItem(T(e)):h.TVLocalStorage.setItem(T(e),w[e])}catch(e){}else P.push(e),g||(g=setTimeout(L,p));t.skipCrossWindowEvent||l.TVXWindowEvents.emit("settings",JSON.stringify({key:e,value:w[e]}))};function D(e,t){const i=w[e];return i??t}function E(e,t){const i=D(e);if(null==i)return t;try{return JSON.parse(i)}catch(i){return R(e),t}}function R(e,t={}){return null!=w[e]&&(delete w[e],x(e)),t.forceFlush&&V(),X}function k(e,t){const i=D(e);return null==i?t:!(!i||"false"===i||0==+i)}function F(e,t){const i=D(e);if(null==i)return t;const s=parseFloat(i);if(!isFinite(s))throw new TypeError('"'+i+'" is not float (key: "'+e+'")');return s}function M(e,t){const i=D(e);if(null==i)return t;const s=parseInt(i,10);if(!isFinite(s))throw new TypeError('"'+i+'" is not int (key: "'+e+'")');return s}function N(e,t,i={}){const s=""+t;return w[e]!==s&&(w[e]=s,x(e,i)),i.forceFlush&&!b&&(b=setTimeout((()=>{b=void 0,V()}),_)),X}function B(e,t,i){return N(e,JSON.stringify(t),i),X}function W(){return Object.keys(w)}function O(e){const t=W(),i=[],s=new RegExp("^"+(0,a.regExpEscape)(e).replace(/\\\*\\\*/gi,".+").replace(/\\\*/gi,"[^.]+")+"$","gi");for(let e=t.length-1;e>=0;e--)s.test(t[e])&&i.push(t[e]),s.lastIndex=0;return i}l.TVXWindowEvents.on("settings",(e=>{const t=JSON.parse(e);null==t.value?delete w[t.key]:w[t.key]=t.value}));const U=e=>{for(let t=0;t<C.length;++t)if(C[t].exec(e))return!0;return!1},z=e=>e.substring(0,y.length)===y,j=()=>{w={};const e=!d.enabled("save_chart_properties_to_local_storage");for(let t=h.TVLocalStorage.length;t--;){const i=h.TVLocalStorage.key(t);if(!i||!z(i))continue;const s=i.substring(y.length);e&&!U(s)||(w[s]=h.TVLocalStorage.getItem(i))}},G=e=>{w={};const t=0===Object.keys(e).length;t||(e=>{Object.keys(e).forEach((t=>{w[t]=e[t]+""}))})(e),(e=>{for(let t=h.TVLocalStorage.length;t--;){const i=h.TVLocalStorage.key(t);i&&z(i)&&(e&&N(i.substring(y.length),h.TVLocalStorage.getItem(i)),h.TVLocalStorage.removeItem(i))}})(t)},H=()=>{if(!window.TradingView.onWidget?.()||!c.includes(window.location.host))return;const e="tradingview.";for(let t=h.TVLocalStorage.length;t--;){const i=h.TVLocalStorage.key(t);if(0===i.indexOf(e)){const t=i.replace(e,m+".");h.TVLocalStorage.setItem(t,h.TVLocalStorage.getItem(i)),h.TVLocalStorage.removeItem(i)}}},q=new u.Delegate;function K(e){null!==e?(f?G(f.initialSettings||{}):A()?(H(),j()):G(e||{}),q.fire()):v=!0}function $(e){f=e}const Y=!1,J=!1,X={loaded:Y,loadedModel:J,getValue:D,getJSON:E,getBool:k,getFloat:F,getInt:M,setValue:N,setJSON:B,remove:R,keys:W,keysMask:O,sync:K,onSync:q,setSettingsAdapter:$},Z=X;window.TVSettings=X,document.addEventListener("visibilitychange",(()=>{"hidden"!==document.visibilityState&&!0!==document.hidden||V()})),window.addEventListener("pagehide",(()=>{V(!0)})),window.addEventListener("beforeunload",(()=>{V(!0)})),n.flushDelegate.subscribe(null,(()=>{V()})),setTimeout((async()=>{const{clearOldSettings:e}=await i.e(30362).then(i.bind(i,276141));e()}),3e4)},439563:(e,t,i)=>{"use strict";async function s(){
const e=(await Promise.all([i.e(73034),i.e(3567),i.e(36683)]).then(i.bind(i,469449))).getTrackerInstance();return e||null}i.d(t,{getEmbedWidgetTracker:()=>s})},768261:(e,t,i)=>{"use strict";var s;i.d(t,{CompareOption:()=>s}),function(e){e[e.SamePctScale=0]="SamePctScale",e[e.NewPriceScale=1]="NewPriceScale",e[e.NewPane=2]="NewPane",e[e.SameScale=3]="SameScale"}(s||(s={}))},261309:(e,t,i)=>{"use strict";i.d(t,{SYMBOL_LIST_REPOSITORY_BACKEND_SERVICE:()=>s});const s={id:"SymbolListRepositoryBackend"}},708078:(e,t,i)=>{"use strict";function s(e){const t=new Date(e);return t.setMilliseconds(0),t.setSeconds(0),t.setMinutes(0),t.setHours(0),t}function r(e){const t=new Date(e);return t.setMilliseconds(999),t.setSeconds(59),t.setMinutes(59),t.setHours(23),t}function n(e,t=!1){const i=s(e),r=t?function(e){if(e>6)throw new Error("Invalid day is provided");return 0===e?6:e-1}(i.getDay()):i.getDay();return i.setDate(i.getDate()-r),i}function o(e){const t=s(e);return t.setDate(1),t}function a(e){const t=o(e);return t.setMonth(0),t}i.r(t),i.d(t,{resetToDayEnd:()=>r,resetToDayStart:()=>s,resetToMonthStart:()=>o,resetToWeekStart:()=>n,resetToYearStart:()=>a})},853045:e=>{e.exports={}},493239:(e,t,i)=>{"use strict";i.d(t,{DECEMBER:()=>f,FIRST_DAY_OF_WEEK:()=>p,FRIDAY:()=>d,JANUARY:()=>m,JULY:()=>b,LAST_DAY_OF_WEEK:()=>_,MARCH:()=>y,MAY:()=>g,MONDAY:()=>a,NOVEMBER:()=>v,SATURDAY:()=>c,SEPTEMBER:()=>S,SUNDAY:()=>o,THURSDAY:()=>u,TUESDAY:()=>l,WEDNESDAY:()=>h,add_date:()=>F,add_minutes:()=>M,cal_to_utc:()=>Y,clone:()=>B,days_per_year:()=>O,get_cal:()=>q,get_cal_from_unix_timestamp_ms:()=>K,get_cal_utc:()=>$,get_day_of_month:()=>L,get_day_of_week:()=>x,get_day_of_year:()=>D,get_days_in_month:()=>W,get_minutes:()=>V,get_minutes_from_midnight:()=>E,get_minutes_with_hours:()=>R,get_month:()=>T,get_timezone:()=>J,get_year:()=>A,is_leap_year:()=>U,millisecondsPerDay:()=>C,minutesPerDay:()=>w,minutesPerWeek:()=>P,set_hms:()=>k,set_seconds:()=>N,time_seconds:()=>z,time_seconds_diff:()=>j,utc_to_cal:()=>G,utc_to_cal_ts:()=>H});var s=i(685182);const r={0:0,1:31,2:59,3:90,4:120,5:151,6:181,7:212,8:243,9:273,10:304,11:334};class n{constructor(e){this._invalid=!1,this._name=e;let t=s.tzData[e];t||(t={time:[],offset:[]},this._invalid=!0),t.time.length!==t.offset.length&&(t={time:[],offset:[]},this._invalid=!0);const i=t;if(!i.time_utc){const e=t.time,s=t.offset,r=e.length,n=new Array(r);for(let t=0;t<r;t++)e[t]*=1e3,s[t]*=1e3,n[t]=e[t]-s[t];i.time_utc=n}this.tz=i}offset_utc(e){return n.offset(this.tz.time_utc,this.tz.offset,e)}offset_loc(e){return n.offset(this.tz.time,this.tz.offset,e)}name(){return this._name}is_valid(){return!this._invalid}correction_loc(e){const t=this.tz.time,i=this.tz.offset,s=X(t,e);if(s<1)return 0;const r=i[s]-i[s-1];if(r>0){if(e-t[s-1]<=r)return r}return 0}static offset(e,t,i){const s=X(e,i);return-1===s?0:t[s]}}const o=1,a=2,l=3,h=4,u=5,d=6,c=7,p=o,_=c,m=0,y=2,g=4,b=6,S=8,v=10,f=11,w=1440,P=10080,C=864e5;function A(e){return e.getUTCFullYear()}function T(e){return e.getUTCMonth()}function I(e){return e.getUTCHours()}
function V(e){return e.getUTCMinutes()}function L(e){return e.getUTCDate()}function x(e){return e.getUTCDay()+1}function D(e){const t=e.getUTCMonth();let i=r[t];return t>m+1&&U(e.getUTCFullYear())&&(i+=1),i+e.getUTCDate()}function E(e){return 60*I(e)+V(e)}function R(e){return E(e)}function k(e,t,i,s,r,n){e.setUTCHours(t),e.setUTCMinutes(i),e.setUTCSeconds(s),e.setUTCMilliseconds(r),void 0!==n&&function(e,t){const i=e.getTime(),s=t.correction_loc(i);e.setTime(i+s)}(e,n)}function F(e,t){e.setTime(e.getTime()+t*C)}function M(e,t){e.setTime(e.getTime()+60*t*1e3)}function N(e,t){const i=86400,s=t%i<0?-1:0,r=Math.trunc(t/i)+s,n=t-r*i,o=Math.trunc(n/3600),a=Math.trunc(n%3600/60);k(e,o,a,n-3600*o-60*a,0),F(e,r)}function B(e){return new Date(e.getTime())}function W(e,t){let i;switch(e){case 0:case 2:case 4:case 6:case 7:case 9:case 11:i=31;break;case 1:i=28,U(t)&&i++;break;default:i=30}return i}function O(e){return U(e)?366:365}function U(e){return e%4==0&&(e%100!=0||e%400==0)}function z(e){return 1e3*e}function j(e,t){return Q(e)-Q(t)}function G(e,t){return new Date(H(e,t))}function H(e,t){return t+e.offset_utc(t)}function q(e,t,i,s,r,n,o){const a=new Date(Date.UTC(t,i,s,r||0,n||0,o||0)),l=e.offset_utc(+a);return new Date(a.valueOf()-l)}function K(e,t){return new Date(t+e.offset_utc(t))}function $(e,t,i,s=0,r=0,n=0){return new Date(Date.UTC(e,t,i,s,r,n))}function Y(e,t,i){let s=t.getTime();i&&(s+=e.correction_loc(s));return s-e.offset_loc(s)}function J(e){return new n(e)}function X(e,t){const i=e.length;if(0===i)return-1;if(isNaN(t))throw Error("Key is NaN");let s=0,r=i-1,n=Z((s+r)/2);for(;;){if(e[n]>t){if(r=n-1,r<s)return n}else if(s=n+1,r<s)return n<i-1?n+1:-1;n=Z((s+r)/2)}}function Z(e){return 0|e}function Q(e){return e<0?Z(e/1e3)-(e%1e3!=0?1:0):Z(e/1e3)}},931924:(e,t,i)=>{"use strict";var s;i.r(t),i.d(t,{disable:()=>d,enable:()=>u,enabled:()=>l,getAllFeatures:()=>c,setEnabled:()=>h});var r=i(6283);const n=new Map,o=new Map,a=new Set;function l(e){const t=n.get(e);if(void 0!==t)return t;const i=o.get(e);return!!i&&i.some(l)}function h(e,t){n.set(String(e),Boolean(t))}function u(e){h(e,!0)}function d(e){h(e,!1)}function c(){const e=Object.create(null);for(const t of a)e[t]=l(t);return e}!function(){for(const[e,t]of Object.entries(s||(s=i.t(r,2))))if(a.add(e),"subsets"in t)for(const i of t.subsets){a.add(i);let t=o.get(i);void 0===t&&(t=[],o.set(i,t)),t.push(e)}"object"==typeof __initialDisabledFeaturesets&&Array.isArray(__initialDisabledFeaturesets)&&__initialDisabledFeaturesets.forEach(d),"object"==typeof __initialEnabledFeaturesets&&Array.isArray(__initialEnabledFeaturesets)&&__initialEnabledFeaturesets.forEach(u)}()},982367:(e,t,i)=>{"use strict";function s(e,t){return e<=t}function r(e,t){return e>=t}function n(e,t,i){return Math.min(Math.max(e,t),i)}function o(e){return e<0?-1:e>0?1:0}function a(e){if(e<0)return!1;if(e>1e18)return!0;for(let t=e;t>1;t/=10)if(t%10!=0)return!1;return!0}function l(e,t,i){return t-e<=i}function h(e,t,i){return Math.abs(e-t)<i}function u(e){return e<=0?NaN:Math.log(e)/Math.log(10)}
function d(e,t){return e<t?-1:e>t?1:0}function c(e,t=d){if(e.length<1)throw Error("array is empty");let i=e[0];for(let s=0;s<e.length;++s)t(e[s],i)<0&&(i=e[s]);return i}function p(e,t=d){if(e.length<1)throw Error("array is empty");let i=e[0];for(let s=0;s<e.length;++s)t(e[s],i)>0&&(i=e[s]);return i}function _(e){const t=Math.ceil(e);return t%2!=0?t-1:t}function m(e){return e>0?Math.floor(e):Math.ceil(e)}function y(e){return e%2==0}i.r(t),i.d(t,{ceiledEven:()=>_,clamp:()=>n,defComparator:()=>d,equal:()=>h,greaterOrEqual:()=>l,greaterThan:()=>r,isBaseDecimal:()=>a,isEven:()=>y,lessThan:()=>s,log10:()=>u,max:()=>p,min:()=>c,sign:()=>o,toInt:()=>m})},647643:(e,t,i)=>{"use strict";i.d(t,{isDrawingToolbarVisible:()=>l});var s=i(62802),r=i(931924),n=i(820028);const o=!r.enabled("hide_left_toolbar_by_default"),a=s.getBool("ChartDrawingToolbarWidget.visible",o),l=new n.WatchedValue(a)},569897:(e,t,i)=>{"use strict";i.d(t,{makeSnapshotRequest:()=>l,takeChartSnapshot:()=>a,takeChartSnapshotPromise:()=>o});i(142492);var s=i(444372),r=i(229534),n=i(803912);function o(e,t={}){return new Promise(((i,s)=>{a(e,i,s,t).catch(s)}))}async function a(e,t,i,s={}){const r=new FormData;if(void 0!==s.previews)for(const e of s.previews)r.append("previews[]",e);void 0!==s.cme&&r.append("cme",String(s.cme)),void 0!==s.wl&&r.append("wl",String(s.wl)),void 0!==s.onWidget&&r.append("onWidget",String(s.onWidget)),s.isReport&&r.append("isReport",String(s.isReport)),s.asyncSave&&r.append("asyncSave",String(s.asyncSave));const n=window.urlParams;n&&n.locale&&r.append("language",n.locale);const o=e.activeChartWidget.value(),a=o.widgetCustomer();void 0!==a&&r.append("customer",a);const h=o.model().model().timezoneExceptExchange().value()??"exchange";r.append("timezone",h),r.append("symbol",o.model().mainSeries().symbol());const u=await e.clientSnapshot({showHeaderMainSymbol:s.showHeaderMainSymbol}),d=await new Promise((e=>u.toBlob(e)));null!==d&&r.append("preparedImage",d),l(r,t,i,s)}async function l(e,t,o,a={}){try{const l=await(0,n.fetch)("/snapshot/",{body:e,method:"POST",credentials:"same-origin"}),h=await l.text();if(l.ok)t(h);else{if("suspicious_chart_snapshots_error"===h){const e=s.t(null,void 0,i(124760)).format({start_link:'<a class="tv-dialog__link js-send-report-link" href="#" data-issue-type="other">',end_link:"</a>"});a.onInvalidSnapshotImage&&a.onInvalidSnapshotImage();return(0,r.createErrorDialog)({title:s.t(null,void 0,i(161498)),content:e,btnType:"danger"}).then((e=>{e.on("afterOpen",(()=>{i.e(1484).then(i.bind(i,822045)).then((({bugDialogCreationHandler:t})=>{t(),e.$el.find(".js-send-report-link").click((()=>{e.close()}))}))})),e.open()}))}o()}}catch{o()}}},890390:(e,t,i)=>{"use strict";i.d(t,{DefaultProperty:()=>W,allowSavingDefaults:()=>L,cleanUpStateKeys:()=>T,createDefaultsState:()=>I,extractAllPropertiesKeys:()=>x,extractState:()=>E,extractThemedColors:()=>R})
;var s=i(154834),r=i(998034),n=i(936714),o=i(954029),a=i(219780),l=i(352315),h=i(650279),u=i(715943),d=i(182433),c=i(283873),p=i(650151),_=i(724377),m=i(735566),y=i(423783),g=i(61499),b=i(331633),S=i(518594),v=i(547465),f=i(690370),w=i(85858),P=i(905520);const C=(0,m.getLogger)("ThemedDefaults");function A(e){return e.value()===g.StdTheme.Dark?g.StdTheme.Dark:g.StdTheme.Light}function T(e,t,i){for(const s of t)if((0,n.default)(e,s),i){const t=s.split(".");for(t.pop();t.length;){const i=(0,o.default)(e,t);if(!(0,d.default)(i)||0!==Object.keys(i).length)break;(0,n.default)(e,t),t.pop()}}}function I(e,t,i,n){const o=e?w.defaults:w.factoryDefaults,a=t.startsWith("study_")?(0,s.default)(o("study")):{};let l=(0,s.default)(o(t,n));return t.startsWith("study_")&&l.inputs&&delete l.inputs.symbol,"linetoolicon"===t&&e&&(l.icon=(0,w.defaults)(t).icon),"linetooemoji"===t&&e&&(l.emoji=(0,w.defaults)(t).emoji),"linetoolsticker"===t&&e&&(l.sticker=(0,w.defaults)(t).sticker),l=(0,s.default)(l),T(l,i),(0,r.default)(a,l),a}let V=!1;function L(e){V=e}function x(e){const t=Object.keys(e),i=[];return t.forEach((t=>{const s=e[t];if((0,d.default)(s)){x(s).forEach((e=>i.push(`${t}.${e}`)))}else i.push(t)})),i}function D(e,t,i=""){if(1===t.length&&"*"===t[0])return e;const s={};for(const r of t){const n=r.split("."),o=n[0],a=e[o],l=""===i?o:`${i}.${o}`;if(e.hasOwnProperty(o))if(n.length>1){if(!(0,d.default)(a)){C.logError(`path ${l} must be an object, but it is a primitive`);continue}{const e=t.filter((e=>e.startsWith(`${o}.`))).map((e=>e.split(".").slice(1).join(".")));s[o]=D(a,e,l)}}else{if((0,d.default)(a)){C.logError(`path ${l} must be a primitive, but it is an object`);continue}s[o]=a}}return s}function E(e,t,i){if(!e)return{};let s=e;return t&&(s=D(e,t)),i&&T(s,i,!0),s}function R(e,t){const i=x(e),s=[];for(const r of i){const i=(0,o.default)(e,r),n=(0,o.default)(t,r);(0,p.assert)(void 0!==i,`Light theme value for ${r} is undefined`),(0,p.assert)(void 0!==n,`Dark theme value for ${r} is undefined`),s.push({path:r,colors:[i,n]})}return s}function k(e,t){e.includes(t)||e.push(t)}function F(e,t){const i=e.indexOf(t);-1!==i&&e.splice(i,1)}function M(e,t){const i=(0,l.default)(e,((e,i,s)=>{if(void 0===t[s])return e;if(!(0,h.default)(i,t[s]))if((0,d.default)(i)&&(0,d.default)(t[s])){const r=M(i,t[s]);void 0!==r&&(e[s]=r)}else e[s]=i;return e}),{});return(0,u.default)(i)?void 0:i}function N(e){return e===g.StdTheme.Dark?1:0}function B(e,t){if(e===t)return!0;if(typeof e!=typeof t)return!1;if(!(0,c.default)(e)||!(0,c.default)(t))return!1;const i=(0,_.tryParseRgba)(e),s=(0,_.tryParseRgba)(t);return!(!i||!s)&&!!(0,y.colorsAreCloseEnough)(e,t)}class W extends P.Property{constructor(e){
const{defaultName:t,nonThemedDefaultsKeys:i,themedDefaultsKeys:s,excludedDefaultsKeys:n=[],themedColors:o,replaceThemedColorsOnThemeChange:a=!1,allStateKeys:l,excludedStateKeys:h=[],excludedTemplateKeys:u=[],state:d,useUserPreferences:c=!0,saveNonDefaultUserPreferencesOnly:_=!1,ignoreAllowSavingDefaults:m=!1,alwaysSaveDefaultKeys:y=["version"],saveDefaultsConsumer:P=w.saveDefaults,factoryDefaultsSupplier:C=()=>I(!1,t,[],null),schema:T=(0,f.createPropertySchema)(C()),theme:V=b.watchedTheme.spawnOwnership()}=e;super(void 0,T),this._themedColors=[],this._restoreFactoryDefaultsEvent=new v.Delegate,this._replaceThemedColorsOnThemeChange=!1,this._forbidSavingDefaults=!1,this._defaultName=t,this._useUserPreferences=c,this._saveNonDefaultUserPreferencesOnly=_,this._ignoreAllowSavingDefaults=m,this._saveDefaultsConsumer=P,this._factoryDefaultsSupplier=C,this._allStateKeys=l,this._excludedStateKeys=h,this._nonThemedDefaultsKeys=i,this._themedDefaultsKeys=s,this._allDefaultsKeys=i||s?[...i??[],...s??[]]:void 0,this._excludedDefaultsKeys=n,this._excludedTemplateKeys=u,this._themedColors=o,this._alwaysSaveDefaultKeys=y,(0,p.assert)(void 0===this._allDefaultsKeys||0===this._excludedDefaultsKeys.length,"Defaults keys and excluded defaults keys cannot be used at the same time"),(0,p.assert)(void 0===this._allStateKeys||0===this._excludedStateKeys.length,"State keys and excluded state keys cannot be used at the same time"),this._theme=V;const L=A(this._theme);this.merge((0,r.default)(this._factoryDefaultsForTheme((0,S.isStdThemeName)(L)?L:g.StdTheme.Light),this._userSettings(),E(d,l,h))),o&&a&&this.setThemedColors(o),this._restoreFactoryDefaultsEvent=new v.Delegate}destroy(){this._theme?.release(),this._unsubscribeWatchedTheme?.(),super.destroy()}applyTemplate(e,t){this.mergeAndFire(E((0,r.default)((0,s.default)(t),e),this._allStateKeys,this._excludedTemplateKeys))}preferences(){return E(this.state(this._excludedDefaultsKeys),this._allDefaultsKeys)}template(){return E(this.state(void 0,4),void 0,this._excludedTemplateKeys)}mergePreferences(e){this.mergeAndFire(E(e,this._allDefaultsKeys,this._excludedDefaultsKeys))}addExcludedKey(e,t){1&t&&k(this._excludedDefaultsKeys,e),2&t&&k(this._excludedStateKeys,e),4&t&&k(this._excludedTemplateKeys,e)}removeExcludedKey(e,t){1&t&&F(this._excludedDefaultsKeys,e),2&t&&F(this._excludedStateKeys,e)}restoreFactoryDefaults(){const e=this.factoryDefaults();T(e,this._excludedDefaultsKeys),this.mergeAndFire(e),this._defaultName.startsWith("study_")&&!this._defaultName.startsWith("study_VbPFixed")||this.saveDefaults(),this._restoreFactoryDefaultsEvent.fire()}onRestoreFactoryDefaults(){return this._restoreFactoryDefaultsEvent}saveDefaults(){if(!this._useUserPreferences||this._forbidSavingDefaults)return;let e;if(this._saveNonDefaultUserPreferencesOnly){const t=this.state(this._excludedDefaultsKeys),i=this.factoryDefaults();if(e=M(E(t,this._nonThemedDefaultsKeys),E(i,this._nonThemedDefaultsKeys,this._excludedDefaultsKeys)),this._alwaysSaveDefaultKeys.length){const i=E(t,this._alwaysSaveDefaultKeys);e=e??{},
(0,r.default)(e,i)}const s=this.themeDefaults(A(this._theme)),n=this.themeState(),o=M(n,s);(0,u.default)(o)||(e=e??{},(0,r.default)(e,n))}else e=this.preferences();this._saveDefaultsConsumer(this._defaultName,e)}themeDefaults(e){if(this._themedColors)return function(e,t){const i={};for(const{path:s,colors:r}of e)(0,a.default)(i,s,r[N(t)]);return i}(this._themedColors,e===g.StdTheme.Dark?g.StdTheme.Dark:g.StdTheme.Light);return E(this._factoryDefaultsSupplier(),this._themedDefaultsKeys,this._excludedDefaultsKeys)}factoryDefaults(){return this._factoryDefaultsForTheme(A(this._theme))}themeState(){const e=super.state(this._excludedDefaultsKeys),t=this._themedColors;return E(e,t?t.map((e=>e.path)):this._themedDefaultsKeys)}allThemePropertiesAreDefault(e){(0,p.assert)(!!this._themedColors,"This method should not be called if themed colors are not set");return function(e,t,i=[]){for(const s of i){const i=s.path;if(!B((0,o.default)(e,i),(0,o.default)(t,i)))return!1}return!0}(this.themeState(),this.themeDefaults(e),this._themedColors)}clone(e){return new W(this._options())}setThemedColors(e){if(this._themedColors=e,void 0===this._unsubscribeWatchedTheme){const e=()=>{this._updateThemedColors(!1)};this._theme.subscribe(e),this._unsubscribeWatchedTheme=()=>this._theme.unsubscribe(e)}this._updateThemedColors(!0)}applyDefaultThemedProperties(e){this._themedColors&&this.mergeAndFire(this.themeDefaults(e))}state(e,t){return E(super.state([...this._excludedStateKeys,...e??[]],t),this._allStateKeys)}_updateThemedColors(e){if(!this._themedColors)return;const t=A(this._theme),i=t===g.StdTheme.Light?g.StdTheme.Dark:g.StdTheme.Light;for(const s of this._themedColors){const r=(0,p.ensureDefined)(this.childByPath(s.path)),n=s.colors[N(i)];(""===r.value()||!e&&B(r.value(),n))&&r.setValue(s.colors[N(t)])}}_userSettings(){if(!this._useUserPreferences)return;const e=I(!0,this._defaultName,[],null);if(!e)return;return E((0,f.extractStateWithSchema)(e,this._schema,1),this._allDefaultsKeys,this._excludedDefaultsKeys)}_options(){return{defaultName:this._defaultName,factoryDefaultsSupplier:this._factoryDefaultsSupplier,state:this.state(),nonThemedDefaultsKeys:this._nonThemedDefaultsKeys,themedDefaultsKeys:this._themedDefaultsKeys,excludedDefaultsKeys:this._excludedDefaultsKeys,themedColors:this._themedColors,replaceThemedColorsOnThemeChange:this._replaceThemedColorsOnThemeChange,allStateKeys:this._allStateKeys,excludedStateKeys:this._excludedDefaultsKeys,excludedTemplateKeys:this._excludedTemplateKeys,useUserPreferences:this._useUserPreferences,saveNonDefaultUserPreferencesOnly:this._saveNonDefaultUserPreferencesOnly,ignoreAllowSavingDefaults:this._ignoreAllowSavingDefaults,saveDefaultsConsumer:this._saveDefaultsConsumer,alwaysSaveDefaultKeys:this._alwaysSaveDefaultKeys,theme:this._theme.spawnOwnership()}}_childChanged(e,t){super._childChanged(e,t),this._propertyAffectsDefaults(t)&&this.saveDefaults()}_fireMergeAndFireChangedProps(e){this._forbidSavingDefaults=!0,super._fireMergeAndFireChangedProps(e),this._forbidSavingDefaults=!1,
e.some((e=>this._propertyAffectsDefaults(e.pathToRootProperty())))&&this.saveDefaults()}_factoryDefaultsForTheme(e){return(0,r.default)(this._factoryDefaultsSupplier(),this.themeDefaults(e))}_propertyAffectsDefaults(e){return(this._ignoreAllowSavingDefaults||V)&&!this._defaultName.startsWith("replayStudyStrategy")&&(!this._defaultName.startsWith("study_")||this._defaultName.startsWith("study_VbPFixed"))&&(this._allDefaultsKeys&&this._allDefaultsKeys.includes(e)||!this._allDefaultsKeys&&!this._excludedDefaultsKeys?.includes(e))&&(0,P.isPrimitiveType)(this.childByPath(e)?.value())}}},816541:(e,t,i)=>{"use strict";i.d(t,{getIntervalsVisibilitiesForMode:()=>p,isActualInterval:()=>u,makeIntervalsVisibilitiesVisibleAtInterval:()=>l,mergeIntervalVisibilitiesDefaults:()=>c,nonDefaultIntervalsVisibilities:()=>d});var s=i(998034),r=i(154834),n=i(650151),o=i(477786),a=i(266954);function l(e,t){let i=t.multiplier();if(t.isTicks()&&(e.ticks=!0),t.isSeconds()&&(i<60?(e.seconds=!0,e.secondsFrom=Math.min(e.secondsFrom,i),e.secondsTo=Math.max(e.secondsTo,i)):(i=Math.floor(i/60),t=new o.Interval(o.ResolutionKind.Minutes,i))),t.isMinutes())if(i<60)e.minutes=!0,e.minutesFrom=Math.min(e.minutesFrom,i),e.minutesTo=Math.max(e.minutesTo,i);else{const t=Math.floor(i/60);e.hours=!0,e.hoursFrom=Math.min(e.hoursFrom,t),e.hoursTo=Math.max(e.hoursTo,t)}t.isDays()&&(e.days=!0,e.daysFrom=Math.min(e.daysFrom,i),e.daysTo=Math.max(e.daysTo,i)),t.isWeeks()&&(e.weeks=!0,e.weeksFrom=Math.min(e.weeksFrom,i),e.weeksTo=Math.max(e.weeksTo,i)),t.isMonths()&&(e.months=!0,e.monthsFrom=Math.min(e.monthsFrom,i),e.monthsTo=Math.max(e.monthsTo,i)),t.isRange()&&(e.ranges=!0)}function h(e,t,i,s){return e&&s>=t&&s<=i}function u(e,t){const i=t.childs();switch(e.kind()){case o.ResolutionKind.Ticks:return i.ticks.value();case o.ResolutionKind.Seconds:if(e.multiplier()<60)return h(i.seconds.value(),i.secondsFrom.value(),i.secondsTo.value(),e.multiplier());{const t=Math.floor(e.multiplier()/60);return h(i.minutes.value(),i.minutesFrom.value(),i.minutesTo.value(),t)}case o.ResolutionKind.Minutes:if(e.multiplier()<60)return h(i.minutes.value(),i.minutesFrom.value(),i.minutesTo.value(),e.multiplier());{const t=Math.floor(e.multiplier()/60);return h(i.hours.value(),i.hoursFrom.value(),i.hoursTo.value(),t)}case o.ResolutionKind.Days:return h(i.days.value(),i.daysFrom.value(),i.daysTo.value(),e.multiplier());case o.ResolutionKind.Weeks:return h(i.weeks.value(),i.weeksFrom.value(),i.weeksTo.value(),e.multiplier());case o.ResolutionKind.Months:return h(i.months.value(),i.monthsFrom.value(),i.monthsTo.value(),e.multiplier());case o.ResolutionKind.Range:return i.ranges.value()}return(0,n.assert)(!1,`Unsupported resolution: ${e.value()}`),!1}function d(e){const t=Object.keys(e).filter((t=>a.intervalsVisibilitiesDefaults[t]!==e[t]));return 0===t.length?null:t.reduce(((t,i)=>(t[i]=e[i],t)),{})}function c(e){return(0,s.default)((0,r.default)(a.intervalsVisibilitiesDefaults),e??{})}function p(e,t){if(0===t||e.isTicks()&&3===t||e.isRange()&&2===t)return c();let i=!1;const s={ticks:!1,
seconds:!1,minutes:!1,hours:!1,days:!1,weeks:!1,months:!1,ranges:!1},r=e=>e.multiplier();return[{checker:e=>e.isTicks(),getIntervalMultiplier:r,markIntervalAsVisible:(e,t)=>{s.ticks=!0}},{checker:e=>e.isSeconds()&&e.multiplier()<60,getIntervalMultiplier:r,markIntervalAsVisible:(e,t)=>{s.seconds=!0,s.secondsFrom=e,s.secondsTo=t}},{checker:e=>e.isSeconds()&&e.multiplier()>=60,getIntervalMultiplier:e=>Math.floor(e.multiplier()/60),markIntervalAsVisible:(e,t)=>{s.minutes=!0,s.minutesFrom=e,s.minutesTo=t}},{checker:e=>e.isMinutes()&&e.multiplier()<60,getIntervalMultiplier:r,markIntervalAsVisible:(e,t)=>{s.minutes=!0,s.minutesFrom=e,s.minutesTo=t}},{checker:e=>e.isMinutes()&&e.multiplier()>=60,getIntervalMultiplier:e=>Math.floor(e.multiplier()/60),markIntervalAsVisible:(e,t)=>{s.hours=!0,s.hoursFrom=e,s.hoursTo=t}},{checker:e=>e.isDays(),getIntervalMultiplier:r,markIntervalAsVisible:(e,t)=>{s.days=!0,s.daysFrom=e,s.daysTo=t}},{checker:e=>e.isWeeks(),getIntervalMultiplier:r,markIntervalAsVisible:(e,t)=>{s.weeks=!0,s.weeksFrom=e,s.weeksTo=t}},{checker:e=>e.isMonths(),getIntervalMultiplier:r,markIntervalAsVisible:(e,t)=>{s.months=!0,s.monthsFrom=e,s.monthsTo=t}},{checker:e=>e.isRange(),getIntervalMultiplier:r,markIntervalAsVisible:(e,t)=>{s.ranges=!0}}].forEach((s=>{if(s.checker(e)){i=!0;const r=s.getIntervalMultiplier(e);1===t?s.markIntervalAsVisible(r,r):3===t?s.markIntervalAsVisible(r,void 0):s.markIntervalAsVisible(void 0,r)}else(!i&&2===t||i&&3===t)&&s.markIntervalAsVisible(void 0,void 0)})),c(s)}},349811:(e,t,i)=>{"use strict";i.d(t,{LineToolBrushBase:()=>o});var s=i(650151),r=i(318945),n=i(820028);class o extends r.LineDataSource{constructor(){super(...arguments),this._hasEditableCoordinates=new n.WatchedValue(!1),this._finished=!1}pointsCount(){return-1}finished(){return this._finished}finish(){this._finished=!0,this._lastPoint=null,this._normalizePoints(),this.createServerPoints()}hasOnlyOnePoint(){return 1===this._points.length}addPoint(e,t,i){if(this._finished)return!0;if(this._lastPoint=null,this._points.length>0){const t=this._points[this._points.length-1],i=(0,s.ensureNotNull)(this.pointToScreenPoint(t));if((0,s.ensureNotNull)(this.pointToScreenPoint(e)).subtract(i).length()<2)return this._finished}return super.addPoint(e),this._finished}restorePoints(e,t,i){super.restorePoints(e,t,i),this._finished=!0}}},63358:(e,t,i)=>{"use strict";i.d(t,{isLineTool:()=>r});var s=i(130551);function r(e){return(0,s.isObject)(e)&&"isLineTool"in e&&e.isLineTool}},790394:(e,t,i)=>{"use strict";i.d(t,{LineDataSourcePointIndexProperty:()=>r});var s=i(905520);class r extends s.Property{constructor(e,t){super(),this._waitingPointsetUpdate=!1,this._lineSource=e,this._pointIndex=t,this._cachedIndex=this.value()}value(){const e=this._lineSource.points();return 0===e.length?this._cachedIndex:e[this._pointIndex].index}setValue(e){this._cachedIndex=e;const t=this._lineSource.points(),i=e=>{const t=this._lineSource.points()[this._pointIndex];if(t.index===e)return;t.index=e,this._lineSource.startChanging(this._pointIndex,t),
this._setPointImpl(t),this._lineSource.model().updateSource(this._lineSource),this._listeners.fire(this,"");const i=this._lineSource.endChanging(!0,!1);this._lineSource.syncMultichartState(i)};if(0===t.length){const e=()=>{i(this._cachedIndex),this._waitingPointsetUpdate=!1};if(this._waitingPointsetUpdate)return;this._lineSource.pointsetUpdated().subscribe(this,e,!0),this._waitingPointsetUpdate=!0}else i(e)}_setPointImpl(e){this._lineSource.setPoint(this._pointIndex,e)}}},231842:(e,t,i)=>{"use strict";i.d(t,{LineToolPriceAxisView:()=>o});var s=i(650151),r=i(597331),n=i(534328);class o extends r.PriceAxisView{constructor(e,t){super(),this._source=e,this._data=t,this._properties=e.model().properties().childs().scalesProperties}_updateRendererData(e,t,i){e.visible=!1;const s=this._source.model();if(!s.timeScale()||s.timeScale().isEmpty())return;const r=this._source.priceScale();if(null===r||r.isEmpty())return;if(!s.selection().isSelected(this._source)&&!this._source.isForcedDrawPriceAxisLabel())return;if(null===s.timeScale().visibleBarsStrictRange())return;const o=this._source.priceAxisPoints(),a=this._data.pointIndex;if(o.length<=a)return;const l=o[a];if(!isFinite(l.price))return;const h=this._source.ownerSource(),u=null!==h?h.firstValue():null;if(null===u)return;let d=this._data.backgroundPropertyGetter?this._data.backgroundPropertyGetter():null;null===d&&(d=this._getBgColor()),i.background=(0,n.resetTransparency)(d),i.borderColor="#2E84A6",i.textColor=this.generateTextColor(i.background),i.coordinate=r.priceToCoordinate(l.price,u),e.text=this._formatPrice(l.price,u),e.visible=!0}_getBgColor(){return this._active?this._properties.childs().axisLineToolLabelBackgroundColorActive.value():this._properties.childs().axisLineToolLabelBackgroundColorCommon.value()}_formatPrice(e,t){return(0,s.ensureNotNull)(this._source.priceScale()).formatPrice(e,t)}}},515779:(e,t,i)=>{"use strict";i.d(t,{LineDataSourceTimeAxisView:()=>r});var s=i(87521);class r extends s.TimeAxisView{constructor(e,t){super(e.model()),this._active=!1,this._source=e,this._pointIndex=t,this._properties=e.model().properties().childs().scalesProperties}setActive(e){this._active=e}_getBgColor(){return this._active?this._properties.childs().axisLineToolLabelBackgroundColorActive.value():this._properties.childs().axisLineToolLabelBackgroundColorCommon.value()}_getIndex(){if(!this._model.selection().isSelected(this._source))return null;const e=this._source.timeAxisPoints();return e.length<=this._pointIndex?null:e[this._pointIndex].index}_isVisible(){return!0}}},318945:(e,t,i)=>{"use strict";i.d(t,{LineDataSource:()=>$,changePointUndoText:()=>K});var s=i(378338),r=i(86441),n=i(650151),o=i(536794),a=i(251954),l=i(735566),h=i(931924),u=i(482707),d=i(493239),c=i(547465),p=i(586563),_=i(972155),m=i(75060),y=i(234938),g=i(461820),b=i(972806),S=i(347505),v=i(820028),f=i(239949),w=i(306543),P=i(816541),C=i(266954),A=i(388741),T=i(616427),I=i(477786),V=i(905520),L=i(87913),x=i(644036),D=i(744380),E=i(437642),R=i(678949),k=i(418450),F=i(790394);class M extends V.Property{
constructor(e,t){super(),this._lineSource=e,this._pointIndex=t,e.pointAdded().subscribe(this,(e=>{this._pointIndex===e&&this._listeners.fire(this,`${e}`)})),e.pointChanged().subscribe(this,(e=>{this._pointIndex===e&&this._listeners.fire(this,`${e}`)}))}value(){const e=this._lineSource.points()[this._pointIndex].price,t=(0,n.ensureNotNull)(this._lineSource.ownerSource()).formatter();if(t.parse){const i=t.format(e),s=t.parse(i);return s.res?s.value:e}return e}setValue(e){const t=this._lineSource.points()[this._pointIndex];t.price=parseFloat(""+e),this._lineSource.startChanging(this._pointIndex,t),this._lineSource.setPoint(this._pointIndex,t),this._lineSource.model().updateSource(this._lineSource),this._listeners.fire(this,"");const i=this._lineSource.endChanging(!0,!1);this._lineSource.syncMultichartState(i)}}var N=i(515779),B=i(231842),W=i(702067),O=i(772062),U=i(85858),z=i(881727);const j=(0,l.getLogger)("Chart.LineDataSource"),G=h.enabled("datasource_copypaste");class H{constructor(){this._states=[]}start(e){this._states.push(e)}finish(e){const t=(0,n.ensureDefined)(this._states.pop());return s=t,(i=e).length!==s.length?{indexesChanged:!0,pricesChanged:!0}:i.reduce(((e,t,i)=>{const r=s[i];return e.indexesChanged=e.indexesChanged||t.index!==r.index,e.pricesChanged=e.pricesChanged||t.price!==r.price,e}),{indexesChanged:!1,pricesChanged:!1});var i,s}isEmpty(){return 0===this._states.length}}let q=0;const K=new k.TranslatedString("change point",s.t(null,void 0,i(776660)));class $ extends x.DataSource{constructor(e,t,i,s){if(super(s),this.isLineTool=!0,this.version=1,this.toolname="",this.customization={forcePriceAxisLabel:!1,disableErasing:!1,disableSave:!1,showInObjectsTree:!0},this._currentPointsetAndSymbolId=null,this._pointChanged=new c.Delegate,this._pointAdded=new c.Delegate,this._priceAxisViews=[],this._timeAxisViews=[],this._timePoint=[],this._points=[],this._lastPoint=null,this._paneViews=new Map,this._normalizedPointsChanged=new c.Delegate,this._fixedPointsChanged=new c.Delegate,this._changeStatesStack=new H,this._startMovingPoint=null,this._currentMovingPoint=null,this._isActualSymbol=!1,this._isActualInterval=!1,this._isActualCurrency=!1,this._isActualUnit=!1,this._sharingMode=new v.WatchedValue(0),this._onTemplateApplying=new c.Delegate,this._onTemplateApplied=new c.Delegate,this._syncStateExclusions=["interval"],this._definitionsViewModel=null,this._hasEditableCoordinates=new v.WatchedValue(!0),this._syncLineStyleMuted=!1,this._onIsActualIntervalChange=new c.Delegate,this._onPointsetUpdatedDelegate=new c.Delegate,this._onServerUpdateTime=new c.Delegate,this._linkKey=new v.WatchedValue(null),this._serverUpdateTime=null,this._boundCalcIsActualSymbol=this.calcIsActualSymbol.bind(this),this._alignerCache=null,this._alertUndoMode=!1,this._onAlertStatusChanged=()=>{this.updateAllViewsAndRedraw((0,E.sourceChangeEvent)(this.id()))},this._model=e,this._properties=t,this._localAndServerAlertsMismatch=!1,
this._properties.hasChild("interval")||this._properties.addChild("interval",new V.Property(e.mainSeries().interval())),this.calcIsActualSymbol(),this._properties.childs().intervalsVisibilities.subscribe(this,this.calcIsActualSymbol),this._properties.subscribe(this,this.propertiesChanged.bind(this,!1,void 0)),this.zOrderChanged().subscribe(this,this.propertiesChanged.bind(this,!0,void 0)),this._createPointsProperties(),this.pointsCount()>0)for(let e=0;e<this.pointsCount();e++)this._priceAxisViews.push(this.createPriceAxisView(e)),this._timeAxisViews.push(new N.LineDataSourceTimeAxisView(this,e));this._properties.childs().visible.subscribe(this,(e=>{const t=!1===(0,L.hideAllDrawings)().value();e.value()?e.value()&&t&&a.emit("drawing_event",this._id.value(),"show"):(this._model.selection().isSelected(this)&&this._model.selectionMacro((e=>{e.removeSourceFromSelection(this)})),t&&a.emit("drawing_event",this._id.value(),"hide")),this._onSourceHiddenMayChange()})),(0,L.hideAllDrawings)().subscribe(this,this._onSourceHiddenMayChange),this._sessionConnected=this._model.chartApi().isConnected().spawn(),this._sessionConnected.subscribe((e=>{e||(this._currentPointsetAndSymbolId=null)})),this._alertStatus.subscribe(this._onAlertStatusChanged),this._definitionsViewModel=null,this._properties.setNameInOwner((0,z.propertyPathForSource)(this))}destroy(){this._paneViews.forEach(((e,t)=>this._destroyPanePaneViews(t))),this.stop(),null!==this._definitionsViewModel&&(this._definitionsViewModel.destroy(),this._definitionsViewModel=null),null!==this._ownerSource&&(this._ownerSource.currencyChanged().unsubscribeAll(this),this._ownerSource.unitChanged().unsubscribeAll(this),(0,R.isSymbolSource)(this._ownerSource)&&(this._ownerSource.symbolResolved().unsubscribeAll(this),this._ownerSource.isActingAsSymbolSource().unsubscribe(this._boundCalcIsActualSymbol))),this.ownerSourceChanged().unsubscribeAll(this),(0,L.hideAllDrawings)().unsubscribeAll(this),this.deleteAlert(),this._sessionConnected.destroy(),this._alertStatus.unsubscribe(this._onAlertStatusChanged),this._properties.destroy(),super.destroy()}setId(e){super.setId(e),this._properties.setNameInOwner((0,z.propertyPathForSource)(this))}priceScale(){return this._ownerSource?this._ownerSource.priceScale():null}createPriceAxisView(e){return new B.LineToolPriceAxisView(this,{pointIndex:e})}model(){return this._model}symbol(){return this._properties.childs().symbol.value()}linkKey(){return this._linkKey}serverUpdateTime(){return this._serverUpdateTime}setServerUpdateTime(e){this._serverUpdateTime=e,this._onServerUpdateTime.fire()}serverUpdateTimeChanged(){return this._onServerUpdateTime}boundToSymbol(){return!0}isAvailableInFloatingWidget(){return!0}points(){const e=[];for(let t=0;t<this._points.length;t++){const i=this._points[t];e.push({index:i.index,price:i.price,time:i.time})}return this._lastPoint&&e.push(this._correctLastPoint(this._lastPoint)),!this.isFixed()&&this._currentMovingPoint&&this._startMovingPoint&&this._correctPoints(e),e}timeAxisPoints(){return this.points()}priceAxisPoints(){
return this.points()}fixedPoint(){if(!this.isFixed())return;let e;const t=this.priceScale();if(this._positionPercents&&null!==t&&!t.isEmpty()){const i=this._positionPercents,s=this._model.timeScale().width()*i.x,n=t.height()*i.y;e=new r.Point(s,n)}else void 0!==this._fixedPoint&&(e=this._fixedPoint?.clone());if(this._currentMovingPoint&&this._startMovingPoint&&void 0!==e){const t=this._correctFixedPoint(e);t.didCorrect&&(e=t.point)}return e}positionPercents(){return this.isFixed()?this._positionPercents:void 0}clearFixedPoint(){this._fixedPoint=void 0,this._positionPercents=void 0}normalizedPoints(){return this._timePoint}normalizedPointsForCreating(){return this.normalizedPoints()}normalizedPointsChanged(){return this._normalizedPointsChanged}fixedPointChanged(){return this._fixedPointsChanged}geometry(){const e=(0,n.ensureNotNull)(this.priceScale());return this.points().map((t=>{const i=(0,n.ensureNotNull)(this.pointToScreenPoint(t)),s=i.x/this._model.timeScale().width(),o=i.y/e.height();return new r.Point(s,o)}))}widthsProperty(){return this._properties.childs().linesWidths??null}lineColorsProperty(){return this._properties.childs().linesColors??null}backgroundColorsProperty(){return this._properties.childs().backgroundsColors??null}textColorsProperty(){return this._properties.childs().textsColors??null}pointsProperty(){return this._pointsProperty}hasEditableCoordinates(){return this._hasEditableCoordinates}startMoving(e,t,i,s){this.isFixed()&&this.restoreFixedPoint(),this._startMovingPoint=e}move(e,t,i,s){if(i&&(i.shiftOnly()||i.modShift()))if(this.isFixed()){const t=this._alignScreenPointHorizontallyOrVertically((0,n.ensureDefined)(e.screen));this._currentMovingPoint={screen:t}}else{const t=this._alignPointHorizontallyOrVertically((0,n.ensureDefined)(e.logical)),i=(0,n.ensureNotNull)(this.pointToScreenPoint(t));this._currentMovingPoint={logical:t,screen:i}}else this._currentMovingPoint=e;this.updateAllViews((0,E.sourceChangeEvent)(this.id()))}endMoving(e,t,i){let s=!1,r=!1;if(this._currentMovingPoint&&this._startMovingPoint){if(this.isFixed()){const e=this._correctFixedPoint((0,n.ensureDefined)(this._fixedPoint));e.didCorrect&&(this._fixedPoint=e.point,this._fixedPointsChanged.fire())}else{const e=(0,n.ensureDefined)(this._currentMovingPoint.logical),t=(0,n.ensureDefined)(this._startMovingPoint.logical);s=e.index!==t.index,r=e.price!==t.price;if(this._correctPoints(this._points,i)){const e=this._id.value();a.emit("drawing_event",e,"move"),a.emit("drawing_event",e,"points_changed");for(let e=0;e<this._points.length;e++)this._pointChanged.fire(e)}}this._startMovingPoint=null,this._currentMovingPoint=null}const o={indexesChanged:s,pricesChanged:r};return this.isFixed()?(this.calcPositionPercents(),this.updateAllViews((0,E.sourceChangeEvent)(this.id())),o):(s&&this._points.forEach((e=>e.interval=this._model.mainSeries().interval())),this.updateAllViews((0,E.sourceChangeEvent)(this.id())),s&&!e?(this._properties.childs().interval.setValue(this._model.mainSeries().interval()),this._normalizePoints(),
this.createServerPoints()):(this._copyPricesWithoutNormalization(),this._normalizedPointsChanged.fire()),t||!r&&!s||this.synchronizeAlert(!this._alertUndoMode),o)}startMovingPoint(){return this._startMovingPoint?{...this._startMovingPoint}:null}currentMovingPoint(){return this._currentMovingPoint?{...this._currentMovingPoint}:null}changePointUndoText(e){return K}startChanging(e,t){this.isFixed()&&this.restoreFixedPoint(),void 0!==e&&void 0!==t&&(e<this._priceAxisViews.length&&this._priceAxisViews[e].setActive(!0),e<this._timeAxisViews.length&&this._timeAxisViews[e].setActive(!0)),this._changeStatesStack.start(this.points())}endChanging(e,t,i){const s=this._changeStatesStack.finish(this.points());s.indexesChanged&&this._changeStatesStack.isEmpty()?(this._normalizePoints(),t||this.createServerPoints()):(this._copyPricesWithoutNormalization(),this._normalizedPointsChanged.fire()),a.emit("drawing_event",this._id.value(),"points_changed");for(let e=0;e<this._priceAxisViews.length;e++)this._priceAxisViews[e].setActive(!1);for(let e=0;e<this._timeAxisViews.length;e++)this._timeAxisViews[e].setActive(!1);return i||this.synchronizeAlert(!e),s}setPoint(e,t,i,s){if(this._snapTo45DegreesApplicable(i)){const i=0===e?1:e-1;this.snapPoint45Degree(t,this.points()[i])}this._setPoint(e,{...t,interval:this._model.mainSeries().interval()})}getPoint(e){return this.points()[e]||null}alignCrossHairToAnchor(e){return!0}alignCrossHairToMovePoint(){return!1}setLastPoint(e,t,i=!0){return this._lastPoint=i?this._preparePoint(e,t):e,this.updateAllViews((0,E.sourceChangeEvent)(this.id())),this._lastPoint}lastPoint(){return this._lastPoint}getChangePointForSync(e){return this.getPoint(e)}setPoints(e){const t=this._model.mainSeries().interval();this._points=e.map((e=>({...e,interval:e.interval??t})))}isForcedDrawPriceAxisLabel(){return this.customization.forcePriceAxisLabel}clearData(){this._points=[]}denormalizeTimePoints(){let e=[];const t=this._model.mainSeries().interval();for(let i=0;i<this._timePoint.length;i++){const s=this._model.timeScale().denormalizeTimePoint(this._timePoint[i]);if(void 0===s){e=[];break}e.push({index:s,price:this._timePoint[i].price,interval:this._timePoint[i].interval??t})}e.length>0&&(this._points=e)}restorePoints(e,t,i){const s=this._timePoint.length>0&&!(0,o.deepEquals)(this._timePoint,e)[0],r=this._properties.childs().interval.value();this._timePoint=e.map((e=>({...e,interval:e.interval??r})));const n=this._model.mainSeries().interval();this._points=t.map((e=>({...e,interval:n}))),i||this.denormalizeTimePoints(),s&&this._normalizedPointsChanged.fire()}restorePositionPercents(e){this._positionPercents=e,this.restoreFixedPoint()}calcIsActualSymbol(){const e=this.ownerSource();if(null===e)this._isActualSymbol=!1;else{const t=(0,n.ensureNotNull)(e.symbolSource()),i=t.symbolInfo();if(i){this._migrateSymbolProperty(i);const e=this._properties.childs().symbol,s=e.value();if(this._isActualSymbol=t.symbolSameAsCurrent(s),this._isActualSymbol){const r=(0,A.extractLineToolSymbolFromSymbolInfo)(i,t.symbol());(0,
T.areEqualSymbols)(s,r)||(j.logWarn('Possible drawing "migrating" detected from "'+s+'" to "'+r+'"'),j.logWarn("Series symbolInfo: "+JSON.stringify(t.symbolInfo())),j.logWarn(`${(new Error).stack}`)),e.setValue(r)}}}this.calcIsActualInterval(),this.calcIsActualCurrency(),this.calcIsActualUnit(),this._onSourceHiddenMayChange()}calcIsActualCurrency(){const e=this.ownerSource();if(null===e)return void(this._isActualCurrency=!1);let t=this._properties.childs().currencyId.value();if(null!==t){const i=e.symbolSource();"pct"===t&&(this._properties.childs().currencyId.setValue(null),t=null),this._isActualCurrency=t===(0,A.symbolCurrency)(i.symbolInfo(),void 0,!0)}else{const t=(0,n.ensureNotNull)(e.symbolSource());this._isActualCurrency=null!==t.symbolInfo()&&!t.isConvertedToOtherCurrency()}this._onSourceHiddenMayChange()}calcIsActualUnit(){const e=this.ownerSource();if(null===e)return void(this._isActualUnit=!1);const t=this._properties.childs().unitId.value();if(null!==t)this._isActualUnit=t===(0,n.ensureNotNull)(e.symbolSource()).unit();else{const t=(0,n.ensureNotNull)(e.symbolSource());this._isActualUnit=null!==t.symbolInfo()&&!t.isConvertedToOtherUnit()}this._onSourceHiddenMayChange()}calcIsActualInterval(){const e=this._isActualInterval,t=this._properties,i=this._model.mainSeries();this._isActualInterval=(0,P.isActualInterval)(I.Interval.parse(i.interval()),t.childs().intervalsVisibilities),!this._isActualInterval&&this._model.selection().isSelected(this)&&this._model.selectionMacro((e=>e.removeSourceFromSelection(this))),this._isActualInterval!==e&&this._onIsActualIntervalChange.fire(),this._onSourceHiddenMayChange()}paneViews(e){if(this.isSourceHidden())return null;const t=this._getPaneViews(this.isMultiPaneAvailable()?e:void 0);if(null===t)return null;if(1===t.length)return[t[0]];const i=[];for(let e=t.length-1;e>=0;--e)i.push(t[e]);return i}priceAxisViews(e,t){if(this.isFixed())return null;if(t!==this.priceScale()||this.isSourceHidden())return null;if(this._model.lineBeingEdited()===this){const e=this._model.linePointBeingEdited();if(null!==e&&e<this._priceAxisViews.length){const t=this._priceAxisViews.slice(),i=t[e];return t.splice(e,1),t.push(i),t}return this._priceAxisViews}return this._priceAxisViews}timeAxisViews(){if(this.isSourceHidden()||this.isFixed())return null;if(this._model.lineBeingEdited()===this){const e=this._model.linePointBeingEdited();if(null!==e&&e<this._timeAxisViews.length){const t=this._timeAxisViews.slice(),i=t[e];return t.splice(e,1),t.push(i),t}return this._timeAxisViews}return this._timeAxisViews}isSavedInChart(){return!this.customization.disableSave}isSavedInStudyTemplates(){return!1}setSavingInChartEnabled(e){this.customization.disableSave=!e}shouldBeRemovedOnDeselect(){return!1}getOrderTemplate(){return null}getSourceIcon(){return{type:"loadSvg",svgId:"linetool."+this.toolname}}alertId(){return this._alertId}async waitSettingAlertId(){this._pendingAlertIdPromise&&(this._alertId=await this._pendingAlertIdPromise)}async setAlert(e,t={}){
if(!this.canHasAlert())throw new Error("Line data source can not has alert");if(this._pendingAlertIdPromise)return void j.logWarn("Setting alert of line data source will be ignored because alert is already being set");if((0,o.isPromise)(e)){this._pendingAlertIdPromise=e;try{await this.waitSettingAlertId()}finally{delete this._pendingAlertIdPromise}}else this._alertId=e;const i=(0,n.ensureDefined)(this._alertId);this._hasAlert.setValue(!0),this._alertStatus.setValue(1),this._removeAlertSubscriptions(),await this._syncAlertWithAlertFacade(t);const s=this.linkKey().value();s&&!t.sync&&this._syncLineStyleChanges(s,{},i)}async restoreAlert(e,t){if(!this.canHasAlert())throw new Error("Line data source can not has alert");this._alertId=e,this._hasAlert.setValue(!0);try{const e=await this.getAlert();if(!e)return;this._addAlertSubscriptions(e,t)}catch(e){this._removeAlertSubscriptions()}}editAlert(e){this.hasAlert().value()&&(0,_.getChartAlertsFacade)().then((t=>{t.openEditDialog((0,n.ensureDefined)(this._alertId),{dataSourceHub:this._model,actionSource:e,onAborted:e=>{e===b.AlertEditorAbortReason.AlertIsInvalid&&this.removeAlert()}})}))}async getAlert(){try{const e=await this._getChartAlert();if(!e)throw j.logError("Failed to get alert, alert will not be saved with drawing in chart"),new Error("got_no_alert");return e}catch(e){if("not_exists"===e)throw new Error(e);return j.logError(`Getting alert failed: ${e instanceof Error?e.message:e}`),null}}getAlertSync(){if(!this._alertId)return null;const e=(0,_.getChartAlertsFacadeIfCreatedBefore)();return null===e?null:e.getAlertSync(this._alertId)??null}async synchronizeAlert(e=!1){if(this.hasAlert().value()||this._pendingAlertIdPromise)return new Promise(((t,i)=>{setTimeout((async()=>{if(!this._isDestroyed)try{await this.waitSettingAlertId(),0===this._alertStatus.value()&&await this._syncAlertWithAlertFacade(),this.hasAlert().value()&&this._synchronizeAlert(e),t()}catch(e){i(e)}}),0)}))}syncAlert(e){this.hasAlert().value()||this.setAlert(e,{sync:!0})}stateForAlert(){if(!this.canHasAlert())return null;const e=this.state(),t={points:e.points,state:e.state,type:e.type,id:this.idForAlert(),title:this.translatedType(),interval:this._model.mainSeries().interval(),text:this._properties.childs().text?.value()??this._properties.childs().labelText?.value()},i=this._getAlertPlots();return i&&i.length>0&&(t.plots=i),t}getAlertIsActive(){if(!this._alertId)return!1;const e=this.getAlertSync();return Boolean(e&&e.active().value())}detachAlert(){this._removeAlertSubscriptions(),this._hasAlert.setValue(!1),this._alertId=void 0,this._alertStatus.setValue(0)}removeAlert(){this._alertId=void 0,this._hasAlert.setValue(!1),this._alertStatus.setValue(0),this._removeAlertSubscriptions()}deleteAlert(){if(!this.hasAlert().value()||void 0===this._alertId)return;const e=(0,_.getChartAlertsFacadeIfCreatedBefore)();e&&e.deleteAlert(this._alertId),this.removeAlert()}areLocalAndServerAlertsMismatch(){return this._localAndServerAlertsMismatch}showInObjectTree(){return this.customization.showInObjectsTree}
setShowInObjectsTreeEnabled(e){this.customization.showInObjectsTree=e}start(){this.createServerPoints()}processHibernate(){this.canBeHibernated()?this.isStarted()&&this.stop():this.isStarted()||this.start()}canBeHibernated(){return this.isSourceHidden()}onData(e){"pointset_error"!==e.method?e.params.customId===this._currentPointsetIdWithPrefix()&&this._onPointsetUpdated(e.params.plots):j.logError(`Error getting pointset: ${e.params[0]} ${e.params[1]}`)}isBeingEdited(){return this===this._model.lineBeingEdited()}isActualSymbol(){return this._isActualSymbol}isActualCurrency(){return this._isActualCurrency}isActualInterval(){return this._isActualInterval}isActualUnit(){return this._isActualUnit}onIsActualIntervalChange(){return this._onIsActualIntervalChange}setOwnerSource(e){null!==this._ownerSource&&(this._ownerSource.currencyChanged().unsubscribeAll(this),this._ownerSource.unitChanged().unsubscribeAll(this)),null!==this._ownerSource&&(0,R.isSymbolSource)(this._ownerSource)&&(this._ownerSource.symbolResolved().unsubscribe(this,this._boundCalcIsActualSymbol),this._ownerSource.isActingAsSymbolSource().unsubscribe(this._boundCalcIsActualSymbol)),super.setOwnerSource(e),e&&(this.setPriceScale(e.priceScale()),e.currencyChanged().subscribe(this,this.calcIsActualCurrency),e.unitChanged().subscribe(this,this.calcIsActualUnit),this.calcIsActualSymbol(),this._migrateZOrder(),this._updateAlertCreationAvailable()),(0,R.isSymbolSource)(e)&&(e.symbolResolved().subscribe(this,this._boundCalcIsActualSymbol),e.isActingAsSymbolSource().subscribe(this._boundCalcIsActualSymbol))}dataAndViewsReady(){return this._paneViews.size>0}pointAdded(){return this._pointAdded}pointChanged(){return this._pointChanged}pointsetUpdated(){return this._onPointsetUpdatedDelegate}pointToScreenPoint(e){const t=this._model.timeScale(),i=this.priceScale(),s=this.ownerSource()?.firstValue();if(!i||i.isEmpty()||t.isEmpty()||null==s)return null;const n=t.indexToCoordinate(e.index),o=i.priceToCoordinate(e.price,s);return new r.Point(n,o)}screenPointToPoint(e,t){const i=this.priceScale(),s=this.ownerSource()?.firstValue();if(null==s||!isFinite(s)||null===i)return null;const r=this._model.timeScale(),n=t?r.coordinateToFloatIndex(e.x):r.coordinateToIndex(e.x);return{price:i.coordinateToPrice(e.y,s),index:n}}calcMiddlePoint(e,t){return new r.Point((e.x+t.x)/2,(e.y+t.y)/2)}addPoint(e,t,i){const s=this._preparePoint(e,t);return this._addPointIntenal(s,t,i)}addFixedPoint(e){return this._fixedPoint=e,this.calcPositionPercents(),!0}calcPositionPercents(){const e=this.priceScale();if(!e||e.isEmpty()||void 0===this._fixedPoint)return;const t=this._fixedPoint.x/this._model.timeScale().width(),i=this._fixedPoint.y/e.height();return this._positionPercents={x:t,y:i},this._positionPercents}restoreFixedPoint(){this._fixedPoint=this.fixedPoint()}propertiesChanged(e,t){this.calcIsActualInterval(),this.updateAllViewsAndRedraw((0,E.sourceChangeEvent)(this.id())),t||this._syncLineStyleIfNeeded(e),
e||void 0!==this._pendingPropertyChangedEvent||(this._pendingPropertyChangedEvent=setTimeout((()=>{this._pendingPropertyChangedEvent=void 0,a.emit("drawing_event",this._id.value(),"properties_changed")}),0))}state(e){const t={type:this.toolname,id:this.id(),state:this.properties().state(this._propertiesStateExclusions()),points:(0,p.deepCopy)(this._timePoint),zorder:this.zorder(),ownerSource:this.ownerSource()?.id()};return this.linkKey().value()&&(t.linkKey=this.linkKey().value()),0!==this._sharingMode.value()&&(t.sharingMode=this._sharingMode.value()),delete t.state.points,e&&(t.indexes=this._points),this.isFixed()&&(t.positionPercents=this._positionPercents||this.calcPositionPercents()),"version"in this&&1!==this.version&&(t.version=this.version),this._saveAlertIdInState()&&this.hasAlert().value()&&void 0!==this._alertId&&(t.alertId=this._alertId),t}updateAllViews(e){this.isSourceHidden()||"data-source-change"===e.type&&this._ignoreSourceEvent(e)||(this._updateAllPaneViews(e),this._priceAxisViews.forEach((t=>t.update(e))),this._timeAxisViews.forEach((t=>t.update(e))))}updateAllViewsAndRedraw(e){this.updateAllViews(e),this._model.updateSource(this)}tags(){return[this.toolname]}properties(){return this._properties}restoreExternalPoints(e,t){if(this._timePoint=(0,p.deepCopy)(e.points),t.indexesChanged){if(this.properties().childs().interval.setValue(e.interval),!this.isActualSymbol())return this._clearServerPoints(),void this._normalizedPointsChanged.fire();this.createServerPoints()}else{const t=Math.min(this._points.length,e.points.length);for(let i=0;i<t;i++)this._points[i].price=e.points[i].price}this._normalizedPointsChanged.fire()}restoreExternalState(e){this.properties().mergeAndFire(e)}applyTemplate(e){this._onTemplateApplying.fire(e),this._applyTemplateImpl(e),this.calcIsActualSymbol(),this.updateAllViews((0,E.sourceChangeEvent)(this.id())),this.model().lightUpdate(),this._onTemplateApplied.fire()}template(){return this.properties().preferences()}isFixed(){return!1}anchorable(){return!1}isLocked(){const e=this.properties().child("frozen");return void 0!==e&&e.value()}isSourceHidden(){return!this._properties.childs().visible.value()||(0,L.hideAllDrawings)().value()&&this.canBeHidden()||!this._isActualInterval||!this._isActualSymbol||!this._isActualCurrency||!this._isActualUnit}isSynchronizable(){return this.priceScale()===this._model.mainSeries().priceScale()}copiable(){return G}cloneable(){return null!==this._ownerSource&&null!==this._ownerSource.firstValue()}movable(){return!0}allowsMovingBetweenPanes(){return!1}async getPropertyDefinitionsViewModel(){if(null===this._definitionsViewModel){const e=await this._getPropertyDefinitionsViewModelClass();return null===e||this._isDestroyed?null:(this._definitionsViewModel=new e(this._model.undoModel(),this),this._definitionsViewModel)}return this._definitionsViewModel}title(){return this.translatedType()}translatedType(){return O.lineToolsLocalizedNames[this.toolname]??"Line Tool"}name(){return"Line Tool"}createServerPoints(){if(!this._isActualSymbol)return
;if(!this._model.chartApi().isConnected().value())return;if(this._clearServerPoints(),this._model.timeScale().isEmpty())return;if(0===this._timePoint.length&&this._points.length>0&&this._normalizePoints(),!this._readyToCreatePointset())return;const e=this._pointsForPointset();if(0===e.length)return;++q,this._currentPointsetAndSymbolId={pointsetId:q,symbolId:(0,n.ensureNotNull)(this._model.mainSeries().seriesSource().symbolInstanceId())};const t=(0,w.getServerInterval)(this.properties().childs().interval.value());this._model.chartApi().createPointset(this._currentPointsetIdWithPrefix(),"turnaround",this._currentPointsetAndSymbolId.symbolId,t,e,this.onData.bind(this))}finish(){}realign(){this.calcIsActualSymbol(),this.isFixed()||this.isSourceHidden()||this._model.lineBeingCreated()===this||this._model.lineBeingEdited()===this||this._currentPointsetAndSymbolId?.symbolId===this._model.mainSeries().seriesSource().symbolInstanceId()||this._clearServerPoints(),null===this._model.mainSeries().symbolInfo()&&(this._alignerCache=null),this.updateAllViews((0,E.sourceChangeEvent)(this.id()))}stop(){this._clearServerPoints()}restart(){this.isFixed()||(this._currentPointsetAndSymbolId=null,this.createServerPoints())}isStarted(){return null!==this._currentPointsetAndSymbolId}convertYCoordinateToPriceForMoving(e,t){const i=(0,n.ensureNotNull)(this.priceScale());if(i.isEmpty())return null;const s=this.ownerSource(),r=(0,n.ensure)((s||t)?.firstValue());return i.coordinateToPrice(e,r)}syncMultichartState(e){const t={points:this._timePoint,pointPositionPercents:this.positionPercents(),interval:this._model.mainSeries().interval()},i=this.linkKey().value();if(null!==i&&this.isSynchronizable()){const s={model:this._model,linkKey:i,symbol:this._model.mainSeries().symbol(),finalState:t,changes:e};(0,L.finishChangingLineTool)(s)}}enableCurrentIntervalVisibility(){let e=this.properties().childs().intervalsVisibilities.state();void 0!==e&&(e=(0,P.mergeIntervalVisibilitiesDefaults)(e),(0,P.makeIntervalsVisibilitiesVisibleAtInterval)(e,this._model.mainSeries().intervalObj().value()),this.properties().childs().intervalsVisibilities.mergeAndFire(e))}clonePositionOffset(){return this.isFixed()?{barOffset:0,xCoordOffset:20,yCoordOffset:20}:{barOffset:0,xCoordOffset:0,yCoordOffset:-40}}sharingMode(){return this._sharingMode}share(e){this.isSynchronizable()&&this._sharingMode.setValue(e)}syncLineStyleState(e){if(e)return{zOrder:this.zorder()};const{intervalsVisibilities:t,...i}=this.properties().state(this._syncStateExclusions);return{...i,intervalsVisibilities:(0,P.mergeIntervalVisibilitiesDefaults)(t),zOrder:this.zorder()}}moveLineTool(e){const t=this._model.mainSeries().interval();e.forEach(((e,i)=>this._setPoint(i,{...e,interval:t}))),this._normalizePoints()}snapTo45DegreesAvailable(){return!1}alignTo45DegreesPoints(){if(this.snapTo45DegreesAvailable()){const[e,t]=this.points();if(e&&t)return[{...e,pointIndex:0},{...t,pointIndex:1}]}return null}snapPoint45Degree(e,t,i){
const s=this._model.timeScale(),r=s.indexToCoordinate(t.index),o=s.indexToCoordinate(e.index)-r,a=(0,n.ensureNotNull)(this.priceScale()),l=t.price,h=e.price,u=(0,n.ensureNotNull)((0,n.ensureNotNull)(this.ownerSource()).firstValue()),d=a.priceToCoordinate(l,u),c=a.priceToCoordinate(h,u)-d,p=Math.round(Math.atan2(o,c)/Math.PI*4);if(2===Math.abs(p))i||(e.price=l);else if(0===Math.abs(p)||4===Math.abs(p))i||(e.index=t.index);else{const t=Math.sqrt(o*o+c*c),i=o<0?-1:1,n=c<0?-1:1;let l=Math.max(Math.abs(c),Math.abs(o));l/=l*Math.sqrt(2)/t;const h=Math.round(s.coordinateToIndex(r+l*i)),p=Math.abs(s.indexToCoordinate(h)-r),_=a.coordinateToPrice(d+p*n,u);e.index=h,e.price=_}}_ignoreSourceEvent(e){return e.sourceId!==this.id()}_pointsForPointset(){return this._timePoint.map((e=>e.interval?[e.time_t,e.offset,(0,w.getServerInterval)(e.interval)]:[e.time_t,e.offset]))}_setPoint(e,t){this._points[e]&&(this._points[e].index===t.index?this._points[e].price=t.price:this._points[e]=t,this._pointChanged.fire(e))}_correctLastPoint(e){return(0,o.clone)(e)}_snapTo45DegreesApplicable(e){return this.snapTo45DegreesAvailable()&&(e?.shift()||(0,L.alignTo45Degrees)().value())}_normalizePoint(e,t){return{...this._model.timeScale().normalizeBarIndex(e.index),price:e.price,interval:e.interval}}_normalizePointWithoutOffset(e){const t=this._model.timeScale().indexToTimePoint(e.index)??this._utcTimeInCurrentResolution(e);return null===t?null:{price:e.price,time_t:t,offset:0,interval:e.interval}}_normalizePoints(){let e=[];const t=this._model.mainSeries().interval();for(let i=0;i<this._points.length;i++)if(I.Interval.isEqual(this._points[i].interval,t)){if(void 0!==this._points[i].index){const t=this._normalizePoint(this._points[i],i);if(!t.time_t){e=[];break}e.push(t)}}else e.push({...this._timePoint[i],price:this._points[i].price});this._timePoint=e,this._normalizedPointsChanged.fire()}_getStartBarAligner(){const e=this._model.mainSeries().interval();if(null===this._alignerCache||this._alignerCache.resolution!==this._model.mainSeries().interval()){const t=this._model.mainSeries().symbolInfo();if(!t)return null;this._alignerCache={resolution:e,aligner:(0,u.createTimeToBarTimeAligner)(e,t)}}return this._alignerCache.aligner}_utcTimeInCurrentResolution(e){if(void 0!==e.time){const t=this._model.timezoneExceptExchange().value();if(null!==t){const i=(0,d.cal_to_utc)((0,d.get_timezone)(t),new Date(1e3*e.time)),s=this._getStartBarAligner();return s?s(i)/1e3:null}}return null}_setPaneViews(e,t,i){if(this._isDestroyed)for(const t of e)t.destroy&&t.destroy();else this._paneViews.set(t,e),void 0!==t&&i&&t.onDestroyed().subscribe(this,(()=>this._destroyPanePaneViews(t))),this._model.lightUpdate()}_getPaneViews(e){return this._paneViews.get(e)||null}_updateAllPaneViews(e){this._paneViews.forEach((t=>{for(const i of t)i.update(e)}))}_alignPointHorizontallyOrVertically(e){const t=(0,n.ensureNotNull)(this.pointToScreenPoint(e)),i=(0,n.ensureDefined)((0,n.ensureNotNull)(this._startMovingPoint).logical),s=(0,n.ensureDefined)((0,
n.ensureNotNull)(this._startMovingPoint).screen),r=Math.abs(s.x-t.x),o=Math.abs(s.y-t.y);if(r<10&&o<10)return e;return{index:r<o?i.index:e.index,price:r<o?e.price:i.price}}_alignScreenPointHorizontallyOrVertically(e){const t=(0,n.ensureDefined)((0,n.ensureNotNull)(this._startMovingPoint).screen),i=Math.abs(t.x-e.x),s=Math.abs(t.y-e.y);return i<10&&s<10?e:i<s?new r.Point(t.x,e.y):new r.Point(e.x,t.y)}_correctPoints(e,t){const i=(0,n.ensure)(this._currentMovingPoint?.screen),s=(0,n.ensure)(this._startMovingPoint?.screen),r=i.subtract(s);if(r.length()<1&&!t)return!1;const o=Math.round((0,n.ensure)(this._currentMovingPoint?.logical).index-(0,n.ensure)(this._startMovingPoint?.logical).index);for(const t of e){const e=(0,n.ensureNotNull)(this.pointToScreenPoint(t)).add(r);t.index=t.index+o,t.price=(0,n.ensureNotNull)(this.screenPointToPoint(e)).price}return!0}_correctFixedPoint(e){if(void 0===this._fixedPoint)return{didCorrect:!1,point:e};const t=(0,n.ensureDefined)((0,n.ensureNotNull)(this._currentMovingPoint).screen),i=(0,n.ensureDefined)((0,n.ensureNotNull)(this._startMovingPoint).screen),s=t.subtract(i);return s.length()>=1?{didCorrect:!0,point:e.add(s)}:{didCorrect:!1,point:e}}_currentPointsetIdWithPrefix(){return"pointset_"+(0,n.ensureNotNull)(this._currentPointsetAndSymbolId).pointsetId}_clearServerPoints(){null!==this._currentPointsetAndSymbolId&&this._model.chartApi().isConnected().value()&&this._model.chartApi().removePointset(this._currentPointsetIdWithPrefix()),this._currentPointsetAndSymbolId=null}_createPointProperty(e){const t=this._pointsProperty.childs().points;t.addChild(""+e,new V.Property({}));const i=t[e];i.addChild("price",new M(this,e)),i.addChild("bar",new F.LineDataSourcePointIndexProperty(this,e))}_createPointsProperties(){this._pointsProperty=new V.Property,this._pointsProperty.addChild("points",new V.Property);for(let e=0;e<this.pointsCount();e++)this._createPointProperty(e)}_alignPointToRangeOfActualData(e){const t=(0,n.ensureNotNull)(this._model.mainSeries().bars().firstIndex()),i=(0,n.ensureNotNull)(this._model.mainSeries().bars().lastIndex());let s=Math.max(e.index,t);return s=Math.min(s,i),{...e,index:s}}_migrateSymbolProperty(e){const t=this._properties.childs();if(t.symbolStateVersion.value()<2){const i=(0,n.ensureNotNull)(this.ownerSource()),s=(0,n.ensureNotNull)(i.symbolSource()),r=this._model.mainSeries();if(s===r)return void t.symbolStateVersion.setValueSilently(2);if(null===r.symbolInfo())return;if(null===s.symbolInfo())return;r.symbolSameAsCurrent(t.symbol.value())&&t.symbol.setValueSilently((0,A.extractLineToolSymbolFromSymbolInfo)(e,s.symbol())),t.symbolStateVersion.setValueSilently(2)}}_migrateZOrder(){const e=this._properties.childs();e.zOrderVersion.value()<2&&(this.ownerSource()===this.model().mainSeries()&&this.setZorder(this.zorder()-this.model().mainSeries().obsoleteZOrder()),e.zOrderVersion.setValueSilently(2))}_preparePoint(e,t){const i=e;return this._snapTo45DegreesApplicable(t)&&this.points().length>=2&&this.snapPoint45Degree(i,this.points()[this.points().length-2]),i}
_addPointIntenal(e,t,i){this._points.push({...e,interval:this._model.mainSeries().interval()});const s=this._points.length===this.pointsCount();return s?(this._lastPoint=null,i||(this._normalizePoints(),this.createServerPoints())):this._lastPoint=e,this._pointAdded.fire(this._points.length-1),s}_onSourceHiddenMayChange(){this.isSourceHidden()&&this._model.selectionMacro((e=>{e.removeSourceFromSelection(this)})),this._model.invalidate(f.InvalidationMask.validateAction((()=>{this!==this._model.lineBeingCreated()&&(this._isDestroyed||this.processHibernate())})))}_saveAlertIdInState(){return!0}_onPointsetUpdated(e){if(0===e.length)return;const t=this.properties().childs().interval.value();for(let i=0;i<e.length;i++){const s=e[i],r=this._timePoint[s.index],n={index:s.value[0],time:s.value[1],price:r.price,interval:r.interval??t};this._points.length<=s.index?(this._points.push(n),this._pointAdded.fire(this._points.length-1)):(this._points[s.index]=n,this._pointChanged.fire(s.index))}{const e=this;e.recalculateStateByData&&e.recalculateStateByData()}this._onPointsetUpdatedDelegate.fire(),this.updateAllViewsAndRedraw((0,E.sourceChangeEvent)(this.id()))}_onMainSeriesSymbolResolved(){const e=this.ownerSource();null===e||this._model.mainSeries()===e.symbolSource()||this.isSourceHidden()||this.createServerPoints()}_readyToCreatePointset(){return this._timePoint.length>0}_propertiesStateExclusions(){return[]}_syncLineStyleIfNeeded(e){const t=this.linkKey().value();t&&!this._syncLineStyleMuted&&this._syncLineStyleChanges(t,this.syncLineStyleState(e))}_muteSyncLineStyle(){this._syncLineStyleMuted=!0}_unmuteSyncLineStyleWithoutApplyingChanges(){this.propertiesChanged(),this._syncLineStyleMuted=!1}_applyTemplateImpl(e){e.intervalsVisibilities=(0,P.mergeIntervalVisibilitiesDefaults)(e.intervalsVisibilities);const t=this.properties();t.applyTemplate(e,(0,U.factoryDefaults)(this.toolname.toLowerCase())),t.saveDefaults(),this.propertiesChanged()}_getPropertyDefinitionsViewModelClass(){return Promise.resolve(null)}_getAlertPlots(){return[]}_getUndoHistory(){return this._model.undoModel().undoHistory()}_synchronizeAlert(e){const t=this._getUndoHistory();if(!this._undoCheckpointAlert&&!this._alertUndoMode){const e=t.undoStack().pop();this._undoCheckpointAlert=t.createUndoCheckpoint(),e&&t.undoStack().push(e)}const i=e=>{const t=e.description()!==e.defaultDescription(),i=this._model.mainSeries().stateForAlert();e.startEditing(),e.setSymbol(i.symbolString);const s=(0,n.ensureNotNull)(this.stateForAlert());e.setResolution(s.interval),e.setLineState(s),t||e.resetToDefaultDescription(),e.finishEditing(),this._localAndServerAlertsMismatch=!0},s=()=>{this._alertUndoMode=!0,t.undoToCheckpoint((0,n.ensureDefined)(this._undoCheckpointAlert)),setTimeout((()=>{this._alertUndoMode=!1,this._localAndServerAlertsMismatch=!1}),0)},r=e=>{"not_exists"!==e&&(j.logError("Getting alert failed: "+e),s())},o=e=>{void 0!==this._alertRestartDebounceTimeoutId&&clearTimeout(this._alertRestartDebounceTimeoutId),this._alertRestartDebounceTimeoutId=setTimeout((async()=>{
const t=await(0,_.getChartAlertsFacade)();this._isDestroyed||(t.restartAlert(e,{success:()=>this._localAndServerAlertsMismatch=!1,error:r,complete:()=>delete this._undoCheckpointAlert,actionSource:"drawing_sync"}),delete this._alertRestartDebounceTimeoutId)}),500)};(0,m.canPlaceAlertOnResolution)(this.stateForAlert().interval)?this.getAlert().then((t=>{t?(i(t),e&&o(t)):j.logError("Failed to get alert, drawing and alert are not synchronized")})).catch(r):this._alertUndoMode||((0,y.showGoProAlertsOnSecondsDialog)(),s(),delete this._undoCheckpointAlert)}_linePointsToAlertPlot(e,t,i,s){if(2!==e.length)return j.logError("[Drawing Alert] Wrong points"),null;const r=this._model.timeScale();if(!r||r.isEmpty())return null;const o=this.ownerSource()??this._model.mainSeries();return{type:"LinePlot",title:t||this.translatedType(),timestamp:(0,n.ensureNotNull)(r.indexToTimePoint(0)),offset1:e[0].index,offset2:e[1].index,price1:(0,S.roundAlertValueUsingPrecision)(o,e[0].price),price2:(0,S.roundAlertValueUsingPrecision)(o,e[1].price),extendBackward:i||!1,extendForward:s||!1}}_getAlertCreationAvailable(){return g.alertsAvailable&&super._getAlertCreationAvailable()&&!this._areAlertsOnLineToolProhibited()&&!this._hasAlert.value()}_onAnchoredChange(){if(this.isFixed()){const e=(0,n.ensureNotNull)(this.pointToScreenPoint(this.points()[0]));this.addFixedPoint(e)}else{if(!this._fixedPoint)return;const e=(0,n.ensureNotNull)(this.screenPointToPoint(this._fixedPoint));this._points[0]={...e,interval:this._model.mainSeries().interval()},this.startChanging(),this.setPoint(0,e),this.endChanging(!1,!1),this._timePoint[0]=this._normalizePoint(this._points[0],0),this.clearFixedPoint()}const e=this.linkKey().value();null!==e&&this.isSynchronizable()&&(0,L.restoreLineToolState)({model:this._model,linkKey:e,state:this.state()})}_syncLineStyleChanges(e,t,i){this.anchorable()&&this.isFixed()!==Boolean(this._positionPercents)&&this._onAnchoredChange(),(0,L.changeLineStyle)({linkKey:e,state:t,alertId:i,model:this._model})}static _configureProperties(e){if(this._addCollectedProperties(e),e.hasChild("symbolStateVersion")||e.addChild("symbolStateVersion",new V.Property(1)),e.hasChild("zOrderVersion")||e.addChild("zOrderVersion",new V.Property(1)),e.hasChild("visible")||e.addChild("visible",new V.Property(!0)),e.hasChild("frozen")||e.addChild("frozen",new V.Property(!1)),e.hasChild("symbol")||e.addChild("symbol",new V.Property("")),e.hasChild("currencyId")||e.addChild("currencyId",new V.Property(null)),e.hasChild("unitId")||e.addChild("unitId",new V.Property(null)),e.hasChild("intervalsVisibilities")){const t=(0,o.merge)((0,o.clone)(C.intervalsVisibilitiesDefaults),e.childs().intervalsVisibilities.state());e.removeProperty("intervalsVisibilities"),e.addChild("intervalsVisibilities",new D.IntervalsVisibilitiesProperty(t))}else e.addChild("intervalsVisibilities",new D.IntervalsVisibilitiesProperty(C.intervalsVisibilitiesDefaults));e.hasChild("title")||e.addChild("title",new V.Property("")),
["symbolStateVersion","zOrderVersion","visible","frozen","symbol","currencyId","unitId","symbolInfo","points","interval","title"].forEach((t=>e.addExcludedKey(t,5))),e.hasChild("singleChartOnly")&&e.removeProperty("singleChartOnly"),e.hasChild("font")&&e.removeProperty("font")}static _addCollectedProperties(e){e.hasChild("linewidth")&&e.addChild("linesWidths",new W.LineToolWidthsProperty([(0,n.ensureDefined)(e.child("linewidth"))])),e.hasChild("linecolor")&&e.addChild("linesColors",new W.LineToolColorsProperty([(0,n.ensureDefined)(e.child("linecolor"))])),e.hasChild("backgroundColor")&&e.addChild("backgroundsColors",new W.LineToolColorsProperty([(0,n.ensureDefined)(e.child("backgroundColor"))])),e.hasChild("textColor")&&e.addChild("textsColors",new W.LineToolColorsProperty([(0,n.ensureDefined)(e.child("textColor"))])),e.hasChild("linestyle")&&e.addChild("linesStyles",new W.LineToolCollectedProperty([(0,n.ensureDefined)(e.child("linestyle"))])),["linesWidths","linesColors","backgroundsColors","textsColors","linesStyles"].forEach((t=>{e.addExcludedKey(t,7)}))}_areAlertsOnLineToolProhibited(){return null!==this._ownerSource&&!this._ownerSource.canHasAlertOnLineTools()}_removeAlertSubscriptions(){this._unsubscribeAlertCallbacks?.(),this._unsubscribeAlertCallbacks=void 0}_addAlertSubscriptions(e,t={}){if(void 0!==this._unsubscribeAlertCallbacks)return;const i=this.properties().child("extendLeft"),s=this.properties().child("extendRight"),r=e.destroyed().spawn(),n=e.selected().spawn(),o=e.hovered().spawn(),a=e.active().spawn();a.subscribe((e=>this._alertStatus.setValue(e?2:3)),{callWithLast:!0}),r.subscribe(this.removeAlert.bind(this)),n.subscribe((e=>{this._model.selectionMacro((t=>{e?t.addSourceToSelection(this):t.removeSourceFromSelection(this)}))}),{callWithLast:t.syncFocusFromAlert}),o.subscribe((e=>{const t=this._model.hoveredSource();e&&t!==this?this._model.setHoveredSource(this,null):e||t!==this||this._model.setHoveredSource(null,null)})),void 0!==i&&i.subscribe(this,(()=>this.synchronizeAlert(!1))),void 0!==s&&s.subscribe(this,(()=>this.synchronizeAlert(!1))),this._unsubscribeAlertCallbacks=()=>{r.destroy(),o.destroy(),n.destroy(),a.destroy(),void 0!==i&&i.unsubscribeAll(this),void 0!==s&&s.unsubscribeAll(this)}}_destroyPanePaneViews(e){const t=this._paneViews.get(e);if(void 0!==t)for(const e of t)e.destroy&&e.destroy();void 0!==e&&e.onDestroyed().unsubscribeAll(this),this._paneViews.delete(e)}_copyPricesWithoutNormalization(){const e=Math.min(this._points.length,this._timePoint.length);for(let t=0;t<e;t++)this._timePoint[t].price=this._points[t].price}async _getChartAlert(){const e=await(0,_.getChartAlertsFacade)();return new Promise(((t,i)=>{e.getAlert((0,n.ensureDefined)(this._alertId),{success:t,error:i})}))}async _syncAlertWithAlertFacade(e={}){try{const t=await this.getAlert();if(!t)return;if(this._addAlertSubscriptions(t,e),e.syncAlertFocus){const e=this._model.selection().isSelected(this);t.setSelected(e)}}catch(e){if(e instanceof Error&&"not_exists"===e.message&&this.hasAlert().value()){
this._alertStatus.setValue(0);return void(await(0,_.getChartAlertsFacade)()).removeAlertFromAllChartsSilently(this.id(),(0,n.ensureDefined)(this._alertId))}j.logError("Failed to set alert, alert will not be saved with drawing in chart")}}}},772062:(e,t,i)=>{"use strict";i.d(t,{lineToolsLocalizedNames:()=>r});var s=i(444372);const r={LineTool5PointsPattern:s.t(null,void 0,i(942231)),LineToolABCD:s.t(null,void 0,i(246712)),LineToolArc:s.t(null,void 0,i(659324)),LineToolArrow:s.t(null,void 0,i(511858)),LineToolArrowMarkDown:s.t(null,void 0,i(673193)),LineToolArrowMarkLeft:s.t(null,void 0,i(401949)),LineToolArrowMarkRight:s.t(null,void 0,i(886275)),LineToolArrowMarkUp:s.t(null,void 0,i(162453)),LineToolBalloon:s.t(null,void 0,i(770540)),LineToolComment:s.t(null,void 0,i(309818)),LineToolBarsPattern:s.t(null,void 0,i(381994)),LineToolBezierCubic:s.t(null,void 0,i(77125)),LineToolBezierQuadro:s.t(null,void 0,i(678609)),LineToolBrush:s.t(null,void 0,i(243539)),LineToolCallout:s.t(null,void 0,i(925381)),LineToolCircleLines:s.t(null,void 0,i(584031)),LineToolCypherPattern:s.t(null,void 0,i(193191)),LineToolDateAndPriceRange:s.t(null,void 0,i(247017)),LineToolDateRange:s.t(null,void 0,i(485444)),LineToolDisjointAngle:s.t(null,void 0,i(91544)),LineToolElliottCorrection:s.t(null,void 0,i(980943)),LineToolElliottDoubleCombo:s.t(null,void 0,i(75112)),LineToolElliottImpulse:s.t(null,void 0,i(861114)),LineToolElliottTriangle:s.t(null,void 0,i(872359)),LineToolElliottTripleCombo:s.t(null,void 0,i(76129)),LineToolEllipse:s.t(null,void 0,i(978996)),LineToolExtended:s.t(null,void 0,i(452788)),LineToolFibChannel:s.t(null,void 0,i(659005)),LineToolFibCircles:s.t(null,void 0,i(182330)),LineToolFibRetracement:s.t(null,void 0,i(855986)),LineToolFibSpeedResistanceArcs:s.t(null,void 0,i(633880)),LineToolFibSpeedResistanceFan:s.t(null,void 0,i(202395)),LineToolFibSpiral:s.t(null,void 0,i(239014)),LineToolFibTimeZone:s.t(null,void 0,i(930622)),LineToolFibWedge:s.t(null,void 0,i(485042)),LineToolFlagMark:s.t(null,void 0,i(514600)),LineToolImage:s.t(null,void 0,i(868065)),LineToolFlatBottom:s.t(null,void 0,i(745051)),LineToolAnchoredVWAP:s.t(null,void 0,i(584541)),LineToolGannComplex:s.t(null,void 0,i(844763)),LineToolGannFixed:s.t(null,void 0,i(960707)),LineToolGannFan:s.t(null,void 0,i(748683)),LineToolGannSquare:s.t(null,void 0,i(947460)),LineToolHeadAndShoulders:s.t(null,void 0,i(921928)),LineToolHorzLine:s.t(null,void 0,i(121795)),LineToolHorzRay:s.t(null,void 0,i(325487)),LineToolIcon:s.t(null,void 0,i(37913)),LineToolEmoji:s.t(null,void 0,i(273456)),LineToolSticker:s.t(null,void 0,i(443114)),LineToolInsidePitchfork:s.t(null,void 0,i(141686)),LineToolNote:s.t(null,void 0,i(986631)),LineToolTextNote:s.t(null,void 0,i(794389)),LineToolSignpost:s.t(null,void 0,i(467751)),LineToolParallelChannel:s.t(null,void 0,i(559256)),LineToolPitchfan:s.t(null,void 0,i(234156)),LineToolPitchfork:s.t(null,void 0,i(919634)),LineToolPolyline:s.t(null,void 0,i(401185)),LineToolPath:s.t(null,void 0,i(800371)),LineToolPrediction:s.t(null,void 0,i(920138)),
LineToolPriceLabel:s.t(null,void 0,i(91282)),LineToolArrowMarker:s.t(null,void 0,i(936352)),LineToolPriceRange:s.t(null,void 0,i(768941)),LineToolProjection:s.t(null,void 0,i(375747)),LineToolRay:s.t(null,void 0,i(550318)),LineToolRectangle:s.t(null,void 0,i(426001)),LineToolCircle:s.t(null,void 0,i(191944)),LineToolRegressionTrend:s.t(null,void 0,i(802460)),LineToolRiskRewardLong:s.t(null,void 0,i(674832)),LineToolRiskRewardShort:s.t(null,void 0,i(508075)),LineToolFixedRangeVolumeProfile:s.t(null,{context:"study"},i(925705)),LineToolAnchoredVolumeProfile:s.t(null,{context:"study"},i(689633)),LineToolRotatedRectangle:s.t(null,void 0,i(56820)),LineToolSchiffPitchfork:s.t(null,void 0,i(657681)),LineToolSchiffPitchfork2:s.t(null,void 0,i(942608)),LineToolSineLine:s.t(null,void 0,i(839090)),LineToolText:s.t(null,{context:"tool"},i(691405)),LineToolTextAbsolute:s.t(null,void 0,i(642669)),LineToolThreeDrivers:s.t(null,void 0,i(46982)),LineToolTimeCycles:s.t(null,void 0,i(746852)),LineToolTrendAngle:s.t(null,void 0,i(35757)),LineToolTrendBasedFibExtension:s.t(null,void 0,i(680583)),LineToolTrendBasedFibTime:s.t(null,void 0,i(272159)),LineToolTrendLine:s.t(null,void 0,i(197339)),LineToolInfoLine:s.t(null,void 0,i(715992)),LineToolTriangle:s.t(null,void 0,i(901671)),LineToolTrianglePattern:s.t(null,void 0,i(390148)),LineToolVertLine:s.t(null,void 0,i(529535)),LineToolCrossLine:s.t(null,void 0,i(974334)),LineToolHighlighter:s.t(null,void 0,i(969476)),LineToolPriceNote:s.t(null,void 0,i(297512)),LineToolVbPFixed:s.t(null,void 0,i(840693)),LineToolGhostFeed:s.t(null,void 0,i(546808)),LineToolTable:s.t(null,void 0,i(17981))};r.LineToolTweet=s.t(null,void 0,i(636549)),r.LineToolIdea=s.t(null,void 0,i(215982)),r.LineToolNoteAbsolute=s.t(null,void 0,i(363209))},397007:(e,t,i)=>{"use strict";i.d(t,{lineToolsStudyIds:()=>s});const s={LineToolAnchoredVWAP:"AnchoredVWAP@tv-basicstudies",LineToolRegressionTrend:"RegressionTrend@tv-basicstudies",LineToolFixedRangeVolumeProfile:"VbPFixed@tv-basicstudies",LineToolVbPFixed:"VbPFixed@tv-volumebyprice"};{const e={LineToolAnchoredVolumeProfile:"VbPAnchored@tv-basicstudies"};for(const[t,i]of Object.entries(e))s[t]=i}},774440:(e,t,i)=>{"use strict";i.d(t,{StudyLineDataSource:()=>f,isStudyLineTool:()=>v});var s=i(132565),r=i(318945),n=i(890390),o=i(77295),a=i(196302),l=i(479483),h=i(590178),u=i(808825),d=i(587482),c=i(37241),p=i(437642),_=i(454184),m=i(232915);class y extends m.StatusProviderBase{constructor(e){super(),this._source=e}errorStatus(){const e=this._source.status();return e.type===_.StudyStatusType.Error?{error:this.sourceStatusText(),solutionId:(0,_.studyStatusSolutionId)(e),title:(0,_.studyStatusTitle)(e),studyFeature:(0,_.studyStatusFeature)(e)}:null}getSplitTitle(){return this._source.titleInParts()}text(){return this._source.translatedType()}sourceStatusText(){return(0,_.convertStudyStatusToString)(this._source.status(),!0)}}var g=i(239949),b=i(236578);class S extends b.StatusView{constructor(e){super(e.statusProvider({}))}getSplitTitle(){
return this._statusProvider.getSplitTitle()}}function v(e){return e instanceof f}class f extends r.LineDataSource{constructor(e,t,s,r,n,o){super(e,r,n,o),this._indexes=null,this._inputs=null,this._definitionsViewModel=null,this._pointsetPoints=null,this._loadedPlots=null,this._loadedGraphics=null,this._beingCreatedPaneView=null,this._anchorsPaneView=null,this._isLegendDisplayed=!1,Promise.all([Promise.all([i.e(20700),i.e(63317),i.e(4171),i.e(45038),i.e(62622),i.e(3205),i.e(5262),i.e(51583)]).then(i.bind(i,473410)),Promise.all([i.e(20700),i.e(63317),i.e(4171),i.e(45038),i.e(62622),i.e(3205),i.e(5262),i.e(51583)]).then(i.bind(i,768260))]).then((t=>{const{LineToolBeingCreatedPaneView:i}=t[0],{StudyLineDataSourceAnchorsPaneView:s}=t[1];this._beingCreatedPaneView=new i(this,e),this._anchorsPaneView=new s(this,this.model()),this._model.lightUpdate()})),this._metaInfo=t,this._dataSource=new h.ExtendedStudyDataSource(e.chartApi(),e.mainSeries(),s,t),this._dataSource.dataCleared().subscribe(this,this._onDataCleared),this._dataSource.dataUpdated().subscribe(this,this._onDataUpdated),this._dataSource.studyStatusChanged().subscribe(this,this._onStudyStatusChanged),this._statusProvider=new y(this),this._statusView=new S(this),this._showStudyArgumentsProperty=e.properties().childs().paneProperties.childs().legendProperties.childs().showStudyArguments}isDisplayedInLegend(){return this._isLegendDisplayed}titleInParts(){const e=[];if(this._showStudyArgumentsProperty.value()&&this._inputs)for(const t of this._metaInfo.inputs){if(!0===t.isHidden||"bool"===t.type)continue;const i=this._inputs[t.id];e.push(i.toString())}return[this.name(),e]}destroy(){this._dataSource.dataUpdated().unsubscribeAll(this),this._dataSource.dataCleared().unsubscribeAll(this),this._dataSource.studyStatusChanged().unsubscribeAll(this),this._dataSource.destroy(),null!==this._definitionsViewModel&&(this._definitionsViewModel.destroy(),this._definitionsViewModel=null),this._unsubscribeApplyInputsOnSeriesCompleted(),this._isDestroyed=!0,super.destroy()}stop(){super.stop(),this._isDestroyed||(this._dataSource.stop(),this.clearData())}start(){super.start(),this._isDestroyed||null===this._inputs||this._dataSource.start()}metaInfo(){return this._metaInfo}graphicsInfo(){return this._metaInfo.graphics}series(){return this._model.mainSeries()}translatedType(){return this._metaInfo.description}name(){return this._metaInfo.description}studyId(){return this._metaInfo.id}setPoint(e,t,i){super.setPoint(e,this._preparePoint(t,i))}move(e){}clearData(){this._clearAllDataExceptPointsetPoints(),this._pointsetPoints=null,this.updateAllViews((0,p.sourceChangeEvent)({sourceId:this.id(),clearData:!0})),super.clearData()}data(){return this.plots()}plots(){return this._loadedPlots||this._dataSource.plots()}graphics(){return this._loadedGraphics||this._dataSource.graphics()}valueAt(e,t){return this.ownerSource()?.symbolSource().valueAt(e,t)??null}firstValue(){return this._model.mainSeries().firstValue()}state(e){const t={...super.state(e),metaInfo:this.metaInfo().state()}
;return e&&(t.data=this.plots().state(),t.nonseriesindexes=this._indexes,t.graphics=(0,a.saveStudyGraphics)(this.graphics(),null)),t}restoreData(e){void 0!==e.data&&(this._loadedPlots=new s.PlotList((0,d.studyPlotFunctionMap)(this._metaInfo),d.studyEmptyPlotValuePredicate),this._loadedPlots.restoreState(e.data)),this._indexes=e.nonseriesindexes??this._indexes,this._loadedGraphics=e.graphics?(0,a.loadStudyGraphics)(e.graphics):this._loadedGraphics}getPropertyDefinitionsViewModel(){return null===this._definitionsViewModel?this._getPropertyDefinitionsViewModelClass().then((e=>null===e||this._isDestroyed?null:(null===this._definitionsViewModel&&(this._definitionsViewModel=new e(this._model.undoModel(),this)),this._definitionsViewModel))):Promise.resolve(this._definitionsViewModel)}paneViews(e){let t=[];if(this.isSourceHidden())return t;if(this._isReady()&&this._changeStatesStack.isEmpty()){const i=super.paneViews(e);null!==i&&(t=t.concat(i))}else null!==this._beingCreatedPaneView&&t.push(this._beingCreatedPaneView);return null!==this._anchorsPaneView&&t.push(this._anchorsPaneView),t}propertiesChanged(e){super.propertiesChanged(e),this._onStudyInputsMayChange()}dataAndViewsReady(){return super.dataAndViewsReady()&&this._isReady()}endChanging(e,t){const i=super.endChanging(e,t);return i.indexesChanged?this.clearData():this._updateAnchorsPrice(!0),i}moveData(e){this._dataSource.moveData(e)}restorePoints(e,t,i){super.restorePoints(e,t,i),this._updateAnchorsPrice(!0)}statusProvider(e){return this._statusProvider}statusView(){return this._statusView}legendView(){return null}dataProblemModel(){return null}dataUpdatedModeModel(){return null}marketStatusModel(){return null}onStatusChanged(){return this._dataSource.studyStatusChanged()}status(){return this._dataSource.studyStatus()}recalcStudyIfNeeded(){}static createPropertiesFromStudyMetaInfoAndState(e,t,i,s,r){const n=(0,c.prepareStudyPropertiesForLoadChart)(e,t,i,s,void 0,r);return this._configureProperties(n),n}_getPointsetPoints(){return this._pointsetPoints}_onStudyStatusChanged(e,t){let i;switch(t.type){case u.StudyStatusType.Error:i=!0;break;case u.StudyStatusType.Completed:i=!1;break;default:return}if(i===this._isLegendDisplayed)return;this._isLegendDisplayed=i;const s=this._model.paneForSource(this);if(s){const e=this._model.panes().indexOf(s),t=g.InvalidationMask.invalidateLegendWidgetLayout(e);this.model().invalidate(t)}}_studyId(){return this._dataSource.studyId()}_isReady(){return!0}_updateAllPaneViews(e){super._updateAllPaneViews(e),this._beingCreatedPaneView?.update(),this._anchorsPaneView?.update(e)}_getPointTime(e,t){const i=e.index,s=this._model.timeScale().indexToTimePoint(i);return null!==s?s:t||void 0===e.time?null:this._utcTimeInCurrentResolution(e)}_updateAnchorsPrice(e){}_onPointsetUpdated(e){super._onPointsetUpdated(e),this._pointsetPoints=this._points.map((e=>({price:e.price,index:e.index,time:e.time}))),this._onStudyInputsMayChange()}_onDataCleared(){this.updateAllViews((0,p.sourceChangeEvent)({sourceId:this.id(),clearData:!0})),
this._model.updateSource(this)}_onDataUpdated(e,t,i){this._updateAnchorsPrice(),this.updateAllViews((0,p.sourceChangeEvent)({sourceId:this.id(),firstUpdatedTimePointIndex:e[0]?.index})),this._model.updateSource(this)}_onStudyInputsMayChange(){let e=null;if(null!==this._pointsetPoints&&this._pointsetPoints.length===this.pointsCount()&&(e=this._studyInputs(this._pointsetPoints),null===e&&(this._clearAllDataExceptPointsetPoints(),this.updateAllViews((0,p.sourceChangeEvent)(this.id())))),null!==e){const t=this.metaInfo().inputs.map((e=>e.id)),i=Object.keys(e);for(const s of i)t.includes(s)||delete e[s]}this._areInputsEqual(this._inputs,e)||this._applyStudyInputs(e)}_preparePoint(e,t){return super._preparePoint(this._alignPointToRangeOfActualData(e),t)}_getPropertyDefinitionsViewModelClass(){return Promise.resolve(null)}_subscribeApplyInputsOnSeriesCompleted(){this._unsubscribeApplyInputsOnSeriesCompleted(),this._model.mainSeries().dataEvents().completed().subscribe(this,(()=>this._onStudyInputsMayChange()),!0)}_unsubscribeApplyInputsOnSeriesCompleted(){this._model.mainSeries().dataEvents().completed().unsubscribeAll(this)}_onInputsChanged(){this.hasAlert().value()&&(this._localAndServerAlertsMismatch=!0)}_clearAllDataExceptPointsetPoints(){this._inputs=null,this._dataSource.clearData(),this._loadedPlots=null,this._indexes=null,this._loadedGraphics=null}static _createPropertiesFromStudyIdAndState(e,t){const i=o.StudyMetaInfo.getStudyPropertyRootNameById(e),s=new n.DefaultProperty({defaultName:i,state:t});return this._configureProperties(s),s}static _configureProperties(e){super._configureProperties(e),e.removeExcludedKey("intervalsVisibilities",1)}_areInputsEqual(e,t){return null===t?null===e:null!==e&&(0,l.areStudyInputsEqual)(this._metaInfo.inputs,e,t)}_applyStudyInputs(e){const t=this._inputs;this._inputs=e,null!==e&&(this._unsubscribeApplyInputsOnSeriesCompleted(),this._dataSource.setInputs(e),null===t&&this.isStarted()&&!this._dataSource.isStarted()&&this._dataSource.start()),this._onInputsChanged()}}},700931:(e,t,i)=>{"use strict";const s=i(318945).LineDataSource,r=i(127504).alignToStep,n=(i(191914).customFormatters,i(388741).createSeriesFormatter);class o extends s{constructor(e,t){super(e,t),this.customization.forcePriceAxisLabel=!0,this.customization.disableErasing=!0,this.customization.showInObjectsTree=!1,this._createFormatter(e.mainSeries().symbolInfo()),this.setSelectionEnabled(!1)}isSynchronizable(){return!1}pointsCount(){return o.POINTS_COUNT}hasContextMenu(){return!1}state(){return null}startMoving(){super.startMoving.apply(this,arguments),this._cursorMoved=!1}endMoving(){super.endMoving.apply(this,arguments),this._cursorMoved=!1}userEditEnabled(){return!0}movable(){return!1}canBeHidden(){return!1}isUserDeletable(){return!1}showInObjectTree(){return!1}doesMovingAffectsUndo(){return!1}isAvailableInFloatingWidget(){return!1}timeAxisViews(){return null}cloneable(){return!1}copiable(){return!1}_correctPoints(e,t){
this._currentMovingPoint&&this._startMovingPoint?this._currentMovingPoint.logical.price-this._startMovingPoint.logical.price&&(this._cursorMoved=!0):this._cursorMoved=!1;for(var i=1/this.priceScale().mainSource().base(),s=0;s<e.length;s++){var n=e[s];this._cursorMoved&&(n.price=this._currentMovingPoint.logical.price),n.price=r(n.price,i),e[s]=n}}_createFormatter(e){this._formatter=n(e,"default",!1,!0)}}o.POINTS_COUNT=1,e.exports.LineToolTrading=o},143292:(e,t,i)=>{"use strict";i.d(t,{Series:()=>at});var s=i(650279),r=i(650151),n=i(345848),o=i(251954),a=i(735566),l=i(925049),h=i(470416),u=i(272938),d=i(326488),c=i(132565),p=i(584785),_=i(397535),m=i(905520),y=i(388741),g=i(603798),b=i(89831),S=i(870855),v=i(975643),f=i(656107),w=i(977647),P=i(756163),C=i(477786),A=i(234966),T=i(198229),I=i(686763),V=i(14767),L=i(470171),x=i(259710),D=i(326301),E=i(175203),R=i(545369),k=i(618095),F=i(133325),M=i(456342),N=i(736451),B=i(461820),W=i(31214),O=i(364180),U=i(897197),z=i(991364),j=i(136734),G=i(81622),H=i(761668),q=i(325963),K=i(969455),$=i(2881),Y=i(514294),J=i(480119),X=i(542301),Z=i(3681),Q=i(931924),ee=i(834905),te=i(429906),ie=i(547465),se=i(536794),re=i(616427),ne=i(955722),oe=i(431632),ae=i(515097),le=i(239949),he=i(388433),ue=i(820028),de=i(535422),ce=i(437642),pe=i(596443),_e=i(306543),me=i(933868),ye=i(973592),ge=i(735922),be=i(830101),Se=i(838882),ve=i(529285),fe=i(660729),we=i(983297),Pe=i(638456),Ce=i(351018),Ae=i(5253),Te=i(616332),Ie=i(316661),Ve=i(271747),Le=i(517742),xe=i(868162),De=i(498969),Ee=i(340104),Re=i(998886),ke=i(766409),Fe=i(889858),Me=i(128090),Ne=(i(191914),i(519073)),Be=i(170562),We=i(816433),Oe=i(296538),Ue=i(772783),ze=i(68777),je=i(454184),Ge=i(288789),He=i(176749),qe=i(660603);const Ke=Q.enabled("price_scale_always_last_bar_value"),$e=Q.enabled("display_data_mode"),Ye=!Q.enabled("hide_series_legend_item"),Je=Q.enabled("hide_price_scale_global_last_bar_value"),Xe=Q.enabled("no_bars_status"),Ze=Q.enabled("charting_library_debug_mode"),Qe=Q.enabled("chart_style_hilo_last_price"),et=(0,a.getLogger)("Chart.Series"),tt=be.lastDayChangeAvailable&&Pe.CheckMobile.any()||be.alwaysShowLastPriceAndLastDayChange;let it=!1;const st={countdownEnabled:!0,lastPriceAnimationEnabled:!0};function rt(e,t,i){return void 0===t?null:`${e}=${t} (${i?"changed":"unchanged"})`}function nt(e){const t=e.state();return t.data.forEach((e=>e.value.splice(7,1))),t}function ot(e){const{seriesStatus:t,additionalStudyStatus:i}=e;if(S.seriesLoadingStatuses.has(t))return 2;if(i){if(4!==t&&i.type===je.StudyStatusType.Error)return 13;if(S.seriesReadyStatuses.has(t)&&(i.type===je.StudyStatusType.Loading||i.type===je.StudyStatusType.Undefined))return 2}return t}class at extends h.PriceDataSource{constructor(e,t,o,a){t.removeProperty("currencyId"),super(e,"_seriesId"),this.isSeries=!0,this.requestingStyleIsNotSupported=new ie.Delegate,this.requestingStyleSupportRecovered=new ie.Delegate,this._paneView=null,this._futureBarsPaneView=null,this._projectionBarsPaneView=null,this._waterlineView=null,this._priceLineView=null,
this._gotoDateView=null,this._baseHorizontalLineView=null,this._priceStep=null,this._symbolInfo=new ue.WatchedValue(null),this._isPrePostMarketPricesAvailableProperty=new m.Property(!1),this._isBackAdjustmentForbiddenProperty=new m.Property(!0),this._isSettlementAsCloseForbiddenProperty=new m.Property(!0),this._highLowPriceCache=new Map,this._averagePriceCache=new Map,this._prevClosePriceAxisView=null,this._priceScaleAboutToBeChanged=new ie.Delegate,this._onRestarted=new ie.Delegate,this._onStatusChanged=new ie.Delegate,this._tagsChanged=new ie.Delegate,this._intervalChanged=new ie.Delegate,this._sessionIdChanged=new ie.Delegate,this._requestMoreDataAvailable=!0,this._lineStyleLastPriceCirclePaneView=new ae.LastPriceCirclePaneView(this),this._prevClosePriceLineView=null,this._dataPoweredBy=null,this._symbolResolvingActive=new ue.WatchedValue(!1),this._predictBars=0,this._syncModel=null,this._data=null,this._lastCompleteFlags=null,this._haStyle={studyId:(0,r.ensureNotNull)((0,y.chartStyleStudyId)(8,!0))},this._renkoStyle={studyId:(0,r.ensureNotNull)((0,y.chartStyleStudyId)(4,!0))},this._pbStyle={studyId:(0,r.ensureNotNull)((0,y.chartStyleStudyId)(7,!0))},this._kagiStyle={studyId:(0,r.ensureNotNull)((0,y.chartStyleStudyId)(5,!0))},this._pnfStyle={studyId:(0,r.ensureNotNull)((0,y.chartStyleStudyId)(6,!0))},this._rangeStyle={studyId:(0,r.ensureNotNull)((0,y.chartStyleStudyId)(11,!0))},this._volFootprintStyle={studyId:(0,r.ensureNotNull)((0,y.chartStyleStudyId)(17,!0))},this._tpoStyle={studyId:(0,r.ensureNotNull)((0,y.chartStyleStudyId)(18,!0))},this._svpStyle={studyId:(0,r.ensureNotNull)((0,y.chartStyleStudyId)(20,!0))},this._barColorerCache=null,this._boxSizeValue=new ue.WatchedValue,this._base=100,this._pointValue=1,this._formattingDeps=null,this._defaultFormatter=new b.PriceFormatter({priceScale:this._base}),this._formatter=new b.PriceFormatter({priceScale:this._base}),this._ignoreMinMoveFormatter=new b.PriceFormatter({priceScale:this._base}),this._ignoreMinMovePriceStep=null,this._lastBarCloseTime=null,this._onSessionIdPropertyChangedBound=this._onSessionIdPropertyChanged.bind(this),this._ignoreSessionIdProxyPropertyChanges=!1,this._textSourceIsAlwaysTickerRestrictionEnabled=!1,this._lastPriceAnimationActive=!1,this._currentSession="out_of_session",this._onStyleChanged=new ie.Delegate,this._obsoleteZOrder=0,this._seriesErrorMessage=null,this._seriesAlwaysFalseHibernatedVW=new ue.WatchedValue(!1),this._styleToRecover=null,this._precomputedBarStyles=new WeakMap,this._doNotShowLastAvailableBar=!1,this._gotoDateResultCleared=!1,this._endOfDataPaneView=null,this._pendingTimeRange=null,this._replaySubscriber=new ue.WatchedValue(null),this._symbolIntervalChanged=new ie.Delegate,this._isReplayResolutionAvailableForUser=null,this._onInReplayStateChanged=new ie.Delegate,this._onReplaySubscriberSeriesModified=new ie.Delegate,this._paramsNotApplicableForReplay=new ie.Delegate,this._onTimeFrameApplied=new ie.Delegate,this._seriesLoaded=!1,this._seriesCompleted=!1,this._status=new ue.WatchedValue({seriesStatus:0}),
this._prevRequestedInterval="",this._isActingAsSymbolSource=new ue.WatchedValue(!0),this._unsupportedResolutionState=new ue.WatchedValue(null),this._countdownUpdateTimer=null,this._deferredDestroyed=(0,l.createDeferredPromise)(),this._volumePointWeights=null,this._studyBindings=null,this._lineColorAtYPercentFromTop=new G.GradientColorCache,this._savedLeftEdge=null,this._pendingScrollToLeftEdge=null,this._updateTimeScaleTimePointWeights=()=>{this._model.timeScale().setTimePointWeights(19===this.style()?this._volumePointWeights:null)};const h=t.childs().interval;this._intervalObj=new ue.WatchedValue(C.Interval.parse(h.value())),t.childs().interval.subscribe(this,(()=>this._intervalObj.setValue(C.Interval.parse(h.value())))),this._seriesStatus=(0,ze.combine)(ot,this._status.weakReference()),this._studyBindings=new z.SeriesStudiesBindings(this),this._studyBindings.onStatusChanged().subscribe(this,(()=>{const e=this.status(),t=this._status.value(),i=this._studyBindings?.status();this._updateStatus({...this._status.value(),additionalStudyStatus:i}),this.status()!==e&&(this._statusView.update(),this._model.updateSource(this)),(0,s.default)(t,this._status)||this._onStatusChanged.fire()})),this._seriesSource=new de.SeriesDataSource(e.chartApi(),"s",a);const u=this._seriesSource.dataEvents();u.symbolResolved().subscribe(this,this._onSymbolResolved),u.symbolError().subscribe(this,this._onSymbolError),u.seriesTimeFrame().subscribe(this,this._onSeriesTimeFrame),u.seriesError().subscribe(this,this._onSeriesError),u.loading().subscribe(this,this._onSeriesLoading),u.completed().subscribe(this,this._onSeriesCompleted),u.dataUpdated().subscribe(this,this._onDataUpdated),u.barReceived().subscribe(this,this._onBarReceived),u.unsupportedResolutionRequested().subscribe(this,this._onUnsupportedResolutionRequested),this._quotesProvider=new V.QuotesProvider(void 0,e.collapsed().spawnOwnership()),this._quotesProvider.quotesUpdate().subscribe(this,this._onQuotesUpdate);const d=t.childs();if(t.hasChild("extendedHours")){(0,r.ensureDefined)(d.extendedHours).value()&&!t.hasChild("sessionId")&&t.addChild("sessionId",new m.Property("extended")),t.removeProperty("extendedHours")}t.hasChild("sessionId")||t.addChild("sessionId",new m.Property(g.SubsessionId.Regular)),(0,Oe.allChartStyles)().includes(d.style.value())||d.style.setValueSilently(2);const c=d.lineStyle.childs();if(d.lineStyle.hasChild("styleType")){let e,t;const i=c.styleType.value();0===i&&(t=14,e=d.lineWithMarkersStyle.childs()),1===i&&(t=15,e=d.steplineStyle.childs()),e&&(e.color.setValueSilently(c.color.value()),e.linestyle.setValueSilently(c.linestyle.value()),e.linewidth.setValueSilently(c.linewidth.value()),e.priceSource.setValueSilently(c.priceSource.value())),void 0!==t&&2===d.style.value()&&d.style.setValue(t),d.lineStyle.removeProperty("styleType")}this._studyBindings?.bindToSeriesProperties(t),this._setProperties(t),this._sessionIdProxyProperty=new m.Property(d.sessionId.value()),d.sessionId.subscribe(this,(()=>this._updateSessionIdProxyProperty())),
this._sessionIdProxyProperty.subscribe(this,this._onSessionIdProxyPropertyChanged),this._symbolTextSourceProxyProperty=new m.Property,this._recalcSymbolTextSourceProxyProperty(),d.statusViewStyle.childs().symbolTextSource.subscribe(this,this._recalcSymbolTextSourceProxyProperty),this._symbolTextSourceProxyProperty.subscribe(this,(()=>e.lightUpdate())),this._options=(0,se.merge)((0,se.clone)(st),o),this._prevChartStyle=d.style.value(),this._priceAxisView=new L.SeriesPriceAxisView(this,e,{alwaysShowGlobalLast:!Je,showCountdown:o.countdownEnabled});let p=null;Ke||Je||(p=new L.SeriesPriceAxisView(this,e,{visibleOnHistoryOnly:!0,showSymbolLabel:!1,showCountdown:!1,alwaysShowGlobalLast:!1,useSolidBodyColor:!1})),this._priceLinePriceAxisView=new Y.SeriesPriceLineAxisView(this),this._priceLineAxisViews=[this._priceLinePriceAxisView],this._projectionPriceAxisView=new J.ProjectionSeriesPriceAxisView(this,e,{showCountdown:o.countdownEnabled}),this._priceAxisViews=[this._priceAxisView,this._projectionPriceAxisView],null!==p&&this._priceAxisViews.push(p),this._prevClosePriceAxisView=new q.PrevCloseSeriesPriceAxisView(this,e),this._priceAxisViews.unshift(this._prevClosePriceAxisView),this._prevClosePriceLineView=new K.SeriesPrevClosePriceLinePaneView(this),this._panePriceAxisView=new X.PanePriceAxisView(this._priceAxisView,this,e),this._historyPricePanePriceAxisView=null!==p?new X.PanePriceAxisView(p,this,e):null,this._projectionPanePriceAxisView=new X.PanePriceAxisView(this._projectionPriceAxisView,this,e),this._labelPaneViews=[this._panePriceAxisView,this._projectionPanePriceAxisView],null!==this._historyPricePanePriceAxisView&&this._labelPaneViews.push(this._historyPricePanePriceAxisView),this._highLowAvgPaneViews=[],this._averagePaneViews=[],this._createHighLowAvgViews(),this._subscribeRestartToSessionIdChange(),d.visible.subscribe(this,this._updateLastPriceAnimationActive),this._updateLastPriceAnimationActive(),d.minTick.subscribe(this,this._onFormatterPropsChanged),this._dataWindowView=new he.SeriesDataWindowView(this,e),this._legendView=new f.SeriesLegendView(this,e),this._statusView=new v.SeriesStatusView(this,d.statusViewStyle),this._marketStatusModel=new w.MarketStatusModel(this._quotesProvider),this._dataUpdatedModeModel=$e?new T.DataUpdatedModeModel(this._symbolInfo.spawn().ownership(),this._seriesStatus.spawn().ownership(),(0,Ge.createWVFromGetterAndSubscription)((()=>this._lastCompleteFlags?.rt_update_period),u.completed()).ownership()):null,this._dataProblemModel=new I.DataProblemModel(this._quotesProvider,this._symbolInfo.spawn().ownership()),d.backAdjustment.subscribe(this,(()=>{this.isStarted()&&this.restart()})),d.settlementAsClose.subscribe(this,(()=>{this.isDWM()&&this.isStarted()&&this.restart()})),this._symbolResolvingActive.subscribe((()=>e.realignLineTools())),this._intervalChanged.subscribe(this,(()=>e.realignLineTools())),this._intervalChanged.subscribe(this,(()=>this._checkChartStyle())),
Q.enabled("widget")||Promise.all([i.e(66476),i.e(18883),i.e(15371),i.e(98185),i.e(92537),i.e(46195),i.e(32937),i.e(67780),i.e(79317),i.e(22592),i.e(82321),i.e(62526),i.e(66849)]).then(i.bind(i,852573)).then((e=>{this._endOfDataPaneView=new e.EndOfDataLollipopPaneView(this)})),this._studyBindings?.syncStudy(this.style()),B.alertsAvailable&&this._symbolResolvingActive.subscribe(this._updateAlertCreationAvailable.bind(this)),this.createPaneView(),this._properties.addExcludedKey("visible",1),this._properties.addExcludedKey("currencyId",1),this._futureBarsPaneView=null,this._priceLineView=null,this._baseHorizontalLineView=new Ue.SeriesHorizontalBaseLinePaneView(this);for(const[,e]of Object.entries(S.STYLE_SHORT_NAMES))this._properties.child(`${e}Style`)?.subscribe(this,(()=>this.invalidateBarStylesCache()));const _=d.renkoStyle.childs().inputs.childs();_.boxSize.subscribe(this,this.restart),_.style.subscribe(this,this.restart),_.atrLength.subscribe(this,this.restart),_.percentageLTP.subscribe(this,this.restart),_.wicks.subscribe(this,this.restart),_.sources.subscribe(this,this.restart),d.pbStyle.childs().inputs.childs().lb.subscribe(this,this.restart);const P=d.kagiStyle.childs().inputs.childs();P.reversalAmount.subscribe(this,this.restart),P.style.subscribe(this,this.restart),P.atrLength.subscribe(this,this.restart),P.percentageLTP.subscribe(this,this.restart);const A=d.pnfStyle.childs().inputs.childs();A.boxSize.subscribe(this,this.restart),A.reversalAmount.subscribe(this,this.restart),A.sources.subscribe(this,this.restart),A.style.subscribe(this,this.restart),A.atrLength.subscribe(this,this.restart),A.percentageLTP.subscribe(this,this.restart),A.oneStepBackBuilding.subscribe(this,this.restart),d.rangeStyle.childs().inputs.childs().phantomBars.subscribe(this,this.restart),this._isDWMProperty=new m.Property(this.isDWM()),this._onRestarted.subscribe(this,(()=>this._isDWMProperty.setValue(this.isDWM()))),d.dividendsAdjustment.subscribe(this,(()=>{const e=d.dividendsAdjustment.value();(0,n.trackEvent)("Dividends adjust",!0===e?"On":"Off"),this.restart()})),this._dataPoweredBy=null,d.showCountdown.subscribe(this,this._onShowCountdownChanged),this._onShowCountdownChanged(d.showCountdown),this._recreatePriceFormattingDependencies(),d.lineStyle.childs().priceSource.subscribe(this,this._updateBarFunction),d.lineWithMarkersStyle.childs().priceSource.subscribe(this,this._updateBarFunction),d.steplineStyle.childs().priceSource.subscribe(this,this._updateBarFunction),d.areaStyle.childs().priceSource.subscribe(this,this._updateBarFunction),d.baselineStyle.childs().priceSource.subscribe(this,this._updateBarFunction),d.columnStyle.childs().priceSource.subscribe(this,this._updateBarFunction),d.tpoStyle.childs().priceSource.subscribe(this,this._updateBarFunction),this._updateBarFunction(),this._isInReplay=(0,ze.combine)((e=>null!==e),this._replaySubscriber.weakReference()),this._legendValuesProvider=new ee.SeriesLegendValuesProvider(this,this.model()),this._dataWindowValuesProvider=new He.SeriesValuesProvider(this,this.model())}setId(e){
super.setId(e),(0,j.getPersistentLogger)()?.addPersistentLogEntry(`Set series Id to ${e}`,a.LOGLEVEL.INFO,"chart.series")}supportsConflatedChunks(){return!0}conflatedChunks(e,t){return this.data().conflatedChunks(e,t)}seriesErrorMessage(){const{seriesStatus:e,additionalStudyStatus:t}=this._status.value();return this.isFailed()?this._seriesErrorMessage:S.seriesLoadingStatuses.has(e)?null:t?.type===je.StudyStatusType.Error?(0,je.convertStudyStatusToString)({type:je.StudyStatusType.Error,errorDescription:t.errorDescription},!0):null}destroy(){this._seriesStatus.destroy(),this._quotesProvider.quotesUpdate().unsubscribeAll(this),this._quotesProvider.destroy(),this.clearGotoDateResult(),this._legendView.destroy(),this._marketStatusModel.destroy(),this._studyBindings&&this._studyBindings.destroy(),null!==this._dataUpdatedModeModel&&this._dataUpdatedModeModel.destroy(),this._dataProblemModel.destroy(),this._paneView&&this._paneView.destroy&&this._paneView.destroy(),this._seriesSource.destroy(),this._quotesProvider.quotesUpdate().unsubscribeAll(this),this._model.timeScale().visibleBarsStrictRangeChanged().unsubscribeAll(this),this._unsubscribeRestartToSessionIdChange(),this._paramsNotApplicableForReplay.destroy(),this._onTimeFrameApplied.destroy(),this._deferredDestroyed.resolve(),this._properties.destroy(),this._isInReplay.destroy(),super.destroy()}isActingAsSymbolSource(){return this._isActingAsSymbolSource.readonly()}barColorer(){if(this._barColorerCache)return this._barColorerCache;let e=null;const t=this._model.panes();for(let i=t.length-1;i>=0;i--){const s=t[i].dataSources().filter(Me.isStudy).filter((e=>e.hasBarColorer()&&!e.isSourceHidden())).sort(((e,t)=>e.zorder()-t.zorder()));for(let t=0;t<s.length;t++){const i=(0,r.ensureNotNull)(s[t].barColorer());null===e?e=i:e.pushBackBarColorer(i)}}return null===e?e=new Fe.SeriesBarColorer(this):e.pushBackBarColorer(new Fe.SeriesBarColorer(this)),this._barColorerCache=e,e}createPaneView(){this._paneView=null,this._projectionBarsPaneView=null,this._waterlineView=null,this._priceLineView=this.hasClosePrice()?new me.SeriesPriceLinePaneView(this):null;const e=this._properties.childs().style.value();switch(e){case 0:this._paneView=new Ae.SeriesBarsPaneView(this,this._model);break;case 17:case 19:case 1:this._paneView=new Te.SeriesCandlesPaneView(this,this._model,1===e||19===e?1:.2);break;case 2:case 18:case 14:case 15:this._paneView=new Ie.SeriesLinePaneView(this,this._model);break;case 3:this._paneView=new Ve.SeriesAreaPaneView(this,this._model);break;case 16:this._paneView=new Le.SeriesHLCAreaPaneView(this,this._model);break;case 8:this._paneView=new xe.SeriesHeikenAshiPaneView(this,this._model);break;case 9:this._paneView=new De.SeriesHollowCandlesPaneView(this,this._model);break;case 13:this._paneView=new Ce.SeriesColumnsPaneView(this,this._model);break;case 10:{this._paneView=new Ee.SeriesBaselinePaneView(this,this._model);const e=this._properties.childs().baselineStyle.childs();this._waterlineView=new ye.SeriesWaterlinePaneView({paneHeight:()=>this.priceScale().height(),
color:()=>e.baselineColor.value(),baseLevelPercentage:()=>e.baseLevelPercentage.value()});break}case 12:this._paneView=new ge.SeriesHiLoPaneView(this,this._model)}switch(e){case 4:this._paneView=new Se.SeriesRenkoPaneView(this,this._model),this._projectionBarsPaneView=new Se.SeriesProjectionRenkoPaneView(this,this._model);break;case 7:this._paneView=new ve.SeriesPriceBreakPaneView(this,this._model),this._projectionBarsPaneView=new ve.SeriesProjectionPriceBreakPaneView(this,this._model);break;case 5:this._paneView=new fe.SeriesKagiPaneView(this,this._model),this._projectionBarsPaneView=new fe.SeriesProjectionKagiPaneView(this,this._model);break;case 6:this._paneView=new we.SeriesPnFPaneView(this,this._model),this._projectionBarsPaneView=new we.SeriesProjectionPnFPaneView(this,this._model)}if(11===e&&(this._properties.childs().rangeStyle.childs().barStyle.value()===Be.RangeBarStyle.Bars?(this._paneView=new Ae.SeriesBarsPaneView(this,this._model),this._projectionBarsPaneView=new $.SeriesProjectionRangeBarsPaneView(this,this._model)):(this._paneView=new Te.SeriesCandlesPaneView(this,this._model),this._projectionBarsPaneView=new $.SeriesProjectionRangeCandlesPaneView(this,this._model))),20===e&&(this._paneView=U.EmptyPaneView.instance()),null===this._paneView)throw Error("Unknown chart style assigned: "+e)}properties(){return this._properties}zorder(){return 0}quotesProvider(){return this._quotesProvider}currentSession(){return this._currentSession}syncModel(){if(!this._syncModel){const e=this.symbolInfo(),t=this.interval();if(!e||!t)return null;this._syncModel=new A.SyncModel(e,t)}return this._syncModel}labelPaneViews(){return this._labelPaneViews}topPaneViews(){const e=[];if(null!==this._gotoDateView&&e.push(this._gotoDateView),this._lastPriceAnimationActive){const t=this._lineStyleLastPriceCirclePaneView;t.animationActive()&&setTimeout((()=>this._model.invalidate(le.InvalidationMask.cursor())),0),t.invalidateStage(),e.push(t)}return 0!==e.length?e:null}paneViews(e){if(!this.properties().childs().visible.value()||!this._model.isSnapshot()&&!this._wasCompletedBefore())return null;const t=e===this._model.paneForSource(this),i=t?[(0,r.ensureNotNull)(this._baseHorizontalLineView),(0,r.ensureNotNull)(this._paneView)]:[];return i.push(...this._studyBindings?.paneViews(e)??[]),t&&(this._endOfDataPaneView&&i.push(this._endOfDataPaneView),this._futureBarsPaneView&&i.push(this._futureBarsPaneView),this._projectionBarsPaneView&&i.push(this._projectionBarsPaneView),null!==this._waterlineView&&i.push(this._waterlineView),i.push((0,r.ensureNotNull)(this._prevClosePriceLineView)),null!==this._priceLineView&&i.push(this._priceLineView),window.TradingView.printing&&this._lastPriceAnimationActive&&(this._lineStyleLastPriceCirclePaneView.stopAnimation(),i.push(this._lineStyleLastPriceCirclePaneView)),i.push(...this._highLowAvgPaneViews),i.push(...this._averagePaneViews)),i}widgetSideAreaViews(e){return this._studyBindings?.widgetSideAreaViews(e)??null}priceAxisViews(e,t){
return e.findTargetPriceAxisViews(this,t,this._priceAxisViews,this._priceLineAxisViews)}clearHighLowPriceCache(){this._highLowPriceCache.clear()}clearAveragePriceCache(){this._averagePriceCache.clear()}priceScale(){return(0,r.ensureNotNull)(this._priceScale)}setPriceScale(e){this._priceScale!==e&&(this._priceScaleAboutToBeChanged.fire(),this._priceScale=e,this._properties.removeProperty("priceAxisProperties"),this._properties.addChild("priceAxisProperties",e.properties()),this._properties.childs().priceAxisProperties.fireChanged(),(0,o.emit)("series_event","price_scale_changed"),this._priceScaleChanged.fire(e))}priceScaleChanged(){return this._priceScaleChanged}priceScaleAboutToBeChanged(){return this._priceScaleAboutToBeChanged}applyPreferences(e){const t=(0,se.clone)(e);this.priceScale().setMode({autoScale:t.priceAxisProperties.autoScale,percentage:t.priceAxisProperties.percentage,log:t.priceAxisProperties.log,lockScale:t.priceAxisProperties.lockScale}),this.setChartStyleWithIntervalIfNeeded(t.style);const{style:i,interval:s,...r}=t;this._properties.mergePreferences(r),this._properties.saveDefaults(),this.createPaneView(),this.invalidateBarStylesCache()}disconnect(){this._studyBindings?.stop(),this._seriesSource.stop(),this._predictBars=0,this._updateStatus({...this._status.value(),seriesStatus:0}),this._model.isSnapshot()||this._symbolInfo.setValue(null)}isStarted(){return this._seriesSource.isStarted()}isCompleted(){return this._seriesCompleted}restart(e,t,i){if(5===this._status.value().seriesStatus)return;this._seriesLoaded=!1,this._seriesCompleted=!1,this._lastCompleteFlags=null,this._onRestarted.fire(),this._setStatus(1),this._updateSymbolInfo(null);const s=this._properties.childs().interval.value();C.Interval.isEqual(s,this._prevRequestedInterval)||this._notifyIntervalChanged(s);let r=null;this._pendingTimeRange&&(r=this._pendingTimeRange,this._pendingTimeRange=null),i||this._removeReplaySubscriber(),this._onBeforeModifySeries(this.getSymbolString(),s),this._onTimeFrameApplied.fire(r);const n=(0,_e.getServerInterval)(s);this._data=null,this.model().recalcVisibleRangeStudies(u.RecalcVisibleRangeStudiesReason.SeriesRestart),this._seriesSource.modifySeries(this._getResolvingSymbolObject(),n,r),this._seriesSource.isStarted()||this._seriesSource.start(),this._prevRequestedInterval=this.interval(),this._studyBindings?.restart(),this.updateAllViews((0,ce.sourceChangeEvent)(this.id())),this._model.lightUpdate()}isSymbolInvalid(){return 4===this._status.value().seriesStatus}getSymbolString(){return(0,ne.encodeExtendedSymbolOrGetSimpleSymbolString)(this._getSymbolObject())}getAlertSymbolString(){return(0,ne.encodeExtendedSymbolOrGetSimpleSymbolString)(this._getSymbolObject(this.actualSymbol()))}invalidateBarStylesCache(e){et.logDebug("Invalidate style cache starting from "+e),this._clearStylePlot(this.bars(),e),this._clearStylePlot(this.nsBars())}isLoading(){return S.seriesLoadingStatuses.has(this.statusWV().value())}isFailed(){const e=this.status();return 12===e||4===e||10===e||14===e}isStatusError(){
return 12===this.status()}unsupportedResolutionState(){return this._unsupportedResolutionState.readonly()}actualSymbol(){return(0,y.actualSymbol)(this.symbolInfo(),this.symbol())}proSymbol(){return(0,y.proSymbol)(this.symbolInfo(),this.symbol())}onStyleChanged(){return this._onStyleChanged}style(){return this.properties().childs().style.value()}setStyle(e){this.setSymbolParams({style:e})}isRangeBasedStyle(){return(0,y.isRangeBasedStyle)(this.style())}symbolSameAsCurrent(e){return this.symbol()===e||(0,re.symbolSameAsCurrent)(e,this.symbolInfo())}symbolSameAsResolved(e){return this._model.isSnapshot()?this.symbolSameAsCurrent(e):this._seriesSource.symbolSameAsResolved(e)}status(){return this._seriesStatus.value()}statusWV(){return this._seriesStatus}compositeStatusVW(){return this._status}symbol(){return this.properties().childs().symbol.value()}symbolChanged(){return this.properties().childs().symbol}seriesSource(){return this._seriesSource}symbolInfo(){return this._symbolInfo.value()}symbolResolved(){return this.dataEvents().symbolResolved()}symbolResolvingActive(){return this._symbolResolvingActive}symbolHibernated(){return this._seriesAlwaysFalseHibernatedVW}getSymbolName(){return this.symbolInfo()?.name??""}firstValue(){const e=this.firstBar();return null===e?null:this._barFunction(e,0)}firstBar(){const e=this.model().timeScale().visibleBarsStrictRange();if(null===e)return null;const t=e.firstBar(),i=this.data().search(t,p.PlotRowSearchMode.NearestRight);return null!==i?i.value:null}formatter(e=!0){return e?this._formatter:this._ignoreMinMoveFormatter}defaultFormatter(){return this._defaultFormatter}priceStep(e=!0){return e?this._priceStep:this._ignoreMinMovePriceStep}bars(){return this.data().bars()}nsBars(){return this.data().nsBars()}interval(){return this.properties().childs().interval.value()}setInterval(e){this.setSymbolParams({interval:e})}intervalObj(){return this._intervalObj.readonly()}prevClose(){const e=this.priceScale();if(e.isEmpty()||this.data().isEmpty())return null;const t=this.quotes(),i=this.firstValue();if(null===t||null===i)return null;const s=t.prev_close_price;return void 0===s?null:{coordinate:e.priceToCoordinate(s,i),floatCoordinate:e.priceToCoordinate(s,i),formattedPricePercentage:e.formatPricePercentage(s,i,{signPositive:!0}),formattedPriceAbsolute:e.formatPriceAbsolute(s),formattedPriceIndexedTo100:e.formatPriceIndexedTo100(s,i)}}priceLineColor(e){return this.properties().childs().priceLineColor.value()||e}hasClosePrice(){return Qe||12!==this.properties().childs().style.value()}lastValueData(e,t,i){const s={noData:!0},r=this.priceScale();if(this.model().timeScale().isEmpty()||r.isEmpty()||this.data().isEmpty())return s;const n=this.model().timeScale().visibleBarsStrictRange(),o=this.firstValue();if(null===n||null===o)return s;let a,l;if(t){const e=this.data().bars().last();if(null===e)return s;a=e.value,l=e.index}else{const e=this.data().bars().search(n.lastBar(),p.PlotRowSearchMode.NearestLeft);if(null===e)return s;a=e.value,l=e.index}
const h=(void 0!==e?a[e]:this._barFunction(a,2))??NaN,u=this.barColorer().barStyle(l,!1),d=r.priceToCoordinate(h,o),c={...r.getFormattedValues(h,o,!0),noData:!1,color:u.barColor,floatCoordinate:d,coordinate:d,index:l};return i&&(c.price=h),c}isDWM(){return this.intervalObj().value().isDWM()}isPulse(){const e=this.symbolInfo();return null!==e&&(e.resolutions??[]).length>0}data(){return this._data??this._seriesSource.data()}clearData(){(0,r.assert)(null===this._data,"Cannot clear loaded data"),this._studyBindings?.clearData(),this._seriesSource.clearData()}nearestData(e,t){return this.data().search(e,t)??void 0}nearestIndex(e,t){return this.nearestData(e,t)?.index}nearestValue(e,t,i){const s=this.nearestData(e,i);return s?.value[t]??void 0}onSymbolIntervalChanged(){return this._symbolIntervalChanged}onIntervalChanged(){return this._intervalChanged}onStatusChanged(){return this._onStatusChanged}onRestarted(){return this._onRestarted}fixLastBar(e){if(!this._futureBarsPaneView){const t=this.bars().lastIndex();t&&(this._futureBarsPaneView=new N.FutureBarsPaneView(this.model().timeScale(),this,t,e))}}requestMoreData(e){if(!S.seriesReadyStatuses.has(this._status.value().seriesStatus))return;if(this._model.timeScale().isEmpty())return;const t=this._model.timeScale().visibleBarsStrictRange();if(null===t)return;if(0===this.bars().size())return;const i=t.lastBar()-(0,r.ensureNotNull)(this.data().last()).index;if(this._predictBars<i&&(this._predictBars=i,this._seriesSource.requestMoreTickmarks(i)),!this._requestMoreDataAvailable)return;const s=(0,r.ensureNotNull)(this.bars().firstIndex()),n=e||Math.max(s-t.firstBar(),s-(this._studyBindings?.requestMoreDataIndex()??s));if(n<=0)return;if(!Number.isFinite(n))return void et.logWarn("requestMoreData: invalid bar count: "+n+", visible bars: ["+t.firstBar()+", "+t.lastBar()+"], last index: "+(0,r.ensureNotNull)(this.data().last()).index+", predicted bars: "+this._predictBars+", required bars:"+e);this._requestMoreDataAvailable=!1;const o=this._colorOnPrevBar()?2:0;this._seriesSource.requestMoreData(n+o),this._setStatus(2)}isNeedRestart(e){return 5!==this._status.value().seriesStatus&&(void 0===e&&(e=this.properties().childs().style.value()),(0,y.styleChangeRequiresRestart)(this._prevChartStyle,e))}isStyleSupported(e){return!this.isInReplay().value()||(0,y.isStyleSupportedForReplay)(e)}sessionId(){return this.properties().childs().sessionId.value()}sessionIdChanged(){return this._sessionIdChanged}priceRange(e,t,i){const s=this._priceScale;if(this.data().isEmpty()||!s)return null;if(s.isLockScale()){const e=this._model.mainSeriesScaleRatio();if(null!==e){const i=s.internalHeight()/(this.model().timeScale().barSpacing()/e),n=(0,r.ensureNotNull)(this.data().search(t,p.PlotRowSearchMode.NearestLeft)).value,o=((0,r.ensure)(n[2])+(0,r.ensure)(n[3]))/2;return new _.PriceRange(o-.5*i,o+.5*i)}}const n=this.priceSource();let o,a,l;if(null!==n?(o=this.data().bars().minMaxOnRangeCached(e,t,[{name:n,offset:0}]),a=this.data().nsBars().minMaxOnRangeCached(e,t,[{name:n,offset:0
}])):(o=this.data().bars().minMaxOnRangeCached(e,t,[{name:"low",offset:0},{name:"high",offset:0}]),a=this.data().nsBars().minMaxOnRange(e,t,[{name:"low",offset:0},{name:"high",offset:0}])),o=(0,c.mergeMinMax)(o,a),null===o)l=new _.PriceRange(-.5,.5);else if(o.min===o.max){const e=5/(this.symbolInfo()?.pricescale??100);l=new _.PriceRange(o.min-e,o.max+e)}else l=new _.PriceRange(o.min,o.max);return s.isLog()?new _.PriceRange(s.priceToLogical(l.minValue()),s.priceToLogical(l.maxValue())):l}autoScaleInfo(e,t,i){let s={range:this.priceRange(e,t,{...i,scaleSeriesOnly:!0}),topPixelMargin:this._paneView?.topPixelMargin?.(),bottomPixelMargin:this._paneView?.bottomPixelMargin?.()};if(!i.scaleSeriesOnly){const r=this._model.allStudies().filter((e=>e.isVisible())),n=(e,t)=>void 0===e?t:void 0===t?e:Math.max(e,t),o=r.map((s=>s.autoScaleInfo(e,t,{...i,forceOverlayOnly:!0})));this._studyBindings&&o.push(...this._studyBindings.autoScaleInfos(e,t,i));const a=(e,t)=>({range:e.range?t.range?e.range.merge(t.range):e.range:t.range,topPixelMargin:n(e.topPixelMargin,t.topPixelMargin),bottomPixelMargin:n(e.bottomPixelMargin,t.bottomPixelMargin)});s=o.reduce(a,s)}return s}onChartStyleChanged(){this._updateBarFunction(),this.isNeedRestart()&&(this.data().clear(),this.isInReplay().value()&&!(0,y.isStyleSupportedForReplay)(this.style())&&this._removeReplaySubscriber(),this._saveLeftEdgeIfRequired(!1)||this.model().timeScale().scrollToRealtime(!1),this.restart());const e=this.properties();this._prevChartStyle!==e.childs().style.value()&&this._studyBindings?.syncStudy(this.style()),this._prevChartStyle=e.childs().style.value(),this._onStyleChanged.fire(e.childs().style.value()),this.invalidateBarStylesCache(),this._updateLastPriceAnimationActive(),this._styleToRecover?.originalStyle!==this.style()&&(this._styleToRecover=null),this._updateTimeScaleTimePointWeights()}setChartStyleWithIntervalIfNeeded(e,t){const i=this.interval(),s=t??(0,pe.getResolutionByChartStyle)(e,i,this._model.defaultResolutions()),r=C.Interval.isEqual(s,i);this.setSymbolParams({interval:r?void 0:s,style:e})}getInputsProperties(){const e=this._properties.child(`${this.getStyleShortName()}Style`);return e?.childs().inputs??new m.Property}getInputsInfoProperties(){const e=this._studyBindings?.getInputsInfoProperties();if(e)return e;const t=this._properties.child(`${this.getStyleShortName()}Style`);return t?.childs().inputInfo??new m.Property}getSourceIcon(){return{type:"loadSvg",svgId:`series.${this.style()}`}}onSourceIconChanged(){return this._onStyleChanged}purgeSymbolInfo(){this._symbolInfo.setValue(null)}idForAlert(){return(0,R.getSeriesIdForAlert)(this.getSymbolString(),this.interval())}hasStateForAlert(){return super.hasStateForAlert()&&!(0,y.isEconomicSymbol)(this.symbolInfo())}stateForAlert(){const e=this.idForAlert(),t=k.FormattersSerializer.serialize(this._formatter);let i;const s=this.isDWM()?g.SubsessionId.Regular:this.sessionIdProxyProperty().value(),r=this.symbolInfo();if(r&&r.subsessions&&r.subsessions.length>1){const e=r.subsessions?.find((e=>e.id===s));e&&(i=(0,
F.translateSessionExtendedDescription)(e.description))}const n=this.properties().childs(),o={id:e,type:"MainSeries",actualSymbol:this.actualSymbol(),symbolString:this.getSymbolString(),interval:this.interval(),style:n.style.value(),styleInputs:this.getInputsProperties().state(),sessionId:s,sessionDescription:i,dividendsAdjustment:n.dividendsAdjustment.value(),boxSize:this.data().boxSize,reversalAmount:this.data().reversalAmount,isSpread:this.isSpread(),formatter:t},a=(0,M.getSeriesDangerReason)(this);return a&&(o.dangerReason=a),o}styleStudyInfos(){return{haStyle:this._haStyle,renkoStyle:this._renkoStyle,pbStyle:this._pbStyle,kagiStyle:this._kagiStyle,pnfStyle:this._pnfStyle,rangeStyle:this._rangeStyle,volFootprintStyle:this._volFootprintStyle,tpoStyle:this._tpoStyle,svpStyle:this._svpStyle}}dataEvents(){return this._seriesSource.dataEvents()}isSpread(){return"spread"===this.symbolInfo()?.type}isYield(){const e=this.symbolInfo();return null!==e&&(0,Ne.isYield)(e)}dividendsAdjustmentProperty(){return this._properties.childs().dividendsAdjustment}sessionIdProxyProperty(){return this._sessionIdProxyProperty}symbolTextSourceProxyProperty(){return this._symbolTextSourceProxyProperty}setTextSourceIsAlwaysTickerRestrictionEnabled(e){this._textSourceIsAlwaysTickerRestrictionEnabled=e,this._recalcSymbolTextSourceProxyProperty()}isDWMProperty(){return this._isDWMProperty}isPrePostMarketPricesAvailableProperty(){return this._isPrePostMarketPricesAvailableProperty}isSettlementAsCloseForbiddenProperty(){return this._isSettlementAsCloseForbiddenProperty}isBackAdjustmentForbiddenProperty(){return this._isBackAdjustmentForbiddenProperty}getStyleShortName(){const e=this.style(),t=S.STYLE_SHORT_NAMES[e];return(0,r.assert)(!!t,`Missed short name for style ${e}`),t}invalidateBarColorerCache(){this._barColorerCache=null,this.invalidateBarStylesCache()}paramsNotApplicableForReplay(){return this._paramsNotApplicableForReplay}onTimeFrameApplied(){return this._onTimeFrameApplied}onInReplayStateChanged(){return this._onInReplayStateChanged}onReplayModified(){return this._onReplaySubscriberSeriesModified}dataWindowView(){return this._dataWindowView}statusView(){return Ye?this._statusView:null}legendView(){return this._legendView}marketStatusModel(){return this._marketStatusModel}isMainSeries(){return!0}dataUpdatedModeModel(){return this._dataUpdatedModeModel}dataProblemModel(){return this._dataProblemModel}setDefaultTimeframe(e){this._pendingTimeRange=e}loadDataTo(e){const t=this._properties.childs().interval.value();this._onTimeFrameApplied.fire(e),this._seriesSource.modifySeries(this._getResolvingSymbolObject(),(0,_e.getServerInterval)(t),e)}isInReplay(){return this._isInReplay}quotes(){return this.data().isEmpty()?null:this._quotesProvider.quotes()}base(){return this._base}pointValue(){return this._pointValue}barCloseTime(){return this._lastBarCloseTime}priceSource(){let e=null;const t=this._properties.childs();switch(t.style.value()){case 2:e=t.lineStyle.childs().priceSource.value();break;case 18:e=t.tpoStyle.childs().priceSource.value()
;break;case 14:e=t.lineWithMarkersStyle.childs().priceSource.value();break;case 15:e=t.steplineStyle.childs().priceSource.value();break;case 3:e=t.areaStyle.childs().priceSource.value();break;case 10:e=t.baselineStyle.childs().priceSource.value();break;case 13:e=t.columnStyle.childs().priceSource.value()}return e}lineColorAtYPercentFromTop(e){let t;switch(this.style()){case 2:t=this.properties().childs().lineStyle.childs();break;case 14:t=this.properties().childs().lineWithMarkersStyle.childs();break;case 15:t=this.properties().childs().steplineStyle.childs();break;default:t=null}return t?t.colorType?.value()===qe.ColorType.Solid?t.color.value():this._lineColorAtYPercentFromTop.gradientColor((0,r.ensureDefined)(t.gradientStartColor).value(),(0,r.ensureDefined)(t.gradientEndColor).value(),e):null}updateAllViews(e){if("hover-change"===e.type)return;this._paneView?.update(e),this._dataWindowView.update(),this._legendView.update(),this._statusView.update(),this._averagePaneViews.forEach((t=>t.update(e))),this._highLowAvgPaneViews.forEach((t=>t.update(e))),this._labelPaneViews.forEach((t=>t.update(e))),this._priceAxisViews.forEach((t=>t.update(e))),this._priceLineAxisViews.forEach((t=>t.update(e))),this._futureBarsPaneView?.update(e),this._projectionBarsPaneView?.update(e),this._waterlineView?.update(e),this._prevClosePriceLineView?.update(e),this._priceLineView?.update(e),this._gotoDateView?.update(e),this._endOfDataPaneView?.update(e),this._baseHorizontalLineView?.update(e);const t=this._model.activeStrategySource().value();t?.updateAllViews(e),this._model.replayStudyStrategy().value()?.updateAllViews(e),this._lineStyleLastPriceCirclePaneView.update(e),this._studyBindings?.updateAllViews(e)}styleStudyInfo(e){return this.styleStudyInfos()[e]}barFunction(){return this._barFunction}precomputedBarStyle(e){return this._precomputedBarStyles.get(e)}setPrecomputedBarStyle(e,t){this._precomputedBarStyles.set(e,t)}symbolParams(){return(0,re.symbolParams)(this)}compareSymbolParams(e){return(0,re.compareSymbolParams)(this,e,this._model.unitConversionEnabled())}setSymbolParams(e){const{symbol:t,currency:i,unit:s,style:n,interval:o}=e,{symbolChanged:a,intervalChanged:l,currencyChanged:h,unitChanged:u,styleChanged:d}=this.compareSymbolParams(e),c=[rt("symbol",t,a),rt("interval",o,l),rt("currency",i,h),rt("unit",s,u),rt("style",n,d)].filter((e=>null!==e)).join("; ");et.logInfo(`Applying series symbol params: ${c}`);const p=this.properties().childs();void 0!==t&&p.symbol.setValue(t),void 0!==i&&p.currencyId.setValue(i),void 0!==s&&p.unitId.setValue(s),l&&p.interval.setValue((0,r.ensureDefined)(o)),void 0!==n&&d&&p.style.setValue(n);let _=!1;d&&(_=this.isNeedRestart(),this.onChartStyleChanged());let m=Promise.resolve();return!_&&(a||l||h||u)&&(m=this._applySymbolParamsChanges({symbolChanged:a,currencyChanged:h,unitChanged:u,intervalChanged:l,styleChanged:d})),(a||h||u)&&this.model().checkLineToolSelection(),m}setSymbol(e){this.setSymbolParams({symbol:e})}currency(){return this.properties().childs().currencyId.value()||null}
setCurrency(e){this.setSymbolParams({currency:e})}isConvertedToOtherCurrency(){return(0,y.isConvertedToOtherCurrency)(this.symbolInfo())}unit(){return this.properties().childs().unitId.value()||null}setUnit(e){this.setSymbolParams({unit:e})}measureUnitId(){return(0,y.measureUnitId)(this.symbolInfo())}isConvertedToOtherUnit(){return(0,y.isConvertedToOtherUnit)(this.symbolInfo(),this._model.unitConversionEnabled())}valueAt(e,t){return this.data().search(e)?.value[t]??null}symbolSource(){return this}barsProvider(){return this}title(e){return this.symbolTitle(e)}name(){return this.symbolTitle(We.TitleDisplayTarget.StatusLine)}symbolTitle(e,t,i,s="exchange"){let r=this.properties().childs().symbol.value();const n=this.symbolInfo();if(null!==n){const{type:e}=n;r=(0,y.symbolTitle)(n,t,"forex"===e?"exchange":s)}return i?r:`${r}, ${(0,oe.translatedIntervalString)(this.properties().childs().interval.value())}`}setObsoleteZOrder(e){this._obsoleteZOrder=e}obsoleteZOrder(){return this._obsoleteZOrder}legendValuesProvider(){return this._studyBindings?.legendValuesProvider()??this._legendValuesProvider}dataWindowValuesProvider(){return this._studyBindings?.dataWindowValuesProvider()??this._dataWindowValuesProvider}statusProvider(e){return new te.SeriesStatusProvider(this,this.properties().childs().statusViewStyle,e)}moveItem(e,t,i){if(10===this.style()&&0===t){const t=this.priceScale(),i=this.properties().childs().baselineStyle,s=t.height(),r=100-e.y/s*100,n=r<0?0:Math.round(10*r)/10;i.childs().baseLevelPercentage.setValue(Math.max(Math.min(n,100),0))}}rerequestData(){this._applySymbolParamsChanges({force:!0})}switchToReplay(e,t){this._replaySubscriber.setValue(e),this._isReplayResolutionAvailableForUser=t,this._onInReplayStateChanged.fire(),e.onSeriesModified().subscribe(this,(()=>this._onReplaySubscriberSeriesModified.fire())),e.modifySeries(this.getSymbolString(),this._properties.childs().interval.value()),this.rerequestData()}switchToRealtime(){this.isInReplay().value()&&(this._removeReplaySubscriber(),this.rerequestData())}async canChangeResolution(e){{if(!this.isInReplay().value())return!0;const t="changeResolution";if(!(0,r.ensureNotNull)(this._isReplayResolutionAvailableForUser)(e))return this._paramsNotApplicableForReplay.fire(3,t),!1;const i=await(0,r.ensureNotNull)(this._replaySubscriber.value()).canChangeSymbolParams(this.getSymbolString(),e);return i||this._paramsNotApplicableForReplay.fire(2,t),i}}async canChangeSymbol(e){{if(!this.isInReplay().value())return{result:!0};const t=this._getExtendedSymbolObject(e);delete t["currency-id"],delete t["unit-id"];const i=(0,ne.encodeExtendedSymbolOrGetSimpleSymbolString)(t),s="changeSymbol";return new Promise((e=>{this._model.chartApi().resolveSymbol((0,x.makeNextSymbolId)(),i,(t=>{if("symbol_error"===t.method)this._paramsNotApplicableForReplay.fire(0,s),e({result:!1,reason:0});else if(t.params[1].is_replayable){const t=this.interval();(0,r.ensureNotNull)(this._isReplayResolutionAvailableForUser)(t)?(0,
r.ensureNotNull)(this._replaySubscriber.value()).canChangeSymbolParams(i,t).then((t=>t?e({result:!0}):(this._paramsNotApplicableForReplay.fire(2,s),e({result:!1,reason:2})))):(this._paramsNotApplicableForReplay.fire(3,s),e({result:!1,reason:3}))}else this._paramsNotApplicableForReplay.fire(1,s),e({result:!1,reason:1})}))}))}}requestMoreDataAvailable(){return this._requestMoreDataAvailable}seriesLoaded(){return this._seriesLoaded}endOfData(){return void 0!==this._lastCompleteFlags?.data_completed}endOfDataType(){return this._lastCompleteFlags?.data_completed??null}dataPoweredBy(){return this._dataPoweredBy}boxSizeValue(){return this._boxSizeValue}isUserDeletable(){return!1}changeTimeFrame(){(0,n.trackEvent)("GUI","Change timeframe")}onTagsChanged(){return this._tagsChanged}state(e){const t=this.obsoleteZOrder();let i={type:"MainSeries",id:this.id(),zorder:t,haStyle:this._haStyle,renkoStyle:this._renkoStyle,pbStyle:this._pbStyle,kagiStyle:this._kagiStyle,pnfStyle:this._pnfStyle,rangeStyle:this._rangeStyle,volFootprintStyle:this._volFootprintStyle,tpoStyle:this._tpoStyle,svpStyle:this._svpStyle,formattingDeps:this._formattingDeps,studyBindings:this._studyBindings?.state(!!e)};const s=this.properties().state(void 0,2);if(s.symbol=(0,y.symbolToSaveInState)(this.symbolInfo()??this._model.chartApi().lastSymbolResolveInfo(s.symbol),s.symbol),this._model.unitConversionEnabled()||(s.unitId=null),i.state=s,e){let e=this.bars();const t=this._model.timeScale().visibleExtendedDataRange(e,0);null!==t&&(e=e.range(t.firstBar(),t.lastBar())),i={...i,bars:nt(e),nsBars:nt(this.nsBars()),symbolInfo:this.symbolInfo(),rtPrice:this.data().lastProjectionPrice,boxSize:this.data().boxSize,reversalAmount:this.data().reversalAmount}}return i}restoreState(e,t){t&&this._setStatus(5),!this._model.unitConversionEnabled()&&e.state&&delete e.state.unitId,e.state&&C.Interval.isRange(e.state.interval)&&(e.state.style=11);const i=e.state;if(void 0!==i){const e=i.style,t=O.chartStylePermissions.get(e);t&&!this._model.isSnapshot()&&(i.style=2,(0,W.runOrGoProWithoutSync)((()=>{i.style=e}),t.feature,{feature:t.featureName}))}if(this._properties.mergeAndFire(e.state),this._prevChartStyle=this.properties().childs().style.value(),this.createPaneView(),t){const t=e;this.restoreData(t.bars,t.nsBars,t.symbolInfo,t.rtPrice,t.boxSize,t.reversalAmount)}e.formattingDeps&&(this._formattingDeps=e.formattingDeps,this._recreatePriceFormattingDependencies()),this._studyBindings?.restoreState(e.studyBindings??{},t),this._studyBindings?.syncStudy(this.style())}restoreData(e,t,i,s,r,n){this._updateStatus({seriesStatus:5}),this._data=new d.SeriesData,this._data.bars().restoreState(e),this._data.nsBars().restoreState(t),this._updateSymbolInfo(i),this._data.lastProjectionPrice=s,this._data.boxSize=r;const o=this.properties().childs();r||(6===o.style.value()?this._data.boxSize=o.pnfStyle.childs().inputs.childs().boxSize.value():4===o.style.value()&&(this._data.boxSize=o.renkoStyle.childs().inputs.childs().boxSize.value())),this._data.reversalAmount=n,
n||5===o.style.value()&&(this._data.reversalAmount=o.kagiStyle.childs().inputs.childs().reversalAmount.value())}async setGotoDateResult(e,t){this._gotoDateResultCleared=!1;const s=await Promise.all([i.e(36778),i.e(4079)]).then(i.bind(i,428529));this._gotoDateResultCleared||(this._gotoDateView=new s.GotoDateView(this,e,t),this._gotoDateView.doNotShowLastAvailableBar(this._doNotShowLastAvailableBar),this._model.updateSource(this))}clearGotoDateResult(){this._gotoDateView=null,this._gotoDateResultCleared=!0}doNotShowLastAvailableBar(e){this._doNotShowLastAvailableBar=e,this._gotoDateView?.doNotShowLastAvailableBar(e)}dataUpdated(){return this.dataEvents().dataUpdated()}moveData(e){this._seriesSource.moveData(e),null!==this._volumePointWeights&&this._volumePointWeights.moveData(e),this._studyBindings?.moveData(e)}async seriesCreated(){const e=this._seriesSource.instanceId();if(null!==e)return e;const t=await Promise.race([this._deferredDestroyed.promise.then((()=>{})),this._model.isSnapshot()?Promise.resolve(null):new Promise((e=>{this.dataEvents().created().subscribe(this,e,!0)}))]);if(void 0===t)throw new Error("Series has been destroyed");return t}activeStudyBinding(){return this._studyBindings?.activeStudy()??null}_updateBarFunction(){this._barFunction=(0,ke.barFunctionByStyle)(this.style(),this.priceSource())}_setProperties(e){e.hasChild("timeframe")||e.merge({timeframe:""}),e.hasChild("shortName")||e.merge({shortName:""}),e.hasChild("currencyId")||e.addChild("currencyId",new m.Property(null)),e.hasChild("unitId")||e.addChild("unitId",new m.Property(null)),this._properties=e;const t=e.childs();t.currencyId.subscribe(this,this._onCurrencyChanged),t.unitId.subscribe(this,this._onUnitChanged),t.timeframe.subscribe(this,this.changeTimeFrame),e.subscribe(this,this._onPropertiesChanged)}_updateSessionIdProxyProperty(e){const t=this._properties.childs().sessionId.value();let i=t;if(e){const e=this.symbolInfo();null!==e&&(i=e.subsession_id||t)}this._ignoreSessionIdProxyPropertyChanges=!0,this._sessionIdProxyProperty.setValue(i),this._ignoreSessionIdProxyPropertyChanges=!1}_onSessionIdProxyPropertyChanged(){this._ignoreSessionIdProxyPropertyChanges||this._properties.childs().sessionId.setValue(this._sessionIdProxyProperty.value()),this._updateLastPriceAnimationActive()}_onSymbolResolved(e){this._seriesErrorMessage=null,this._updateSymbolInfo(e),this._model.updateSource(this),this._model.onWidget()||((0,n.trackEvent)("Symbol",e.listed_exchange,e.name),(0,n.trackEvent)("Symbol Type",e.type,e.listed_exchange));const t=e.minmov/e.pricescale,i=this.properties().childs();4===i.style.value()&&i.renkoStyle.childs().inputs.childs().boxSize.value()<t?i.renkoStyle.childs().inputs.merge({boxSize:t}):6===i.style.value()&&i.pnfStyle.childs().inputs.childs().boxSize.value()<t?i.pnfStyle.childs().inputs.merge({boxSize:t}):5===i.style.value()&&i.kagiStyle.childs().inputs.childs().reversalAmount.value()<t&&i.kagiStyle.childs().inputs.merge({reversalAmount:t}),this._checkChartStyle(),this._formattingDeps={format:e.format,
pricescale:e.pricescale,minmov:e.minmov,fractional:e.fractional,minmove2:e.minmove2,variable_tick_size:e.variable_tick_size},this._updateLastPriceAnimationActive()}_onSymbolError(e){this._setStatus(4),this._properties.childs().shortName.setValue(this._properties.childs().symbol.value()),this._model.clearAllStudies(),this.updateAllViews((0,ce.sourceChangeEvent)(this.id())),this._model.updateSource(this),this._sendTelemetryCounter("symbol_error",this._getTelemetryAdditionalData(e,!1)),this._symbolResolvingActive.setValue(!1)}_sendTelemetryCounter(e,t){void 0===t&&(t=this._getTelemetryAdditionalData());const i=Object.assign({count:1},{additional:t});E.telemetry.sendChartReport(e,i)}_getTelemetryAdditionalData(e,t){t=void 0===t||t;const i={symbol:this.actualSymbol()};return t&&(i.resolution=this.interval()),void 0!==e&&(i.reason=e),i}_onSeriesTimeFrame(e,t,i,s,r){const n=(0,y.isSingleValueBasedStyle)(this.style())?e+.5:e;let o=t;if(void 0===r)null!==i&&"period-back"!==i.type||(o+=this._model.studyAwareDefaultRightOffset());else if(r.applyDefaultRightMargin)o+=this._model.studyAwareDefaultRightOffset();else if(r.percentRightMargin){const e=t-n+1,i=Math.max(0,Math.min(.99,r.percentRightMargin/100));o+=i*e/(1-i)}this._model.setTimeViewport(n,o)}_onSeriesError(e){let t=e.error;const i=e.ctx;if(i){const e={};Object.keys(i).forEach((t=>{e[t]=i[t].toString()})),t=t.format(e)}Ze&&et.logNormal("Error reason: "+t),this._seriesErrorMessage=t;const s=Xe&&this.symbolInfo()?10:4;this._setStatus(s),this._seriesLoaded=!0,this._sendTelemetryCounter("series_error",this._getTelemetryAdditionalData(t)),this._enablePriceRangeReady()}_onSeriesLoading(e){this._setStatus(2)}_onDataUpdated(e,t,i,s,n){t&&n&&this._colorOnPrevBar()&&this._precomputedBarStyles.delete(n.value);const o=this.symbolInfo();if(s&&o){let e=0,t=0;if((0,y.hasVolume)(o))for(const i of this.bars().fullRangeIterator()){const s=i.value[5];0!==s&&(e+=s,t+=1)}this._volumePointWeights=t>0?new H.VolumeBasedTimePointWeights(e/t):null,this._updateTimeScaleTimePointWeights()}if(null!==this._volumePointWeights){const e=t?this.bars().fullRangeIterator():i?this.bars().rangeIterator(i.index,(0,r.ensureNotNull)(this.bars().lastIndex())):null;if(null!==e)for(const t of e)this._volumePointWeights.setVolume(t.index,t.value[5])}t?this._requestMoreDataAvailable=!0:this._lastPriceAnimationActive&&this._seriesLoaded&&this._lineStyleLastPriceCirclePaneView.update((0,ce.sourceChangeEvent)(this.id())),this._lastBarCloseTime=e&&e.closeTime||null,this._boxSizeValue.setValue(this.data().boxSize),this._statusView.update(),this.clearAveragePriceCache(),this.clearHighLowPriceCache();const a=this.model(),l=(0,r.ensureNotNull)(a.paneForSource(this));a.recalculatePane(l,(0,ce.sourceChangeEvent)({sourceId:this.id(),realtime:!t,firstUpdatedTimePointIndex:i?.index??void 0})),a.updateSource(this)}_setStatus(e){const t={...this._status.value(),seriesStatus:e};this._updateStatus(t),this._statusView.update(),this.model().updateSource(this),this._onStatusChanged.fire()}_onBarReceived(e){
this.model().recalcVisibleRangeStudies(u.RecalcVisibleRangeStudiesReason.DataUpdate)}_onUnsupportedResolutionRequested(){const e=(0,r.ensureNotNull)(this._getStateForUnsupportedResolution());this._seriesErrorMessage=e.reason,this._unsupportedResolutionState.setValue(e),this._setStatus(14),this._seriesLoaded=!0,this._seriesSource.clearData(),this._model.timeScale().points().clear(),this._enablePriceRangeReady()}_getStateForUnsupportedResolution(){const e=this.symbolInfo();if(null===e)return null;const t=this.interval(),i=(0,Re.getResolutionUnsupportedReason)(e,t);if(null===i)return null;const s=e.name;if("less_than_frequency"!==i){let e=["D","W","M"];return{ticker:s,reason:i,unsupportedResolution:t,applicableResolution:e[0],supportedResolutions:e}}{const n=(0,r.ensureDefined)(e.data_frequency);let o=(0,pe.getApplicableIntervalForFrequency)(n,t);const a=this._model.defaultResolutions();if(!(a.includes(o)||window.is_authenticated&&window.user.is_pro)){const e=a.find((e=>(0,pe.compareResolutions)(e,o)>=0));o=e??a[a.length-1]}return{ticker:s,reason:i,applicableResolution:o,unsupportedResolution:t,supportedResolutions:[]}}}_recreateFormatter(){this._defaultFormatter=(0,y.createSeriesFormatter)(this.symbolInfo()??this._formattingDeps,"default"),this._formatter=(0,y.createSeriesFormatter)(this.symbolInfo()??this._formattingDeps,this.properties().childs().minTick.value()),this._ignoreMinMoveFormatter=(0,y.createSeriesFormatter)(this.symbolInfo(),this.properties().childs().minTick.value(),!0),this._priceScale?.updateFormatter(),this._formatterChanged.fire()}_recreatePriceStep(){const{minMove:e,priceScale:t}=(0,y.getSeriesPriceFormattingState)(this.symbolInfo()),i=e/t;this._ignoreMinMovePriceStep=1/t,this._priceStep!==i&&(this._priceStep=i,this._priceStepChanged.fire())}_recreatePriceFormattingDependencies(){this._recreateFormatter(),this._recreatePriceStep()}_onQuotesUpdate(e,t){{const e=void 0!==t.values.change||void 0!==t.values.change_percent;e&&tt&&this._legendView.update();const i=void 0!==t.values.prev_close_price;i&&((0,r.ensureNotNull)(this._prevClosePriceLineView).update((0,ce.sourceChangeEvent)(this.id())),(0,r.ensureNotNull)(this._prevClosePriceAxisView).update((0,ce.sourceChangeEvent)(this.id()))),(e||i)&&this.model().updateSource(this)}void 0!==e.values.current_session&&e.values.current_session!==this._currentSession&&(this._currentSession=e.values.current_session,this._updateLastPriceAnimationActive())}_updateIsPrePostMarketPricesForbiddenProperty(){const e=this.symbolInfo(),t=(0,y.symbolHasPreOrPostMarket)(e)&&(this.isDWM()||!!e&&(0,y.isRegularSessionId)(this.sessionIdProxyProperty().value(),e));this._isPrePostMarketPricesAvailableProperty.setValue(t)}_updateSettlementAsCloseForbiddenProperty(){const e=this.isDWM()&&Boolean(this.symbolInfo()?.has_settlement);this._isSettlementAsCloseForbiddenProperty.setValue(!e)}_updateBackAdjustmentForbiddenProperty(){const e=Boolean(this.symbolInfo()?.has_backadjustment);this._isBackAdjustmentForbiddenProperty.setValue(!e)}_removeReplaySubscriber(){{
if(!this.isInReplay().value())return;const e=this._replaySubscriber.value();this._replaySubscriber.setValue(null),this._isReplayResolutionAvailableForUser=null,this._onInReplayStateChanged.fire(),e?.onSeriesModified().unsubscribeAll(this),e?.destroy()}}_getSymbolForApi(){return this.symbol()}_getSymbolObject(e){const t=this._getExtendedSymbolObject(e),i=this.properties().childs().style.value();if(S.SYMBOL_STRING_DATA.hasOwnProperty(i)&&!S.chartStylesWithAttachedStudies.includes(i)){return{symbol:t,type:this.styleStudyInfo(this.getStyleShortName()+"Style").studyId+"!",inputs:this.getInputsProperties().state()}}return t}_getExtendedSymbolObject(e){const t={symbol:e??this._getSymbolForApi()},i=this.properties().childs();null!==this.currency()&&(t["currency-id"]=this.currency());const s=this.unit();return this._model.unitConversionEnabled()&&null!==s&&(t["unit-id"]=s),this.isDWM()||(t.session=i.sessionId.value()),t.adjustment=i.dividendsAdjustment.value()?"dividends":"splits",i.backAdjustment.value()&&(t.backadjustment="default"),i.settlementAsClose.value()||(t["settlement-as-close"]=!1),t}_checkChartStyle(){const e=this.style();(0,y.isCloseBasedSymbol)(this.symbolInfo())||this.intervalObj().value().is1Tick()?(0,y.isSingleValueBasedStyle)(e)||(this.requestingStyleIsNotSupported.fire(),this._styleToRecover={correctedStyle:this.style(),originalStyle:e}):null!==this._styleToRecover&&(this.requestingStyleSupportRecovered.fire(this._styleToRecover.originalStyle),this._styleToRecover=null)}_updateSymbolInfo(e){if(this._symbolInfo.setValue(e),e){const t=this._properties.childs();t.shortName.setValue(e.name);const i=(0,y.extractSymbolNameFromSymbolInfo)(e,this.symbol());i&&t.symbol.setValue(i);const s=(0,y.symbolCurrency)(e),r=(0,y.symbolUnit)(e,this._model.unitConversionEnabled());"alwaysOff"===(0,P.currencyUnitVisibilityProperty)().value()||s===t.currencyId.value()&&r===t.unitId.value()||this._model.fullUpdate(),t.currencyId.setValue(s),t.unitId.setValue(r),this._updateSessionIdProxyProperty(!0)}this._base=e?e.pricescale/e.minmov:100,this._pointValue=e&&e.pointvalue||1;const t=(0,ne.encodeExtendedSymbolOrGetSimpleSymbolString)(this._getExtendedSymbolObject());this._quotesProvider.setQuotesSessionSymbol(t),this._marketStatusModel.setSymbolInfo(e),e&&this._recreatePriceFormattingDependencies(),this._statusView.update(),this.priceScale().updateFormatter(),this._symbolResolvingActive.setValue(!e),this._updateIsPrePostMarketPricesForbiddenProperty(),this._dataPoweredBy=(0,D.getDataVendorString)(e),this._updateBackAdjustmentForbiddenProperty(),this._updateSettlementAsCloseForbiddenProperty()}_createHighLowAvgViews(){const e=this.properties().childs().highLowAvgPrice,t=this._getHighLowPrice.bind(this),i=(0,Z.createHighLowViews)(this._model,this,e,t);this._highLowAvgPaneViews.push(...i.paneViews),this._labelPaneViews.push(...i.panePriceAxisViews),this._priceAxisViews.push(...i.priceAxisViews),this._priceLineAxisViews.push(...i.priceLineAxisViews)}_createAverageViews(){}_getHighLowPrice(e){if(!this._highLowPriceCache.has(e)){
const e=this._model.timeScale().visibleBarsStrictRange();if(null===e)return null;const t=function(e,t,i){return e.minMaxOnRangeCached(t,i,[{name:"low",offset:0},{name:"high",offset:0}])}(this._model.mainSeries().bars(),e.firstBar(),e.lastBar());if(null===t)return null;this._highLowPriceCache.set(1,t.min),this._highLowPriceCache.set(0,t.max)}return this._highLowPriceCache.get(e)}_getAveragePrice(e){return null}_updateCompleteStatusMode(e){switch(e="pulsed"===e?"delayed":e){case"streaming":this._setStatus(3);break;case"endofday":this._setStatus(6);break;case"delayed":this._setStatus(8);break;case"replay":this._setStatus(11)}e.match(/delayed_streaming/)&&this._setStatus(9)}_onSeriesCompleted(e){if(14===this._status.value().seriesStatus)return;this._sendTelemetryCounter("series_loaded",this._getTelemetryAdditionalData()),this._seriesErrorMessage=null,this._updateCompleteStatusMode(e.updateMode),this._lastCompleteFlags=e.flags??null;const t=(0,r.ensureNotNull)(this._model.paneForSource(this));t.recalculatePriceScale(this.priceScale(),(0,ce.sourceChangeEvent)(this.id()));const s=le.InvalidationMask.full();if(null!==this._model.appliedTimeFrame().value()&&s.lockVisibleTimeRangeOnResize(),this._model.invalidate(s),!this.priceScale().isLockScale()||this.model().timeScale().isEmpty()||this._seriesLoaded||(this.model().timeScale().correctOffset(),this.model().timeScale().correctBarSpacing(),this.model().resetPriceScale(t,this.priceScale())),this._seriesLoaded=!0,this._seriesCompleted=!0,this.model().recalcVisibleRangeStudies(u.RecalcVisibleRangeStudiesReason.SeriesCompleted),this.model().recalcStudyBasedLineTools(),!it){it=!0;(0,i(975420).trackTiming)("Chart","Time to series",window.performance.now())}if(this.requestMoreData(),null!==this._savedLeftEdge&&2!==this._status.value().seriesStatus){const e=1e3*this._savedLeftEdge,t=this._pendingScrollToLeftEdge;setTimeout((()=>{this._model.syncTimeWithModel((0,r.ensureNotNull)(this.syncModel()).syncSourceTarget(),e,{targetPointAlignment:"left",alignIfTargetPointIsVisible:!0,autoscaleAfterScroll:!1}).then((()=>{t?.resolve()})).catch((()=>{}))}),0),this._savedLeftEdge=null,this._pendingScrollToLeftEdge=null}this._enablePriceRangeReady()}_notifyIntervalChanged(e){const t={timeframe:this._pendingTimeRange??void 0};this._intervalChanged.fire(e,t),this._pendingTimeRange=t.timeframe??null}_onCurrencyChanged(){this._currencyChanged.fire()}_onUnitChanged(){this._unitChanged.fire()}_saveLeftEdgeIfRequired(e,t=null){if(this._savedLeftEdge=null,!t&&!e&&this._model.properties().childs().scalesProperties.childs().saveLeftEdge.value()){const e=this._model.timeScale();if(!e.isEmpty()){let t=e.visibleBarsStrictRange()?.firstBar();if(void 0!==t){const i=this._seriesSource.data()?.bars().first();return null!=i&&(t=Math.max(t,i.index)),this._savedLeftEdge=e.indexToTimePoint(t),this._pendingScrollToLeftEdge=(0,l.createDeferredPromise)(),!0}}}return!1}async _processReplayOnApplySymbolParamsChanges(e,t){if(this.isInReplay().value()){const i=()=>this._removeReplaySubscriber()
;e&&(C.Interval.isRange(t)||C.Interval.isTicks(t)?i():(0,r.ensureNotNull)(this._isReplayResolutionAvailableForUser)(t)?await this.canChangeResolution(t)||i():(i(),this._paramsNotApplicableForReplay.fire(3,"changeResolution")))}}async _applySymbolParamsChanges(e){this._lastCompleteFlags=null,this.clearGotoDateResult();const t=this.interval(),i=this.currency(),s=this.unit();C.Interval.isRange(t)&&this._properties.childs().rangeStyle.childs().inputs.childs().range.setValue(C.Interval.parse(t).multiplier());const{symbolChanged:r,intervalChanged:n,currencyChanged:o,unitChanged:a,force:l}=e,h=n&&C.Interval.parse(t).isDWM()!=C.Interval.parse(t).isDWM();if((null!==i&&o||null!==s&&a)&&this.isInReplay().value()){const e=this.symbolInfo();(null===e||null!==i&&e.original_currency_id!==i||null!==s&&e.original_unit_id!==s)&&this._removeReplaySubscriber()}if(this._syncModel=null,this._prevRequestedInterval=t,5!==this._status.value().seriesStatus&&(!this._seriesSource.isStarted()||r||o||a||h)&&this._updateSymbolInfo(null),this._processReplayOnApplySymbolParamsChanges(!!n,t),5===this._status.value().seriesStatus)return void this._model.realignLineTools();this._setStatus(1),this._updateIsPrePostMarketPricesForbiddenProperty(),this._updateBackAdjustmentForbiddenProperty(),this._updateSettlementAsCloseForbiddenProperty(),this._symbolIntervalChanged.fire(),n&&this._notifyIntervalChanged(t),this._onRestarted.fire(),this._seriesLoaded=!1,this._seriesCompleted=!1,this._lineStyleLastPriceCirclePaneView.stopAnimation();let d=null;this._pendingTimeRange&&(d=this._pendingTimeRange,this._pendingTimeRange=null),this._onTimeFrameApplied.fire(d),this._onBeforeModifySeries(this.getSymbolString(),t);const c=this._shouldDefineNumberOfBarsForModifySeries(e)&&this._visibleBarsCount()||null;this.model().recalcVisibleRangeStudies(u.RecalcVisibleRangeStudiesReason.SeriesRestart),this._saveLeftEdgeIfRequired(!!r,d),this._data=null,this._seriesSource.modifySeries(this._getResolvingSymbolObject(),(0,_e.getServerInterval)(t),d,l,c),this._seriesSource.isStarted()||(this._predictBars=0,this._seriesSource.start()),(r||o||a)&&this.disablePriceRangeReady(),this.updateAllViews((0,ce.sourceChangeEvent)(this.id())),this._model.lightUpdate(),this._pendingScrollToLeftEdge&&await this._pendingScrollToLeftEdge.promise}async _onBeforeModifySeries(e,t){const i=this._replaySubscriber.value();i?.modifySeries(e,t)}_getResolvingSymbolObject(){let e=this._getSymbolObject(this._symbolForResolve());const t=this._replaySubscriber.value();return t&&(e=t.generateReplaySymbol(e)),e}_onSessionIdPropertyChanged(){this._sessionIdChanged.fire(),this.isDWM()||(this._saveLeftEdgeIfRequired(!1),this.restart(this._properties.childs().sessionId,"sessionId",!0),this._updateLastPriceAnimationActive())}_subscribeRestartToSessionIdChange(){this.properties().childs().sessionId.subscribe(this,this._onSessionIdPropertyChangedBound)}_unsubscribeRestartToSessionIdChange(){this.properties().childs().sessionId.unsubscribe(this,this._onSessionIdPropertyChangedBound)}_updateLastPriceAnimationActive(){
if(!this._options.lastPriceAnimationEnabled||Q.enabled("disable_pulse_animation"))return;const e=this._lastPriceAnimationActive,t=this.properties().childs(),i=t.style.value(),s=3===i||10===i||2===i||14===i||15===i,r=this.symbolInfo();if(!this._model.isSnapshot()&&t.visible.value()&&s&&r){const e=this.currentSession(),t=!(0,y.isRegularSessionId)(this.sessionIdProxyProperty().value(),r)&&!this.isDWM();this._lastPriceAnimationActive="market"===e||t&&("pre_market"===e||"post_market"===e)}else this._lastPriceAnimationActive=!1;this._lastPriceAnimationActive&&e!==this._lastPriceAnimationActive&&this.model().invalidate(le.InvalidationMask.cursor())}_onPropertiesChanged(e){const t=this._properties.childs();if(e===t.symbol||e===t.interval||e===t.timeframe)return;const i=this._id.value();this._tagsChanged.fire(),this.createPaneView(),this.updateAllViews((0,ce.sourceChangeEvent)(i)),this.model().updateSource(this),(0,o.emit)("series_properties_changed",i)}_recalcSymbolTextSourceProxyProperty(){this._textSourceIsAlwaysTickerRestrictionEnabled?this._symbolTextSourceProxyProperty.setValue("ticker"):this._symbolTextSourceProxyProperty.setValue(this._properties.childs().statusViewStyle.childs().symbolTextSource.value())}_clearStylePlot(e,t){if(0===e.size())return;if(void 0===t&&e!==this.nsBars())return void(this._precomputedBarStyles=new WeakMap);const i=t??(0,r.ensureNotNull)(e.firstIndex()),s=(0,r.ensureNotNull)(e.lastIndex())+1;e.range(i,s).each(((e,t)=>(this._precomputedBarStyles.delete(t),!1)))}_visibleBarsCount(){const e=this._model.timeScale().visibleBarsStrictRange();return e?.count()}_symbolForResolve(){const e=this.symbol();return this._seriesSource.symbolSameAsResolved(e)?this._seriesSource.resolvedSymbol()??e:e}_shouldDefineNumberOfBarsForModifySeries(e){return!1}_onShowCountdownChanged(e){e.value()?this._countdownUpdateTimer=this._model.setInterval((()=>{this._priceAxisView.updateCountdown?.(),this._projectionPriceAxisView.updateCountdown?.()}),500):null!==this._countdownUpdateTimer&&(this._model.clearInterval(this._countdownUpdateTimer),this._countdownUpdateTimer=null)}_onFormatterPropsChanged(){this._recreateFormatter(),this._model.fullUpdate()}_updateStatus(e){14!==e.seriesStatus&&this._unsupportedResolutionState.setValue(null),this._status.setValue(e)}_wasCompletedBefore(){return this.isCompleted()&&(this._studyBindings?.wasCompletedBefore()??!0)}_colorOnPrevBar(){const e=new Map([[1,"candleStyle"],[0,"barStyle"],[19,"volCandlesStyle"],[8,"haStyle"],[13,"columnStyle"]]);e.set(17,"volFootprintStyle");const t=e.get(this.style());return!!t&&this._properties.childs()[t].childs().barColorsOnPrevClose.value()}}},87521:(e,t,i)=>{"use strict";i.d(t,{TimeAxisView:()=>o});var s=i(534328),r=i(688857);class n{constructor(){this._data=null}setData(e){this._data=e}draw(e,t,i){if(null===this._data||!this._data.visible||0===this._data.text.length)return;const s=this._data;e.font=i.font;const n=Math.round(i.widthCache.measureText(e,s.text));if(n<=0)return;e.save();const o=i.paddingHorizontal,a=n+2*o,l=a/2
;let h=s.coordinate,u=Math.floor(h-l)+.5;if(s.alwaysInViewPort){const e=s.width;u<0?(h+=Math.abs(0-u),u=Math.floor(h-l)+.5):u+a>e&&(h-=Math.abs(e-(u+a)),u=Math.floor(h-l)+.5)}const d=u+a,c=Math.ceil(0+i.borderSize+i.offsetSize+i.paddingTop+i.fontSize+i.paddingBottom),{horizontalPixelRatio:p,verticalPixelRatio:_}=t;e.fillStyle=s.background;const m=Math.round(u*p),y=Math.round(0*_),g=Math.round(d*p),b=Math.round(c*_),S=Math.round(2*p);e.beginPath(),e.moveTo(m,y),e.lineTo(m,b-S),e.arcTo(m,b,m+S,b,S),e.lineTo(g-S,b),e.arcTo(g,b,g,b-S,S),e.lineTo(g,y),e.fill();const v=0+i.borderSize+i.offsetSize+i.paddingTop+i.fontSize/2;e.textAlign="left",e.textBaseline="middle",e.fillStyle=s.color;const f=i.widthCache.yMidCorrection(e,"Apr0");e.translate((u+o)*p,(v+f)*_),(0,r.drawScaled)(e,p,_,(()=>e.fillText(s.text,0,0))),e.restore()}}class o{constructor(e){this._renderer=new n,this._rendererData={background:"",color:"",coordinate:0,text:"",visible:!1,width:0,alwaysInViewPort:!0},this._invalidated=!0,this._model=e,this._renderer.setData(this._rendererData)}update(){this._invalidated=!0}renderer(){return this._invalidated&&(this._updateImpl(),this._invalidated=!1),this._renderer}coordinate(){return this._rendererData.coordinate}_getAlwaysInViewPort(){return!0}_getText(e){const t=this._model.timeScale().indexToUserTime(e);return null!==t?this._model.dateTimeFormatter().format(t):""}_updateImpl(){const e=this._rendererData;if(e.visible=!1,this._model.timeScale().isEmpty()||!this._isVisible())return;const t=this._getIndex();null!==t&&Number.isFinite(t)&&(e.visible=!0,e.width=this._model.timeScale().width(),e.background=this._getBgColor(),e.color=(0,s.colorFromBackground)(e.background),e.coordinate=this._model.timeScale().indexToCoordinate(t),e.alwaysInViewPort=this._getAlwaysInViewPort(),e.text=this._getText(t),this._invalidated=!1)}}},410022:(e,t,i)=>{"use strict";window.TradingView=window.TradingView||{},i(778785).setClasses(),i(431021),i(128327).install(),i(638456),i(142492),i(957259),i(190209),i(819982),i(125226),i(49437),i(558199),i(62802),i(5368)},540921:(e,t,i)=>{"use strict";i(144762),i(410022);var s=i(650151),r=i(62802),n=i(931924);n.enabled("use_localstorage_for_settings")&&r.default.sync(void 0);var o=i(444372),a=i(85858),l=i(179353),h=i(569897),u=i(516350),d=i(47728),c=i(583912),p=i(212363),_=i.n(p),m=i(934440),y=i.n(m),g=i(534197),b=i(388741),S=i(477786),v=i(596443);function f(){return Promise.all([i.e(11638),i.e(32451),i.e(45702)]).then(i.bind(i,872770))}var w=i(820028);class P{constructor(e,t){this._visibility=new w.WatchedValue(!1),this._dialogPromise=null,this._dialog=null,this._chartWidgetCollection=e,this._options=t}visible(){return this._visibility.readonly()}show(e,t,i){const s=Array.isArray(e)?e:[],r=Array.isArray(e)?void 0:e;null===this._dialog&&this._requestDialog(s??[],t,i,r),this._dialog?.open(s??[],this._options?.indicatorsPreloader?.getIndicatorPromises(),t,i,r)}hide(){this._dialog?.hide()}getDialog(){return this._dialog}resetAllPages(){this._dialog?.resetAllStudies()}_requestDialog(e,t,s,r){
if(null===this._dialogPromise){let n;n=this._options?.onWidget?Promise.all([i.e(23532),i.e(18883),i.e(15371),i.e(98185),i.e(92537),i.e(46195),i.e(32937),i.e(83439),i.e(61681),i.e(98933),i.e(19190),i.e(25563),i.e(97540),i.e(72232),i.e(66032),i.e(87833),i.e(50874),i.e(84587),i.e(46518),i.e(93015),i.e(82332),i.e(44535),i.e(19175),i.e(85014),i.e(28260),i.e(15377),i.e(37463),i.e(28158),i.e(91152),i.e(74671),i.e(13203),i.e(76148),i.e(66822),i.e(82321),i.e(87473),i.e(83420),i.e(56151),i.e(6456)]).then(i.bind(i,230017)).then((e=>new e.IndicatorsLibraryContainer(this._chartWidgetCollection,this._options))):Promise.all([i.e(23532),i.e(18883),i.e(15371),i.e(98185),i.e(92537),i.e(46195),i.e(32937),i.e(83439),i.e(61681),i.e(98933),i.e(19190),i.e(25563),i.e(97540),i.e(72232),i.e(66032),i.e(87833),i.e(50874),i.e(84587),i.e(46518),i.e(93015),i.e(82332),i.e(44535),i.e(19175),i.e(85014),i.e(28260),i.e(15377),i.e(37463),i.e(28158),i.e(91152),i.e(74671),i.e(13203),i.e(76148),i.e(66822),i.e(82321),i.e(87473),i.e(83420),i.e(56151),i.e(6456)]).then(i.bind(i,434057)).then((e=>new e.IndicatorsContainer(this._chartWidgetCollection))),this._dialogPromise=n.then((i=>{this._dialog=i,this._dialog.visible().subscribe((e=>{this._visibility.setValue(e)})),this._dialog.open(e,this._options?.indicatorsPreloader?.getIndicatorPromises(),t,s,r)}))}return this._dialogPromise}}var C=i(647643),A=i(518594),T=i(331633),I=i(778785),V=i(950668),L=i(998886),x=i(981191);const D={8:[V.timeFrames.ytd,V.timeFrames["12m"],V.timeFrames["60m"],V.timeFrames.all],3:[V.timeFrames["1d"],V.timeFrames["5d"],V.timeFrames["1m"],V.timeFrames["3m"],V.timeFrames["6m"],V.timeFrames.ytd,V.timeFrames["12m"],V.timeFrames["60m"],V.timeFrames.all]},E=new Map([["1D",(0,x.getFromForDay)(1)],["5D",(0,x.getFromForDay)(5)],["7D",(0,x.getFromForDay)(7)],["1M",(0,x.getFromForMonthsAgo)(1)],["3M",(0,x.getFromForMonthsAgo)(3)],["6M",(0,x.getFromForMonthsAgo)(6)],["12M",(0,x.getFromForYearsAgo)(1)],["24M",(0,x.getFromForYearsAgo)(2)],["36M",(0,x.getFromForYearsAgo)(3)],["60M",(0,x.getFromForYearsAgo)(5)],["YTD",(0,x.getStartOfTheYear)()],["LASTSESSION",(0,x.getFromForDay)(1)],["ALL",-1/0]]);function R(e,t,i=-1/0){let r;null!==e?r=(D[3]||[]).filter((t=>null===(0,L.getResolutionUnsupportedReason)(e,t.targetResolution))):(9===t&&(t=3),6===t&&(t=8),r=D[t]||[]);const n=[];for(let e=0;e<r.length;e++){const t=r[e];if(n.push(t),(0,s.ensureDefined)(E.get(t.value.value))<i)break}return n.length&&"ALL"!==n[n.length-1].value.value&&(n[n.length-1]={...n[n.length-1],text:V.timeFrames.all.text,value:{...n[n.length-1].value,value:V.timeFrames.all.value.value}}),n}function k(e,t,i){const s={name:e,frameElementId:t,data:i};window.parent.postMessage(s,"*")}function F(e,t){function i(i){i.data&&i.data.name&&i.data.name===e&&t(i.data.data)}return window.addEventListener("message",i,!1),()=>{window.removeEventListener("message",i,!1)}}var M,N;function B(e){
return"seekingalpha"===e||"smartlab-custom"===e?Promise.all([i.e(18699),i.e(98185),i.e(46195),i.e(83439),i.e(61681),i.e(61171),i.e(98933),i.e(19190),i.e(67780),i.e(66032),i.e(13672),i.e(3359),i.e(84587),i.e(30158),i.e(1462),i.e(15708),i.e(10844),i.e(98412),i.e(44213),i.e(54320),i.e(51979),i.e(95275),i.e(28260),i.e(47827),i.e(30683),i.e(78628),i.e(16956),i.e(99700),i.e(43946),i.e(6376),i.e(59901),i.e(39906),i.e(60307),i.e(93014),i.e(74671),i.e(87192),i.e(39030),i.e(70396),i.e(82321),i.e(74327),i.e(27766),i.e(19026),i.e(13630)]).then(i.bind(i,913630)):"cme"===e?Promise.all([i.e(96378),i.e(98185),i.e(46195),i.e(83439),i.e(61681),i.e(61171),i.e(98933),i.e(19190),i.e(67780),i.e(66032),i.e(13672),i.e(3359),i.e(84587),i.e(30158),i.e(1462),i.e(15708),i.e(10844),i.e(98412),i.e(44213),i.e(54320),i.e(51979),i.e(95275),i.e(28260),i.e(47827),i.e(30683),i.e(78628),i.e(16956),i.e(99700),i.e(43946),i.e(6376),i.e(59901),i.e(39906),i.e(60307),i.e(93014),i.e(74671),i.e(87192),i.e(82321),i.e(74327),i.e(27766),i.e(19026),i.e(66392)]).then(i.bind(i,66392)):Promise.all([i.e(79706),i.e(98185),i.e(46195),i.e(83439),i.e(61681),i.e(61171),i.e(98933),i.e(19190),i.e(67780),i.e(66032),i.e(13672),i.e(3359),i.e(84587),i.e(30158),i.e(1462),i.e(15708),i.e(10844),i.e(98412),i.e(44213),i.e(54320),i.e(51979),i.e(95275),i.e(28260),i.e(47827),i.e(30683),i.e(78628),i.e(16956),i.e(99700),i.e(43946),i.e(6376),i.e(59901),i.e(39906),i.e(60307),i.e(93014),i.e(74671),i.e(87192),i.e(70396),i.e(82321),i.e(74327),i.e(27766),i.e(19026),i.e(1223)]).then(i.bind(i,901223))}!function(e){let t;!function(e){e.SetSymbol="set-symbol",e.SetInterval="set-interval"}(t=e.Names||(e.Names={}))}(M||(M={})),function(e){let t;!function(e){e.SymbolClick="tv-widget-symbol-click",e.WidgetLoad="tv-widget-load",e.WidgetReady="tv-widget-ready",e.ResizeIframe="tv-widget-resize-iframe",e.NoData="tv-widget-no-data"}(t=e.Names||(e.Names={}))}(N||(N={}));var W=i(87913),O=i(529751),U=i(638456),z=i(470316);const j=["LineToolTrendLine","LineToolRay","LineToolInfoLine","LineToolExtended","LineToolRegressionTrend","LineToolRotatedRectangle","LineToolParallelChannel","LineToolFlatBottom","LineToolDisjointAngle","LineToolPitchfork","LineToolSchiffPitchfork","LineToolSchiffPitchfork2","LineToolInsidePitchfork","LineToolVertLine","LineToolCrossLine","LineToolHorzLine","LineToolHorzRay","LineToolTrendAngle"];function G(e,t=!1,a=!1){if(!n.enabled("popup_hints"))return()=>{};const l=e.getContainer();let h=null,u=null,d=null;return W.tool.subscribe(c),W.createdLineTool.subscribe(null,p),W.finishedLineTool.subscribe(null,_),e.layoutSizesChanged().subscribe(m),t||U.CheckMobile.any()||!g("hint.startFocusedZoom")||(d=function(e,t){let i=!1;const s=r=>{r?(i&&t(r),e.onZoom().unsubscribe(null,s)):i||(t(r),i=!0)};return e.onZoom().subscribe(null,s),()=>e.onZoom().unsubscribe(null,s)}(e,(function(e){if(!g("hint.startFocusedZoom"))return;if(e)u&&(d=null,b("hint.startFocusedZoom"));else{y(o.t(null,void 0,i(681712)).format({key:(0,z.humanReadableModifiers)(z.Modifiers.Mod,!1)}),"hint.startFocusedZoom")}}))),()=>{
W.tool.unsubscribe(c),W.createdLineTool.unsubscribe(null,p),W.finishedLineTool.unsubscribe(null,_),e.layoutSizesChanged().unsubscribe(m),d?.()};function c(){const t=W.tool.value(),s=U.CheckMobile.any();if(h?.hide(),!s&&(0,W.toolIsDemonstration)(t)&&g("hint.demonstrationCursorSelected")){return void y(o.t(null,void 0,i(187133)).format({key:(0,z.humanReadableModifiers)(z.Modifiers.Alt,!1)}),"hint.demonstrationCursorSelected")}if(a&&s&&(r=t,j.includes(r)))return void async function(t){{const s=()=>(0,W.resetToCursor)(!0);if(h)h.show(t,s);else{const{DrawingHintsRenderer:r}=await Promise.all([i.e(71731),i.e(19190),i.e(65874),i.e(82321),i.e(35858)]).then(i.bind(i,953745));h=new r(e),t===W.tool.value()&&h.show(t,s)}}}(t);var r;if("LineToolTextAbsolute"===t&&g("hint.anchoredTextWillBeRemoved"))return void y(o.t(null,void 0,i(277705)),"hint.anchoredTextWillBeRemoved");if(!g("hint.touchPainting"))return;const n=(0,O.isLineToolDrawWithoutPoints)(t);!(0,O.isStudyLineToolName)(t)||"LineToolRegressionTrend"===t||n||s?(0,O.isLineToolName)(t)&&!(0,O.isLineDrawnWithPressedButton)(t)&&!n&&s?y(o.t(null,void 0,i(360663)),"hint.touchPainting"):u&&u.hide():y(o.t(null,void 0,i(414985)),"hint.touchPainting")}function p(){const e=W.tool.value();"LineToolPath"===e&&g("hint.finishBuildPathByDblClick")?y(o.t(null,void 0,i(275296)),"hint.finishBuildPathByDblClick"):"LineToolPolyline"===e&&g("hint.finishBuildPolylineByDblClick")&&y(o.t(null,void 0,i(317409)),"hint.finishBuildPolylineByDblClick")}function _(){if(u){const e=W.tool.value();"LineToolPath"===e?b("hint.finishBuildPathByDblClick"):"LineToolPolyline"===e&&b("hint.finishBuildPolylineByDblClick")}}function m(){if(!g("hint.startResizingChartInLayout"))return;y(U.CheckMobile.any()?o.t(null,void 0,i(436539)):o.t(null,void 0,i(9430)),"hint.startResizingChartInLayout")}function y(e,t){if(u)u.show(e,b.bind(null,t));else{const s=W.tool.value();Promise.all([i.e(46195),i.e(50628),i.e(82321),i.e(26166)]).then(i.bind(i,410837)).then((i=>{u=new i.ChartEventHintRenderer(l),s===W.tool.value()&&u.show(e,b.bind(null,t))}))}}function g(e){return!Boolean(r.getBool(e))}function b(e){r.setValue(e,!0,{forceFlush:!0}),(0,s.ensureNotNull)(u).destroy(),null!==d&&d(),u=null}}var H=i(251954);function q(e,t){const r=o.t(null,void 0,i(337367)).format({emoji:"👍"}),n=o.t(null,void 0,i(569804)).format({emoji:"👍"}),a=o.t(null,void 0,i(506655)).format({emoji:"👍"});H.on("onServerScreenshotCopiedToClipboard",(()=>u(r)),null),H.on("onClientScreenshotCopiedToClipboard",(()=>u(n)),null),H.on("onServerScreenshotEmbedCodeCopiedToClipboard",(()=>u(a)),null);let l=null;const h=e.getContainer();function u(e){l?l.show(e):Promise.all([i.e(15371),i.e(63585),i.e(4768),i.e(82321),i.e(30092)]).then(i.bind(i,360126)).then((i=>{l||(l=new i.ChartScreenshotHintRenderer((0,s.ensureNotNull)(h),{bottomPadding:t.seriesControlBarEnabled}),l.show(e))}))}}var K=i(261309),$=i(564894);class Y{constructor(e=[]){this._list={id:"DEFAULT_SINGLE_WATCHLIST",type:"custom",name:o.t(null,void 0,i(512504)),description:null,symbols:[...e],shared:!1,
persistedState:null}}getCustomWatchLists(){return Promise.resolve([this._list])}getSymbols(e){return Promise.resolve(this._list.symbols)}createWatchList(e){throw new Error("not implemented")}putWatchList(e){throw new Error("not implemented")}removeWatchList(e){throw new Error("not implemented")}renameWatchList(e,t){return Promise.resolve(null)}replaceSymbols(e,t){return this._list.symbols=[...t],Promise.resolve(this._list.symbols)}addSymbols(e,t){return this._list.symbols.push(...t),Promise.resolve(this._list.symbols)}removeSymbols(e,t){return this._list.symbols=this._list.symbols.filter((e=>!t.includes(e))),Promise.resolve(this._list.symbols)}setActive(e){return Promise.resolve(this._list)}getActive(){return Promise.resolve(this._list)}changeDescription(e,t){throw new Error("not implemented")}getCustomWatchlist(e){throw new Error("not implemented")}renameSeparator(e,t,i){return Promise.resolve(null)}}var J=i(623213),X=i(547465);const Z=new X.Delegate,Q=new X.Delegate,ee=new X.Delegate,te=new X.Delegate,ie=new X.Delegate;class se{constructor(e=[],t=r){if(this._lists={},this._activeListSettingsKey="widgetbar.widget.watchlist",n.enabled("trading_terminal")&&(this._activeListSettingsKey+="terminal"),this._settings=t,this._settings.onSync.subscribe(this,this._updateLists),this._updateLists(),0===Object.keys(this._lists).length){const t=this._createList({title:this._pickTitle(),symbols:[...e]},!0);this.setActive({id:t.id,type:"custom"})}}destroy(){this._settings.onSync.unsubscribeAll(this)}getCustomWatchLists(){this._updateLists();const e=[];return Object.keys(this._lists).forEach((t=>{const i=this._getList(t);i&&e.push(this._toSymbolList(i))})),Promise.resolve(e)}createWatchList(e){const t=this._createList({id:e.id,title:e.name||this._pickTitle(),symbols:e.symbols||[]});return ee.fire(t.id,[...t.symbols]),Promise.resolve(this._toSymbolList(t))}putWatchList(e){this._updateLists();const t=this._getList(e.id),i=t?.title,s=e.name;return this.saveList({id:e.id,symbols:e.symbols,title:e.name}),void 0!==i&&i!==s&&ie.fire(e.id,i,s),null!==t?Z.fire(e.id):ee.fire(e.id,e.symbols),Promise.resolve(e)}removeWatchList(e){const{id:t}=e;return this._settings.remove(`savedwatch.${t}`,{forceFlush:!0}),delete this._lists[t],te.fire(t),Promise.resolve()}renameWatchList(e,t){this._updateLists();const{name:i}=e;return e.name=t,this.saveList({id:e.id,symbols:e.symbols,title:t}),ie.fire(e.id,i,t),Promise.resolve(null)}replaceSymbols(e,t){const i=this._getList(e.id);return null===i||(i.symbols=[...t],this.saveList(i),Z.fire(e.id)),Promise.resolve(null)}addSymbols(e,t){const i=this._getList(e.id);return null===i?Promise.resolve([]):(i.symbols.push(...t),this.saveList(i),Z.fire(e.id),Promise.resolve([...i.symbols]))}removeSymbols(e,t){const i=this._getList(e.id);return null===i?Promise.resolve([]):(i.symbols=i.symbols.filter((e=>!t.includes(e))),this.saveList(i),Z.fire(e.id),Promise.resolve([...i.symbols]))}setActive(e){return this._settings.setValue(this._activeListSettingsKey,e.id),Q.fire(),Promise.resolve(null)}getActive(){
const e=this._getActive();return Promise.resolve(this._toSymbolList(e))}changeDescription(e,t){throw new Error("not implemented")}renameSeparator(e,t,i){this._updateLists();const s=this._getList(e);if(null===s)return Promise.resolve(null);const r=s.symbols.findIndex((e=>e===t));return s.symbols[r]=i,this.saveList(s),Z.fire(e),Promise.resolve(null)}saveList(e,t=!1){const i={symbols:e.symbols,title:String(e.title)};this._settings.setJSON(`savedwatch.${e.id}`,i,{forceFlush:!0,skipCrossWindowEvent:t}),this._lists[e.id]=i}getCustomWatchlist(e){throw new Error("not implemented")}_createList(e,t=!1){const i={id:e.id??(0,J.randomHash)(),symbols:e.symbols,title:e.title};return this.saveList(i,t),i}_getList(e){if(this._updateLists(),this._lists.hasOwnProperty(e)){const t=this._lists[e];return{id:e,symbols:t.symbols.slice(),title:t.title}}return null}_toSymbolList(e){return{type:"custom",id:e.id,name:e.title,description:null,symbols:e.symbols,shared:!1,persistedState:null}}_updateLists(){this._lists={};this._settings.keys().forEach((e=>{const t=/^savedwatch\.(.*)$/.exec(e);if(!t)return;const i=t[1],s=this._settings.getJSON(e,null);s&&(s.symbols||(s.symbols=[]),this._lists[i]=s)}))}_getActive(){const e=this._settings.getValue(this._activeListSettingsKey),[t,i]=Object.entries(this._lists)[0],s={id:t,...i};return void 0!==e&&this._getList(e)||s}_pickTitle(){this._updateLists();const e=Object.keys(this._lists).map((e=>this._lists[e].title));for(let t=1;;t++){const s=o.t(null,void 0,i(512504))+(t>1?` (${t})`:"");if(-1===e.indexOf(s))return s}}}var re=i(581996);class ne{constructor(e){this._document=e,this.isFullscreen=new w.WatchedValue;const t=()=>{const e=["fullscreenElement","webkitFullscreenElement","mozFullscreenElement","mozFullScreenElement","msFullscreenElement"];for(let t=0;t<e.length;t++){const i=e[t];if(i in this._document){this.isFullscreen.setValue(!!this._document[i]);break}}};t();for(const i of["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","MSFullscreenChange"])e.addEventListener(i,t,!1)}enter(){const e=this._document.documentElement;for(const t of["requestFullscreen","mozRequestFullScreen","webkitRequestFullscreen","msRequestFullscreen"])if("function"==typeof e[t]){e[t]();break}this.isFullscreen.setValue(!0)}exit(){const e=this._document;for(const t of["exitFullscreen","mozCancelFullScreen","mozExitFullscreen","webkitExitFullscreen","msExitFullscreen"])if("function"==typeof e[t]){e[t]();break}this.isFullscreen.setValue(!1)}}class oe{constructor(e){this.isFullscreen=new w.WatchedValue,this._handleExit=e=>{27!==(0,z.hashFromEvent)(e)||e.defaultPrevented||(e.preventDefault(),this.exit())},this._element=e}enter(){this.isFullscreen.setValue(!0),H.emit("onInternalFullscreenShow"),this._element.addEventListener("keydown",this._handleExit)}exit(){this.isFullscreen.setValue(!1),H.emit("onInternalFullscreenHide"),this._element.removeEventListener("keydown",this._handleExit)}}var ae=i(554433),le=i(314802);function he(e,t){let i=0;for(const{min:s,max:r}of t){if(e<s||r<s)continue;const t=Math.min(e,r)
;if(i=Math.max(i,t),e===i)break}return i}function ue(e){const t=[];if(void 0===e)return[];Array.isArray(e)||(e=[e]);for(const i of e){let e,s;isFinite(i)?e=s=Number(i):(e=+i.min,s=+i.max),(e<0||isNaN(e))&&(e=0),isNaN(s)&&(s=1/0),e<=s&&s>0&&t.push({min:e,max:s})}return t.sort(((e,t)=>e.min-t.min||e.max-t.max)),t}function de(e,t){if(e.length!==t.length)return!1;for(let i=e.length;i--;){if(e[i].min!==t[i].min)return!1;if(e[i].max!==t[i].max)return!1}return!0}var ce=i(305141);const pe=n.enabled("no_min_chart_width"),_e=n.enabled("bypass_chart_height_check");function me(e){const t=n.enabled("side_toolbar_in_fullscreen_mode"),i=n.enabled("header_in_fullscreen_mode");return"center"===e||"left"===e&&t||"top"===e&&i}const ye=[...R(null,3)];ye.splice(7,0,V.timeFrames["24m"]);var ge=i(971417),be=i(660603),Se=i(374122);const ve={whitelabel:!0,permissionOverrides:!0};var fe=i(768261),we=i(439563);i(853045);const Pe=window.initData,Ce=window.initData.widgetDefaults,Ae=function(e,t=[],i){return function(e,t,i,s=[],r){const n=i.slice(1),o=decodeURIComponent(n);let a={};try{""!==o&&(a=JSON.parse(o),void 0!==r&&r(e,a),Object.keys(a).forEach((e=>{(ve[e]||s.includes(e))&&delete a[e]})))}catch(e){a={},console.warn("Hash params parsing error! Hash params ignored.")}const l=t.slice(1),h=t.includes("%")?decodeURIComponent(l):t,u=new URLSearchParams(h);let d={};try{u.forEach(((e,t)=>{s.includes(t)||(d[t]=e)})),void 0!==r&&r(e,d)}catch(e){d={},console.warn("Search query params parsing error! Search query params ignored.")}return Object.assign({},e,a,d)}(e,location.search,location.hash,t,i)}(Ce);try{!async function(e){Math.random()>.005||(await(0,we.getEmbedWidgetTracker)())?.trackWidgetLoadMetaInfo(e)}({widget_id:"advanced-chart",symbols:JSON.stringify([Ae.symbol]),customer:Ae.customer})}catch{}const Te=void 0!==Ae.extended_hours?it(Ae.extended_hours)?"extended":"regular":void 0!==Ce.def_extended_hours?it(Ce.def_extended_hours)?"extended":"regular":Ce.def_session_id;const Ie=Ce.customer,Ve=Ce.customerReadableName,Le=Ae.range||Ce.def_range,xe=it(Ae.withdateranges??Ce.def_withdateranges),De=it(Ae.save_image??Pe.def_save_image,!0);let Ee;(void 0===Ae.allow_symbol_change?it(Ce.def_hide_symbol_edit):!it(Ae.allow_symbol_change))&&(n.setEnabled("header_symbol_search",!1),n.setEnabled("disable_legend_inplace_symbol_change",!0),n.setEnabled("symbol_search_hot_key",!1)),n.setEnabled("header_screenshot",Boolean(De)),"bovespa"===Ie&&(n.disable("header_settings"),Ee=[{symbol:"IBOV",title:"Bovespa Index"},{symbol:"IBXX",title:"Brazil 100 Index"},{symbol:"IBXL",title:"Brazil 50 Index"},{symbol:"IBRA",title:"Brazil Broad-Based Index"},{symbol:"IGCX",title:"Special Corporate Governance Stock Index"},{symbol:"ITAG",title:"Special Tag-Along Stock Index"},{symbol:"IGNM",title:"Novo Mercado Corporate Governance Equity Index"}]),window.pro=new u.Pro(window.shopConf);let Re=Ae.symbol||Ce.def_symbol||window.DEFAULT_SYMBOL;"cme"===Ae.symbology&&(Re=(e=>{const t=new(_().SymbolToken)(e);if(!t.root())return e
;const i=d.CMEToTVSymbologyAdapter.convertSymbolDataToTV(t.root(),t.exchange(),Ae.venue??"");return"ok"!==i.status?e:(i.data.symbol&&t.root(i.data.symbol),i.data.exchange&&t.exchange(i.data.exchange),t.toString())})(Re));const ke=y()(parent),Fe=[];let Me,Ne=[];if(Ae.watchlist&&(Ne=(Array.isArray(Ae.watchlist)?Ae.watchlist:Ae.watchlist.split(/\x1f/)).map((e=>e.trim())).filter(Boolean)),Ne.length||Ae.editablewatchlist){const e={type:"watchlist",properties:{list:Ne}};Ae.editablewatchlist?(e.readonly=!1,e.data={hideTitleButton:!0},e.settingsKey="onwidget.watchlist",e.unAuthEditable=!0,function(e){const t=new se(e);(0,$.registerService)(K.SYMBOL_LIST_REPOSITORY_BACKEND_SERVICE,t)}(Ne)):function(e){const t=new Y(e);(0,$.registerService)(K.SYMBOL_LIST_REPOSITORY_BACKEND_SERVICE,t)}(Ne),Fe.push(e)}it(Ae.details)&&Fe.push({type:"detail"}),void 0!==Ae.widgetbar_width&&(Me=+Ae.widgetbar_width),(!Me||!isFinite(Me)||Me<200)&&(Me=200);const Be=Fe.length?[{name:"base",title:o.t(null,void 0,i(708675)),icon:"base",widgets:Fe.map((e=>e))}]:[];Ae.hotlist&&Be.push({name:"hotlist",title:o.t(null,void 0,i(840095)),icon:"hotlists",widgets:[{type:"hotlist",properties:{exchangeByLocale:{default:window.COUNTRY_CODE_TO_DEFAULT_EXCHANGE.en},groupByLocale:{default:"volume_gainers"}}},{type:"hotlist",properties:{exchangeByLocale:{default:window.COUNTRY_CODE_TO_DEFAULT_EXCHANGE.en},groupByLocale:{default:"percent_change_gainers"}}},{type:"hotlist",properties:{exchangeByLocale:{default:window.COUNTRY_CODE_TO_DEFAULT_EXCHANGE.en},groupByLocale:{default:"percent_change_loosers"}}}]});const We=new class{constructor(e,t){this._updateDocumentHeight=e=>{"visual"===this._viewportType&&this._window.document.documentElement.style.setProperty("height",`${e}px`,"important")},this._window=e,this._fullscreenApi=t?new oe(e.document.body):new ne(e.document),this._viewportType=U.CheckMobile.iOS()&&!(0,le.isOnMobileAppPage)("any")&&this._window.visualViewport?"visual":"quirks","visual"===this._viewportType?this._viewport=(0,s.ensure)(this._window.visualViewport):this._viewport=this._window;const i=this._layoutSizeSensor=this._window.document.createElement("div");i.id="layout-size-sensor",i.style.position="fixed",i.style.top="0",i.style.left="0",i.style.right="0",i.style.bottom="0",i.style.pointerEvents="none",i.style.visibility="hidden",this._initFullscreen()}allocate(){this.free();const e=this._window.document,t=e.createElement("div");t.classList.add("js-rootresizer__contents"),t.style.position="relative",t.style.width="100%",t.style.height="100%",e.body.insertAdjacentElement("afterbegin",t),e.body.insertAdjacentElement("afterbegin",this._layoutSizeSensor),this._visibilityApi=new ae.VisibilityApi(this._window.document);const i={alive:new w.WatchedValue(!0),fullscreenable:new w.WatchedValue(!0),container:new w.WatchedValue(t),width:new w.WatchedValue,height:new w.WatchedValue,availWidth:new w.WatchedValue,availHeight:new w.WatchedValue,visible:this._visibilityApi.isVisible,fullscreen:this._fullscreenApi.isFullscreen,remove:()=>{i.alive.setValue(!1)},attach:()=>{
i.alive.setValue(!1),this._window.close()},requestFullscreen:()=>{this._requestFullscreen()},exitFullscreen:()=>{this._exitFullscreen()}};return i.alive.subscribe((e=>{e||i!==this._area||this.free()})),this._area=i,this._resizeHandler=()=>{const e=this._width(i)||800,t=this._height(i)||600;i.availHeight.setValue(t),i.availWidth.setValue(e),i.height.setValue(t),i.width.setValue(e)},this._area.height.subscribe(this._updateDocumentHeight,{callWithLast:!0}),this._resizeHandler(),this._viewport.addEventListener("resize",this._resizeHandler),new re.ResizerDetacherState(i).bridge()}free(){if(this._resizeHandler&&(this._viewport.removeEventListener("resize",this._resizeHandler),this._resizeHandler=void 0),this._visibilityApi&&(this._visibilityApi.destroy(),this._visibilityApi=void 0),this._area){const e=this._area;this._area=void 0,e.height.unsubscribe(this._updateDocumentHeight),e.alive.setValue(!1);const t=e.container.value(),i=t?.parentElement;i&&(i.removeChild(t),i.removeChild(this._layoutSizeSensor))}}_height(e){if("visual"===this._viewportType)return this._layoutSizeSensor.clientHeight;return e.container.value().clientHeight}_width(e){return e.container.value().clientWidth}_requestFullscreen(){this._fullscreenApi.enter()}_exitFullscreen(){this._fullscreenApi.exit()}_initFullscreen(){this._fullscreenApi.isFullscreen.subscribe((e=>{this._resizeHandler&&this._resizeHandler()}))}}(window),Oe=new class{constructor(e){this._processVisibility=e=>{const t=e.container.value();return this.affectsLayout(e.name)?(t&&t.classList.toggle("js-hidden",!1),!0):(t&&t.classList.toggle("js-hidden",!0),!1)},this._setWidth=(e,t,i)=>{let s=i;this._fullscreenArea!==e.name&&(e.availWidth.setValue(i),e.canNegotiate.width&&(s=he(i,e.negotiations.width))),t||(s=0);const r=e.container.value();return r&&t&&(r.style.width=s+"px"),e.width.setValue(s),s},this._setHeight=(e,t,i)=>{let s=i;this._fullscreenArea!==e.name&&(e.availHeight.setValue(i),e.canNegotiate.height&&(s=he(i,e.negotiations.height))),t||(s=0);const r=e.container.value();return r&&t&&(r.style.height=s+"px"),e.height.setValue(s),s};const t=e.container.value();if(!t)throw new Error("bridge.container.value() must be an element");this._container=t,this._availableAreas=["left","tradingpanel","right","top","bottom","center","topleft","extratop"],this._areas={},this._bridge=e,this._width=e.width,this._height=e.height,this._width.subscribe((()=>this.recalculate())),this._height.subscribe((()=>this.recalculate())),this._bridge.visible.subscribe((()=>this._updateVisibility())),this._bridge.fullscreen.subscribe((()=>this._onParentFullscreenChange())),this.recalculate()}allocate(e){const t=e&&e.areaName;if(-1===this._availableAreas.indexOf(t))throw new Error("unknown options.areaName");this.free(t);const i=this._createDOM(t),s={name:t,canNegotiate:{width:"left"===t||"right"===t||"tradingpanel"===t||"topleft"===t,height:"top"===t||"bottom"===t||"topleft"===t||"extratop"===t},negotiations:{width:[],height:[]},remove:()=>{for(const e in this._areas)this._areas[e]===s&&this.free(e)},negotiateWidth:e=>{
if(!s.canNegotiate.width)return;const t=ue(e);de(s.negotiations.width,t)||(s.negotiations.width=t,this.recalculate())},negotiateHeight:e=>{if(!s.canNegotiate.height)return;const t=ue(e);de(s.negotiations.height,t)||(s.negotiations.height=t,this.recalculate())},requestFullscreen:()=>{this._fullscreenArea||("right"!==t&&"center"!==t||(this._fullscreenArea=t),"center"===t&&this._bridge.requestFullscreen(),this._updateFullscreen())},exitFullscreen:()=>{t===this._fullscreenArea&&(this._fullscreenArea=void 0,"center"===t&&this._bridge.exitFullscreen(),this._updateFullscreen())},width:new w.WatchedValue,height:new w.WatchedValue,availWidth:new w.WatchedValue,availHeight:new w.WatchedValue,alive:new w.WatchedValue(!0),container:new w.WatchedValue(i),visible:new w.WatchedValue(!0),fullscreen:new w.WatchedValue(!1),fullscreenable:new w.WatchedValue("right"===t||"center"===t),rdState:new re.ResizerDetacherState};return s.rdState.pushOwner(s),this._areas[t]=s,s.rdState.owner.subscribe((e=>{const i=s.container.value();if(e!==s)i&&(i.innerHTML="",i.parentElement&&i.parentElement.removeChild(i));else{let e=null;for(let i=this._availableAreas.indexOf(t);i--;){const t=this._availableAreas[i];if(this.affectsLayout(t)){e=this._areas[t].container.value();break}}i&&(e&&i.parentElement?i.insertAdjacentElement("afterend",e):this._container.appendChild(i))}this.recalculate()}),{callWithLast:!0}),s.rdState.bridge()}free(e){const t=this._areas[e];if(!t)return;this._areas[e]=void 0;const i=t.container.value();i&&i.parentElement&&i.parentElement.removeChild(i),t.alive.setValue(!1)}recalculate(){const e={};this._recalcSingleRunToken=e;const t=this._areas.topleft,i=this._areas.left,s=this._areas.tradingpanel,r=this._areas.right,n=this._areas.top,o=this._areas.bottom,a=this._areas.center,l=this._areas.extratop,h=this._width.value(),u=this._height.value();let d=0,c=0,p=0,_=0,m=0,y=0,g=0,b=0;if(e===this._recalcSingleRunToken&&l){const e=this._processVisibility(l);b=this._setHeight(l,e,u),this._setWidth(l,e,h)}if(e===this._recalcSingleRunToken&&t){const e=this._processVisibility(t);g=this._setHeight(t,e,u),y=this._setWidth(t,e,h);const i=t.container.value();e&&i&&(i.style.top=b+"px")}let S=0;if(e===this._recalcSingleRunToken&&n){const e=this._processVisibility(n),t=n.container.value();e&&t&&(t.style.left=y+"px",t.style.top=b+"px");const i=h-y;this._setWidth(n,e,i),d=this._setHeight(n,e,u),d&&(S=1)}if(e===this._recalcSingleRunToken&&i){const e=this._processVisibility(i),t=Math.max(g,d);p=this._setWidth(i,e,h),p&&(p+=4),p&&1===S&&(S=4);const s=i.container.value();e&&s&&(s.style.top=t+b+S+"px"),this._setHeight(i,e,u-t-b)}if(e===this._recalcSingleRunToken&&s){const e=this._processVisibility(s);let t=h-p;pe||(t-=300),m=this._setWidth(s,e,t),m&&1===S&&(S=4),this._setHeight(s,e,u-b-d-S)}if(e===this._recalcSingleRunToken&&r){const e=this._processVisibility(r);let t=h-p-m;pe||(t-=300),_=this._setWidth(r,e,t),_&&1===S&&(S=4),this._setHeight(r,e,u-b-d-S);const i=r.container.value();e&&i&&(i.style.top=d+b+S+"px")}const v=m+_;let f=0,w=h-p-m-_-(v?4:0)
;const P=Boolean(m||!v);if(!_&&m&&(w+=4),e===this._recalcSingleRunToken&&o){const e=this._processVisibility(o),t=o.container.value();e&&t&&(t.style.left=p+"px",t.classList.toggle("no-border-top-left-radius",!p),t.classList.toggle("no-border-top-right-radius",P)),this._setWidth(o,e,w);const i=u-b;f=Math.min(300,i-0),c=this._setHeight(o,e,i)+4}const C=Boolean(d&&(p||v));if(this._container.classList.toggle("layout-with-border-radius",C),ce.setNewBlackColor&&this._container.classList.toggle("black-border-bigger-radius",!0),e===this._recalcSingleRunToken&&a){const e=this._processVisibility(a),t=a.container.value();e&&t&&(t.style.left=p+"px",t.style.top=d+b+S+"px",t.classList.toggle("no-border-bottom-left-radius",!c||!p),t.classList.toggle("no-border-bottom-right-radius",P||!c),t.classList.toggle("no-border-top-left-radius",Boolean(!p&&v)),t.classList.toggle("no-border-top-right-radius",P)),this._setWidth(a,e,w);const i=u-d-c-b-S;this._setHeight(a,e,Math.max(i,f))}if(e===this._recalcSingleRunToken&&s&&this.affectsLayout("tradingpanel")){const e=s.container.value();e&&(e.style.right=m&&_?`${_+4}px`:`${_}px`,e.style.top=b+d+S+"px",e.style.borderTopRightRadius=C&&_?"4px":"0px")}e===this._recalcSingleRunToken&&this._updateVisibility()}affectsLayout(e){const t=this._areas[e];if(!t)return!1;if(t.rdState.owner.value()!==t)return!1;if(this._fullscreenArea&&this._fullscreenArea!==e)return me(e);if(this._width.value()<=567||this._height.value()<=445&&!_e){if(!["center","top","left","topleft","extratop"].includes(e))return!1}return!0}_updateVisibility(){const e=this._bridge.visible.value();for(let t=0;t<this._availableAreas.length;t++){const i=this._availableAreas[t],s=this._areas[i];s&&(e&&this.affectsLayout(i)?s.visible.setValue(!0):s.visible.setValue(!1))}}_onParentFullscreenChange(){this._bridge.fullscreen.value()||(this._fullscreenArea=void 0,this._updateFullscreen())}_updateFullscreen(){const e=void 0!==this._fullscreenArea;for(let t=0;t<this._availableAreas.length;t++){const i=this._availableAreas[t],s=this._areas[i];if(!s)continue;if(i===this._fullscreenArea){s.fullscreen.setValue(!0);continue}s.fullscreen.setValue(!1);const r=s.container.value();r&&r.classList.toggle("js-hidden",e&&!me(i))}this._updateVisibility(),this.recalculate()}_createDOM(e){const t=document.createElement("div");return t.classList.add("layout__area--"+e),t.style.position="absolute","tradingpanel"===e&&(t.style.borderTopRightRadius="4px"),"bottom"===e?t.style.bottom="0":t.style.top="0","right"===e||"tradingpanel"===e?t.style.right="0":t.style.left="0",t}}(We.allocate()),Ue=it(Ae.hide_top_toolbar)?null:Oe.allocate({areaName:"top"}),ze=void 0===Ae.hide_side_toolbar||+Ae.hide_side_toolbar?null:Oe.allocate({areaName:"left"}),je=Oe.allocate({areaName:"center"}),Ge=Be.length?Oe.allocate({areaName:"right"}):null;if((0,Se.setSupportPortalProblemsHost)(Ae.support_host??""),Le){const e=(He=Le,ye.find((e=>e.value.value===He)));e&&(Ae.range=Le,Ae.interval=e.targetResolution)}var He;let qe,Ke;qe=void 0===Ae.interval?void 0===Ae.style?Ce.def_interval??"1":(0,
v.getDefaultResolution)((0,b.isRangeStyle)(parseInt(Ae.style))):Ae.interval,Ke=void 0===Ae.style?void 0===Ae.interval?Ce.def_style??1:(0,b.getDefaultStyle)(S.Interval.isRange(Ae.interval)):parseInt(Ae.style);const $e=window.chartWidgetCollection=new l.ChartWidgetCollection({resizerBridge:je,padding:5,edge:Number(Ae.padding)||0,publishedChartsEnabled:!1,saveChartEnabled:!1,widgetOptions:{onWidget:!0,useUserChartPreferences:!it(Ae.doNotStoreSettings,!1),addToWatchlistEnabled:!1,propertyPagesEnabled:!1,chartEventsEnabled:!1,newsNotificationsEnabled:!1,esdEnabled:n.enabled("esdonwidget"),sourceStatusesWidget:{errorSolution:!1},marketStatusWidgetEnabled:!0,chartWarningWidget:{subscriptionFullInfo:!1},widgetCustomer:Ie,customerReadableName:Ve,hideIdeas:!0,controlBarEnabled:!0,addVolume:!it(Ae.hide_volume),muteSessionErrors:!n.enabled("referral_program_for_widget_owners"),defSymbol:Re,defInterval:qe,defStyle:Ke,defSessionId:Te,timezone:Ae.timezone||Ce.def_timezone,defTimeframe:Le,isDrawingToolbarVisible:C.isDrawingToolbarVisible,watermarkEnabled:!0,paneContextMenuEnabled:!1,compareSymbols:Ee,timeScaleWidget:{contextMenuEnabled:!1,timezoneMenuEnabled:!1},timeScale:{preserveBarSpacing:!0,lockVisibleTimeRangeOnResize:!1},legendWidgetEnabled:!it(Ae.hide_legend),legendWidget:{contextMenu:{settings:!1,fundamentals:!1,showOpenMarketStatus:!0}},goToDateEnabled:!1,handleScroll:{vertTouchDrag:it(Ae.verttouchdrag),horzTouchDrag:it(Ae.horztouchdrag,!0)},handleScale:{mouseWheel:"investopedia"!==Ie&&"eurex"!==Ie},currencyConversionEnabled:!0,unitConversionEnabled:!0},seriesControlBarEnabled:!!xe,seriesControlBar:{timeFramesWidgetEnabled:!0,timeFramesWidget:{goToDateEnabled:!1,availableTimeFrames:R},timeWidgetEnabled:!0,timeWidget:{timezoneMenuEnabled:!1},adjustForDividendsButtonEnabled:!0,sessionIdButtonEnabled:Boolean(Te),backAdjustmentButtonEnabled:!1,settlementAsCloseButtonEnabled:!1,percentageScaleButtonEnabled:!1,logScaleButtonEnabled:!1,autoScaleButtonEnabled:!1,layoutFullscreenButtonEnabled:!0,mobileChangeLayoutEnabled:!1},mobileForceChartMaximizeEnabled:!1});let Ye=!1;$e.onAboutToBeDestroyed.subscribe(null,(()=>{Ye=!0}),!0),Ae.studies_overrides&&$e.applyStudiesOverrides(JSON.parse(Ae.studies_overrides)),Promise.all([i.e(12931),i.e(7337),i.e(24377),i.e(50687),i.e(30187)]).then(i.bind(i,417252)).then((e=>{e.addBrandingSource($e)}));const Je=$e.activeChartWidget.value();let Xe;if(window.chartWidget=Je,$e.readOnly()||(window.studyMarket=new P($e,{onWidget:!0})),c.linking.bindToChartWidgetCollection($e),k(N.Names.WidgetLoad,Ae.frameElementId||null,void 0),Ae.theme){const e=Ae.theme.toLowerCase(),t=A.themes[e];if(t&&((0,T.setTheme)(e),!t.noChartTheme)){const e=Ae.theme&&Ae.theme.toLowerCase(),t=A.getStdTheme(e);t&&t.content&&(Xe=t.content,Ae.style&&(Xe.mainSourceProperties.style=parseInt(Ae.style)),(0,a.applyDefaultsOverrides)(Xe,{mainSeriesProperties:"mainSourceProperties"},!0))}}let Ze=!1,Qe=!1;function et(e){return(0,ge.isPineIdString)(e)?{type:"pine",pineId:e}:{type:"java",studyId:e}}function tt(){
document.querySelectorAll(".loading-indicator").forEach((e=>{e instanceof HTMLElement&&(e.style.display="none")}))}function it(e,t=!1){return!1===e||!0===e?e:"1"===e||1===e||"true"===e||"0"!==e&&0!==e&&"false"!==e&&t}Je.withModel(null,(function(){const e=Je.model().mainSeries();Je.applyOverrides({"mainSeriesProperties.showCountdown":!1}),Xe&&Je.model().model().restoreTheme(Xe,!1),Ae.backgroundColor&&Je.applyOverrides({"paneProperties.background":Ae.backgroundColor,"paneProperties.backgroundType":be.ColorType.Solid}),Ae.gridColor&&Je.applyOverrides({"paneProperties.vertGridProperties.color":Ae.gridColor,"paneProperties.horzGridProperties.color":Ae.gridColor}),async function(e){if(!e)return;try{const t="string"==typeof e?JSON.parse(decodeURIComponent(e)):e;if(!Array.isArray(t)||0===t.length)return;const i=Je.model().model().mainSeries();for(let e=0;e<t.length;e++){const s=t[e];if(s.symbol&&s.position&&fe.CompareOption[s.position])switch(s.position){case"SameScale":Je.addCompareAsOverlay(s.symbol,!1,i.isYield());break;case"NewPriceScale":Je.addOverlayStudy(s.symbol,!0);break;case"NewPane":Je.addOverlayStudy(s.symbol,!1)}}}catch(e){return}}(Ae.compareSymbols),e.dataEvents().symbolResolved().subscribe(e,(()=>{!function(e,t){if(!t)return;const i=e.model().model();try{JSON.parse("string"==typeof t?t:JSON.stringify(t)).forEach((e=>{const t=i.createStudyInserter(et(e.id));t.setForceOverlay(e.overlay),t.insert((()=>Promise.resolve({inputs:e.inputs,parentSources:[]})))}))}catch(e){((Array.isArray(t)?t:t.split(/\x1f/))||[]).forEach((e=>{i.createStudyInserter(et(e)).insert()}))}}(window.chartWidget,Ae.studies)}),!0),e.dataEvents().completed().subscribe(this,(()=>{Xe&&tt(),G&&!Ze&&(G($e,!0),Ze=!0),q&&!Qe&&(q($e,{seriesControlBarEnabled:!!xe}),Qe=!0)})),e.dataEvents().symbolError().subscribe(null,(()=>{k(N.Names.NoData,Ae.frameElementId||null,void 0)}))})),ze&&(async()=>{
const[e,t,{DrawingToolbar:s},{default:r}]=await Promise.all([Promise.all([i.e(37307),i.e(98185),i.e(92537),i.e(46195),i.e(83439),i.e(61681),i.e(61171),i.e(98933),i.e(19190),i.e(67780),i.e(66032),i.e(13672),i.e(22956),i.e(95679),i.e(3359),i.e(84587),i.e(30158),i.e(1462),i.e(61667),i.e(15708),i.e(10844),i.e(98412),i.e(44213),i.e(93853),i.e(54320),i.e(51979),i.e(72457),i.e(95275),i.e(3016),i.e(28260),i.e(47827),i.e(9323),i.e(78628),i.e(88220),i.e(99590),i.e(6376),i.e(59901),i.e(60307),i.e(6461),i.e(61173),i.e(16804),i.e(24891),i.e(58898),i.e(82321),i.e(87473),i.e(5483),i.e(28974),i.e(72792),i.e(27766),i.e(38457),i.e(30531),i.e(73558)]).then(i.t.bind(i,50959,19)),Promise.all([i.e(37307),i.e(98185),i.e(92537),i.e(46195),i.e(83439),i.e(61681),i.e(61171),i.e(98933),i.e(19190),i.e(67780),i.e(66032),i.e(13672),i.e(22956),i.e(95679),i.e(3359),i.e(84587),i.e(30158),i.e(1462),i.e(61667),i.e(15708),i.e(10844),i.e(98412),i.e(44213),i.e(93853),i.e(54320),i.e(51979),i.e(72457),i.e(95275),i.e(3016),i.e(28260),i.e(47827),i.e(9323),i.e(78628),i.e(88220),i.e(99590),i.e(6376),i.e(59901),i.e(60307),i.e(6461),i.e(61173),i.e(16804),i.e(24891),i.e(58898),i.e(82321),i.e(87473),i.e(5483),i.e(28974),i.e(72792),i.e(27766),i.e(38457),i.e(30531),i.e(73558)]).then(i.t.bind(i,632227,19)),Promise.all([i.e(37307),i.e(98185),i.e(92537),i.e(46195),i.e(83439),i.e(61681),i.e(61171),i.e(98933),i.e(19190),i.e(67780),i.e(66032),i.e(13672),i.e(22956),i.e(95679),i.e(3359),i.e(84587),i.e(30158),i.e(1462),i.e(61667),i.e(15708),i.e(10844),i.e(98412),i.e(44213),i.e(93853),i.e(54320),i.e(51979),i.e(72457),i.e(95275),i.e(3016),i.e(28260),i.e(47827),i.e(9323),i.e(78628),i.e(88220),i.e(99590),i.e(6376),i.e(59901),i.e(60307),i.e(6461),i.e(61173),i.e(16804),i.e(24891),i.e(58898),i.e(82321),i.e(87473),i.e(5483),i.e(28974),i.e(72792),i.e(27766),i.e(38457),i.e(30531),i.e(73558)]).then(i.bind(i,362186)),Promise.all([i.e(37307),i.e(98185),i.e(92537),i.e(46195),i.e(83439),i.e(61681),i.e(61171),i.e(98933),i.e(19190),i.e(67780),i.e(66032),i.e(13672),i.e(22956),i.e(95679),i.e(3359),i.e(84587),i.e(30158),i.e(1462),i.e(61667),i.e(15708),i.e(10844),i.e(98412),i.e(44213),i.e(93853),i.e(54320),i.e(51979),i.e(72457),i.e(95275),i.e(3016),i.e(28260),i.e(47827),i.e(9323),i.e(78628),i.e(88220),i.e(99590),i.e(6376),i.e(59901),i.e(60307),i.e(6461),i.e(61173),i.e(16804),i.e(24891),i.e(58898),i.e(82321),i.e(87473),i.e(5483),i.e(28974),i.e(72792),i.e(27766),i.e(38457),i.e(30531),i.e(73558)]).then(i.t.bind(i,167481,23))]);Ye||(t.render(e.createElement(s,{chartWidgetCollection:$e,resizerBridge:ze,screenshotButton:"cme"===Ie}),ze.container.value()),window.lineToolPropertiesToolbar=new r($e))})(),Ue&&(async()=>{
const[e,t,s,{HeaderToolbar:r}]=await Promise.all([B(Ie),Promise.all([i.e(42576),i.e(60268),i.e(24891),i.e(10755),i.e(82321),i.e(79022)]).then(i.t.bind(i,50959,19)),Promise.all([i.e(42576),i.e(60268),i.e(24891),i.e(10755),i.e(82321),i.e(79022)]).then(i.t.bind(i,632227,19)),Promise.all([i.e(42576),i.e(60268),i.e(24891),i.e(10755),i.e(82321),i.e(79022)]).then(i.bind(i,8012))]),n=await e.getToolSet(),o=I.mobiletouch?["full"]:void 0;s.render(t.createElement(r,{tools:n,chartApiInstance:window.ChartApiInstance,availableTimeFrames:R,chartWidgetCollection:$e,ideas:!1,resizerBridge:Ue,popupButton:it(Ae.show_popup_button),studyMarket:window.studyMarket,windowMessageService:ke,isFundamental:!1,allowedModes:o}),Ue.container.value())})(),Ge&&(async()=>{const[{WidgetBar:e},{configuration:t}]=await Promise.all([Promise.all([i.e(49786),i.e(15371),i.e(98185),i.e(46195),i.e(83439),i.e(61171),i.e(98933),i.e(3359),i.e(98158),i.e(98412),i.e(72457),i.e(3016),i.e(40984),i.e(26235),i.e(8564),i.e(10198),i.e(61173),i.e(29163),i.e(30136),i.e(82321),i.e(90345),i.e(16388),i.e(67087),i.e(22174),i.e(54876)]).then(i.bind(i,897210)),Promise.all([i.e(49786),i.e(15371),i.e(98185),i.e(46195),i.e(83439),i.e(61171),i.e(98933),i.e(3359),i.e(98158),i.e(98412),i.e(72457),i.e(3016),i.e(40984),i.e(26235),i.e(8564),i.e(10198),i.e(61173),i.e(29163),i.e(30136),i.e(82321),i.e(90345),i.e(16388),i.e(67087),i.e(22174),i.e(54876)]).then(i.bind(i,667232))]);Be.forEach((e=>{e.widgets=e.widgets?.filter((e=>!(void 0!==e.isEnabled&&!e.isEnabled)))}));window.widgetbar=new e({resizerBridge:Ge,affectsLayout:()=>Oe.affectsLayout("right"),readonly:!0,state:{width:Me,pages:Be},showCloseButton:!0,configuration:()=>t({chartApiInstance:window.ChartApiInstance})})})(),Je.onDisconnected().subscribe(null,(e=>{var t;tt(),e&&(t=()=>{window.ChartApiInstance.disconnect(),setTimeout((()=>{window.ChartApiInstance.connect(),Je.reconnect()}),500)},f().then((e=>e.showCriticalErrorMessage(t))))})),Je.onReconnectBailout().subscribe(null,(()=>{var e;e=()=>{setTimeout((()=>{window.ChartApiInstance.connect()}),0)},f().then((t=>t.showDisconnectedMessage(e)))})),document.querySelectorAll(".tv-content").forEach((e=>{e.addEventListener("contextmenu",(e=>{e.target instanceof Element&&e.target.matches("input, textarea")||e.preventDefault()}))})),Ae.whotrades&&n.setEnabled("whotrades_auth_only",!0),document.querySelectorAll(".loading-indicator").forEach((e=>{e.remove()})),(()=>{let e;const t=t=>{void 0!==e&&(0,g.getQuoteSessionInstance)("simple").unsubscribe("widgetQuoteListener",e),e=t,(0,g.getQuoteSessionInstance)("simple").subscribe("widgetQuoteListener",t,(e=>{const t=e.values,i=["change","change_percent","last_price","original_name","short_name","exchange","description","volume"],s={};for(let e=0;e<i.length;e++){const r=i[e];if(!t.hasOwnProperty(r))return;s[r]=t[r]}s.volume=1e100===t.volume?void 0:t.volume,ke.post(parent,"quoteUpdate",s)}))};Je.withModel(null,(()=>{const e=Je.model().mainSeries();e.properties().childs().symbol.subscribe(e,(e=>{t(e.value()),
"telegram"===Ie&&ke.post(parent,"symbolChanged",e.value())}))})),ke.on("quoteSubscribe",(()=>{const e=Je.model().mainSeries().properties().childs().symbol.value();t(e)})),ke.on("imageURL",((e,t)=>{(0,h.takeChartSnapshot)($e,(e=>{t(e)}),(()=>{t("")}),{wl:it(Ce.logo?.whitelabel),cme:Ce.cme_widget})})),ke.on("symbolInfo",((e,t)=>{const i=(0,s.ensureNotNull)(Je.model().mainSeries().symbolInfo()),r=Je.model().mainSeries().properties().childs().interval.value();t({name:i.name,exchange:i.exchange,description:i.description,type:i.type,interval:r})})),ke.on("widgetReady",((e,t)=>{Je.withModel(null,(()=>{let e;Je.model().mainSeries().symbolInfo()?t():(e=()=>{t(),Je.model().mainSeries().dataEvents().symbolResolved().unsubscribe(null,e)},Je.model().mainSeries().dataEvents().symbolResolved().subscribe(null,e))}))})),F(M.Names.SetSymbol,(e=>{e&&e.symbol&&$e.setSymbol(e.symbol)})),F(M.Names.SetInterval,(e=>{e&&e.interval&&$e.setResolution(e.interval)}))})(),window.applyStudiesOverrides=e=>{e&&window.chartWidgetCollection.applyStudiesOverrides(e)}},75060:(e,t,i)=>{"use strict";i.d(t,{canPlaceAlertOnResolution:()=>n});var s=i(477786),r=i(778016);function n(e,t){const i=s.Interval.isSeconds(e),n=t?t?.alertsOnSeconds:(0,r.enabled)("ALERTS_ON_SECONDS");return!i||n}},347505:(e,t,i)=>{"use strict";i.d(t,{roundAlertValueUsingPrecision:()=>r});const s=(0,i(125226).isFeatureEnabled)("round_alert_value_using_precision");function r(e,t){if(!s)return t;const i=e.formatter();if(i.parse){const e=i.parse(i.format(t));if(e.res)return e.value}return t}},972155:(e,t,i)=>{"use strict";i.d(t,{getChartAlertsFacade:()=>a,getChartAlertsFacadeIfCreatedBefore:()=>l});const s=(0,i(481251).default)((async()=>{const{AlertsFiresFocusHandler:e}=await i.e(69581).then(i.bind(i,469517));return new e}));var r=i(154890);let n,o;async function a(){return n||(n=async function(){const[e,{getAlertsCollection:t},n,o]=await Promise.all([Promise.all([i.e(6075),i.e(90345),i.e(13936),i.e(80349),i.e(72738),i.e(7053),i.e(83912),i.e(68135),i.e(36679)]).then(i.bind(i,694710)),Promise.all([i.e(37742),i.e(90345),i.e(13936),i.e(80349),i.e(72738),i.e(7053),i.e(14141)]).then(i.bind(i,107053)),(0,r.getChartSourceIdsGetter)(),s()]);return new e.ChartAlertsFacade(t(),o,n)}()),o||(o=await n),o}function l(){return o??null}},154890:(e,t,i)=>{"use strict";i.d(t,{getChartSourceIdsGetter:()=>s});const s=(0,i(481251).default)((async()=>{const{ChartSourceIdsGetter:e}=await Promise.all([i.e(35706),i.e(90345),i.e(13936),i.e(80349),i.e(72738),i.e(7053),i.e(79979)]).then(i.bind(i,517696));return new e}))},969680:(e,t,i)=>{"use strict";i.r(t),i.d(t,{detectAutoDirection:()=>v,forceLTRStr:()=>c,forceLTRStrSsr:()=>p,forceRTLStr:()=>m,getLTRScrollLeft:()=>y,getLTRScrollLeftOffset:()=>g,isRtl:()=>r,startWithLTR:()=>d,stripLTRMarks:()=>u,stripLTRStrSsr:()=>_});var s=i(64531);const r=()=>"rtl"===window.document.dir,n="‎",o="‪",a="‫",l="‬",h=new RegExp(n+"|"+o+"|"+a+"|"+l,"g");function u(e){return""!==e&&r()&&null!=e?e.replace(h,""):e}function d(e){return""!==e&&r()&&null!=e?n+e:e}function c(e){
return""!==e&&r()&&null!=e?o+e+l:e}function p(e){return o+e+l}function _(e){return e.startsWith(o)&&e.endsWith(l)?e.slice(1,-1):e}function m(e){return""!==e&&r()&&null!=e?a+e+l:e}function y(e){return(0,s.getNormalizedScrollLeft)(e,"rtl")}function g(e,t){const i=(0,s.detectScrollType)();if("indeterminate"===i)return 0;switch(i){case"negative":t=e.clientWidth-e.scrollWidth+t;break;case"reverse":t=e.scrollWidth-e.clientWidth-t}return t}const b=/[^\u0000-\u0040\u005B-\u0060\u007B-\u00BF\u00D7\u00F7\u02B9-\u02FF\u2000-\u200E\u2010-\u2029\u202C\u202F-\u2BFF]/,S=/[\u0590-\u07FF\u200F\u202B\u202E\uFB1D-\uFDFD\uFE70-\uFEFC]/;function v(e){const t=b.exec(e);return t?S.test(t[0])?"rtl":"ltr":""}},707934:(e,t,i)=>{"use strict";i.r(t),i.d(t,{createGoProDialog:()=>p,isUpgradableFeature:()=>d,onGoProDialog:()=>h});var s=i(735566),r=i(638456);const n=(0,s.getLogger)("GoProDialog"),o=new Set,a=[],l=new Promise((e=>{window.addEventListener("load",(()=>{setTimeout((()=>{e()}),3e3)})),setTimeout((()=>{e()}),3e3)}));function h(e,t){a.push(e),t&&t.forEach((e=>{o.add(e)}))}const u=["sessionLock","sessionLogout","checkingNSE"];function d(e){return!1===u.includes(e)}const c=e=>["alerts","primitiveAlerts","complexAlerts","watchlistAlerts","alertsNoExpiration","alertsWebhook","alertsOnSeconds"].includes(e);async function p(e){if(c(e.feature)&&n.logNormal(`\n\t\t\tcreateGoProDialog options:\n\t\t\tfeature: ${e.feature}\n\t\t\thiddenFeatures: ${0!==o.size?Array.from(o).join(", "):"none"}\n\t\t\tisSymphonyEmbed: ${(0,r.isSymphonyEmbed)()}\n\t\t\tisUpgradableFeature: ${d(e.feature)}\n\t`),await l,a.forEach((t=>{t(e.feature)})),o.has(e.feature))return;if((0,r.isSymphonyEmbed)()&&d(e.feature)){const t=await Promise.all([i.e(21122),i.e(92537),i.e(87833),i.e(84712),i.e(7276),i.e(47093),i.e(44581)]).then(i.bind(i,681143));e.actionsOverride=t.generateSymphonyActions({feature:e.feature,upgradeMessage:e.upgradeMessage,additional:e.customParams}),e.hideLimitTable=!0}const t=await Promise.all([i.e(47183),i.e(41995),i.e(18883),i.e(92537),i.e(19190),i.e(39759),i.e(52186),i.e(65161),i.e(67131),i.e(82332),i.e(25974),i.e(94967),i.e(33595),i.e(7276),i.e(51989),i.e(94036),i.e(17725),i.e(39190),i.e(82321),i.e(94718),i.e(59844),i.e(83215),i.e(1083),i.e(5246)]).then(i.bind(i,427013));await(window.pro?.ensureValidShopConf()),c(e.feature)&&n.logNormal(`\n\t\t\tcreateGoProDialog.renderGoproDialog.options:\n\t\t\tactionsOverride: ${e.actionsOverride},\n\t\t\thideLimitTable: ${e.hideLimitTable}\n\t\t`),t.renderGoproDialog(e)}window.TradingView.createGoProDialog=p},234938:(e,t,i)=>{"use strict";i.d(t,{showGoProAlertsOnSecondsDialog:()=>r});var s=i(707934);i(659863);function r(){(0,s.createGoProDialog)({feature:"alertsOnSeconds"})}},958178:(e,t,i)=>{"use strict";i.d(t,{AggregateError:()=>g,ApiError:()=>y,accumulateErrors:()=>n,checkPhoneCode:()=>h,continuePartialAuth:()=>P,fetchPost:()=>o,firstLoginData:()=>a,firstLoginDataUrl:()=>r,recoverPassword:()=>S,recoverPasswordUrl:()=>b,recoveryPassword:()=>u,resendLink:()=>l,signin:()=>p,signinUrl:()=>d,signup:()=>m,
signupUrl:()=>_,socialAuth:()=>w});var s=i(803912);const r="/accounts/first_login_data/";function n(e,t){return Object.entries(e).map((e=>new y(e[1].join("\n"),t,e[0])))}function o(e,t){return(0,s.fetch)(e,{method:"POST",credentials:"include",mode:"same-origin",body:t})}function a(e){return o(r,e).then((e=>e.ok?e.json():e.json().then((t=>{throw new g(n(t.errors,e.status))}))))}function l(){return o("/api/v1/users/anon/change-email/resend/").then((e=>e.ok?e.json():e.json().then((e=>{throw Error(e.error)}))))}function h(e){return o("/api/v1/recover_password/check_phone_code/",e).then((e=>e.ok?e.json():e.json().then((e=>{throw Error(e.error)}))))}function u(e){return o("/api/v1/recover_password/",e).then((e=>e))}const d="/accounts/signin/";function c(e){return e.json().then((t=>{if("errors"in t&&Object.keys(t.errors).length)throw new g(n(t.errors,e.status));if("error"in t&&""!==t.error||"code"in t||!e.ok)throw new y(t.error||t.detail,e.status,t.code,t.confirm_auth_data,t.two_factor_types,function(e){if(e.signature)return{signature:e.signature,email:e.email||"",phone:e.phone||"",socials:[]};return}(t));return t}))}function p(e){return o(d,e).then(c)}const _="/accounts/signup/";function m(e){return o(_,e).then((e=>e.json().then((t=>{if("errors"in t&&""!==t.errors)throw new g(n(t.errors,e.status))}))))}class y extends Error{constructor(e,t,i,s,r,n){super(e),this.type=i,this.status=t,this.secondFactorTypes=r,this.socialConfirmData=s,this.resetPasswordData=n}}class g extends Error{constructor(e){super(e.map((e=>e.message)).join("\n")),this.errors=[],this.errors=e}}const b="/api/v1/recover_password/search/";function S(e){return o(b,e).then(c)}const v="/accounts/complete/android-jwt/",f={Accept:"application/json"};function w(e,t){const i=new URL(window.origin+v);return Object.entries(t).forEach((([e,t])=>t&&i.searchParams.append(e,t))),(0,s.fetch)(i.href,{method:"POST",body:e,headers:f}).then(c)}function P(e,t){const i=new URL(window.origin+`/accounts/complete/${e}/`),r=new FormData;return r.append("partial_token",t),(0,s.fetch)(i.href,{method:"POST",body:r,headers:f}).then(c)}},305141:(e,t,i)=>{"use strict";i.d(t,{setNewBlackColor:()=>s});const s=(0,i(125226).isFeatureEnabled)("set_new_black_color")},47728:e=>{"use strict";var t={},i={XCBT:"CBOT",XNYM:"NYMEX",XCME:"CME",XCEC:"COMEX"};t.convertSymbolDataToTV=function(e,t,s){return s=2===s||"floor"===s||"pit"===s?"PIT":"GBX",t&&i[t]?{status:"ok",data:{symbol:e,exchange:i[t]+"_"+s}}:{status:"error",data:"Exchange `"+t+"` is not supported"}},e.exports=t},981191:(e,t,i)=>{"use strict";i.d(t,{getDayResolutionTimeFrameOptions:()=>d,getFromForDay:()=>l,getFromForMonthsAgo:()=>o,getFromForYearsAgo:()=>a,getMediumTimeFrameOptions:()=>c,getMiniTimeFrameOptions:()=>u,getStartOfTheYear:()=>h});var s=i(708078),r=i(873146);const n=Date.now();function o(e){const t=new Date(n);return t.setMonth(t.getMonth()-e),Math.trunc(t.valueOf()/1e3)}function a(e){const t=new Date(n);return t.setFullYear(t.getFullYear()-e),Math.trunc(t.valueOf()/1e3)}function l(e){const t=new Date(n)
;return t.setDate(t.getDate()-e),Math.trunc(t.valueOf()/1e3)}function h(){return Math.trunc((0,s.resetToYearStart)(new Date(n)).valueOf()/1e3)}function u(e){const t=(0,r.getTimeFrames)();return[{...t[e?"lastsession":"1d"]},{...t["1m"],targetResolution:"1D",from:o(1)},{...t["3m"],targetResolution:"1D",from:o(3)},{...t["12m"],from:a(1)},{...t["60m"],targetResolution:"1M",from:a(5)},{...t.all}]}function d(e){const t=(0,r.getTimeFrames)();return[{...t[e?"lastsession":"1d"]},{...t["1m"],targetResolution:"1D",from:o(1)},{...t["3m"],targetResolution:"1D",from:o(3)},{...t["6m"],targetResolution:"1D",from:o(6)},{...t.ytd,targetResolution:"1D",from:o(6)},{...t["12m"],from:a(1)}]}function c(e){const t=(0,r.getTimeFrames)(),i=[];return 1!==e&&i.push({...t.lastsession}),0!==e&&i.push({...t["1d"]}),[...i,{...t["1m"],targetResolution:"60",from:o(1)},{...t["3m"],targetResolution:"120",from:o(3)},{...t["12m"],from:a(1)},{...t["60m"],targetResolution:"1W",from:a(5)},{...t.all}]}},873146:(e,t,i)=>{"use strict";i.d(t,{getTimeFrames:()=>n});var s=i(444372),r=i(737986);function n(e){return{"1d":{text:s.t(null,void 0,i(207075)),value:{value:"1D",type:"period-back"},targetResolution:e?.["1D"]??(0,r.stringAsResolution)("1"),description:(0,r.daysStringLiteral)(1)},"5d":{text:s.t(null,void 0,i(558628)),value:{value:"5D",type:"period-back"},targetResolution:e?.["5D"]??(0,r.stringAsResolution)("5"),description:(0,r.daysStringLiteral)(5)},"1w":{text:s.t(null,void 0,i(189696)),value:{value:"7D",type:"period-back"},targetResolution:e?.["5W"]??(0,r.stringAsResolution)("15"),description:(0,r.weeksStringLiteral)(1)},"1m":{text:s.t(null,void 0,i(333493)),value:{value:"1M",type:"period-back"},targetResolution:e?.["1M"]??(0,r.stringAsResolution)("30"),description:(0,r.monthsStringLiteral)(1)},"3m":{text:s.t(null,void 0,i(318717)),value:{value:"3M",type:"period-back"},targetResolution:e?.["3M"]??(0,r.stringAsResolution)("60"),description:(0,r.monthsStringLiteral)(3)},"6m":{text:s.t(null,void 0,i(869411)),value:{value:"6M",type:"period-back"},targetResolution:e?.["6M"]??(0,r.stringAsResolution)("120"),description:(0,r.monthsStringLiteral)(6)},"12m":{text:s.t(null,void 0,i(186322)),value:{value:"12M",type:"period-back"},targetResolution:e?.["12M"]??(0,r.stringAsResolution)("1D"),description:(0,r.yearsStringLiteral)(1)},"24m":{text:s.t(null,void 0,i(745391)),value:{value:"24M",type:"period-back"},targetResolution:e?.["24M"]??(0,r.stringAsResolution)("1W"),description:(0,r.yearsStringLiteral)(2)},"36m":{text:s.t(null,void 0,i(189992)),value:{value:"36M",type:"period-back"},targetResolution:e?.["36M"]??(0,r.stringAsResolution)("1W"),description:(0,r.yearsStringLiteral)(3)},"60m":{text:s.t(null,void 0,i(772834)),value:{value:"60M",type:"period-back"},targetResolution:e?.["60M"]??(0,r.stringAsResolution)("1W"),description:(0,r.yearsStringLiteral)(5)},"120m":{text:s.t(null,void 0,i(27969)),value:{value:"120M",type:"period-back"},targetResolution:e?.["120M"]??(0,r.stringAsResolution)("1M"),description:(0,r.yearsStringLiteral)(10)},ytd:{
text:s.t(null,void 0,i(168881)),value:{value:"YTD",type:"period-back"},targetResolution:e?.YTD??(0,r.stringAsResolution)("1D"),description:s.t(null,void 0,i(251478))},all:{text:s.t(null,void 0,i(580066)),value:{value:"ALL",type:"period-back"},targetResolution:e?.ALL??(0,r.stringAsResolution)("1M")},lastsession:{text:s.t(null,void 0,i(207075)),value:{value:"LASTSESSION",type:"period-back"},targetResolution:e?.LASTSESSION??(0,r.stringAsResolution)("1"),description:(0,r.daysStringLiteral)(1)}}}},737986:(e,t,i)=>{"use strict";i.d(t,{daysStringLiteral:()=>o,hoursStringLiteral:()=>n,minutesStringLiteral:()=>r,monthsStringLiteral:()=>l,stringAsResolution:()=>u,weeksStringLiteral:()=>a,yearsStringLiteral:()=>h});var s=i(444372);const r=e=>s.t(null,{plural:"{str} minutes",count:e,replace:{str:`${e}`}},i(805926)),n=e=>s.t(null,{plural:"{str} hours",count:e,replace:{str:`${e}`}},i(664963)),o=e=>s.t(null,{plural:"{str} days",count:e,replace:{str:`${e}`}},i(862368)),a=e=>s.t(null,{plural:"{str} weeks",count:e,replace:{str:`${e}`}},i(149306)),l=e=>s.t(null,{plural:"{str} months",count:e,replace:{str:`${e}`}},i(520062)),h=e=>s.t(null,{plural:"{str} years",count:e,replace:{str:`${e}`}},i(791549)),u=e=>e},950668:(e,t,i)=>{"use strict";i.d(t,{timeFrames:()=>s});const s=(0,i(873146).getTimeFrames)()},482354:(e,t,i)=>{"use strict";function s(e,t){t||(t={}),"function"==typeof t&&(t={cmp:t});var i=t.space||"";"number"==typeof i&&(i=Array(i+1).join(" "));var s,o="boolean"==typeof t.cycles&&t.cycles,a=t.replacer||function(e,t){return t},l=t.cmp&&(s=t.cmp,function(e){return function(t,i){var r={key:t,value:e[t]},n={key:i,value:e[i]};return s(r,n)}}),h=[];return function e(t,s,u,d){var c=i?"\n"+new Array(d+1).join(i):"",p=i?": ":":";if(u&&u.toJSON&&"function"==typeof u.toJSON&&(u=u.toJSON()),void 0!==(u=a.call(t,s,u))){if("object"!=typeof u||null===u)return JSON.stringify(u);if(r(u)){for(var _=[],m=0;m<u.length;m++){var y=e(u,m,u[m],d+1)||JSON.stringify(null);_.push(c+i+y)}return"["+_.join(",")+c+"]"}if(-1!==h.indexOf(u)){if(o)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}h.push(u);var g=n(u).sort(l&&l(u));for(_=[],m=0;m<g.length;m++){var b=e(u,s=g[m],u[s],d+1);if(b){var S=JSON.stringify(s)+p+b;_.push(c+i+S)}}return h.splice(h.indexOf(u),1),"{"+_.join(",")+c+"}"}}({"":e},"",e,0)}i.d(t,{sortedStringify:()=>s});var r=Array.isArray||function(e){return"[object Array]"==={}.toString.call(e)},n=Object.keys||function(e){var t=Object.prototype.hasOwnProperty||function(){return!0},i=[];for(var s in e)t.call(e,s)&&i.push(s);return i}}},e=>{e.O(0,[8107],(()=>{[37742,90345,13936,80349,72738,7053,14141].map(e.E)}),5);e.O(0,[56316,10444,31156,98681,3579,44883,38452,17065,36338,89358,575,30649,69022,50687,47793,37939,59169,81242,29888,33057,63317,53014,94231,63985,88741,80349,85182,13498,32565,7351,78466,7815,62193,33453,7780,60986,61129,45038,42099,74981,83976,94064,99394,19727,76175,67098,59802],(()=>{return t=540921,e(e.s=t);var t}));e.O()}]);